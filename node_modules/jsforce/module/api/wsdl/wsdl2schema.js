import "core-js/modules/es.array.iterator";
import "core-js/modules/es.promise";
import "core-js/modules/es.string.replace";
import _JSON$stringify from "@babel/runtime-corejs3/core-js-stable/json/stringify";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import _Array$isArray from "@babel/runtime-corejs3/core-js-stable/array/is-array";
import _Promise from "@babel/runtime-corejs3/core-js-stable/promise";
import fs from 'fs-extra';
import xml2js from 'xml2js';
import { castTypeUsingSchema } from '../../soap';
import { isMapObject } from '../../util/function';
/**
 *
 */

const WSDLRestrictionSchema = {
  $: {
    base: 'string'
  },
  enumeration: [{
    $: {
      value: 'string'
    }
  }],
  'xsd:enumeration': [{
    $: {
      value: 'string'
    }
  }]
};
const WSDLSimpleTypeSchema = {
  $: {
    name: 'string'
  },
  restriction: WSDLRestrictionSchema,
  'xsd:restriction': WSDLRestrictionSchema
};
const WSDLElementSchema = {
  $: {
    name: 'string',
    type: 'string',
    minOccurs: '?number',
    maxOccurs: '?string',
    nillable: '?boolean'
  }
};
const WSDLSequenceSchema = {
  element: ['?', WSDLElementSchema],
  'xsd:element': ['?', WSDLElementSchema]
};
const WSDLExtensionSchema = {
  $: {
    base: 'string'
  },
  sequence: {
    '?': WSDLSequenceSchema
  },
  'xsd:sequence': {
    '?': WSDLSequenceSchema
  }
};
const WSDLComplexContentSchema = {
  extension: {
    '?': WSDLExtensionSchema
  },
  'xsd:extension': {
    '?': WSDLExtensionSchema
  }
};
const WSDLComplexTypeSchema = {
  $: {
    name: 'string'
  },
  sequence: {
    '?': WSDLSequenceSchema
  },
  'xsd:sequence': {
    '?': WSDLSequenceSchema
  },
  complexContent: {
    '?': WSDLComplexContentSchema
  },
  'xsd:complexContent': {
    '?': WSDLComplexContentSchema
  }
};
const WSDLSchemaSchema = {
  $: 'any',
  complexType: ['?', 'any'],
  simpleType: ['?', 'any'],
  'xsd:complexType': ['?', 'any'],
  'xsd:simpleType': ['?', 'any']
};
const WSDLSchema = {
  definitions: {
    $: 'any',
    types: {
      schema: ['?', WSDLSchemaSchema],
      'xsd:schema': ['?', WSDLSchemaSchema]
    },
    message: ['any'],
    portType: {
      $: 'any',
      operation: ['any']
    },
    binding: {
      $: 'any',
      operation: ['any']
    },
    service: {
      $: 'any',
      documentation: 'string',
      operation: ['any']
    }
  }
};
/**
 *
 */

/**
 *
 */
function toJsType(xsdType, simpleTypes) {
  switch (xsdType) {
    case 'xsd:boolean':
      return 'boolean';

    case 'xsd:string':
    case 'xsd:date':
    case 'xsd:dateTime':
    case 'xsd:time':
    case 'xsd:base64Binary':
      return 'string';

    case 'xsd:int':
    case 'xsd:long':
    case 'xsd:double':
      return 'number';

    case 'xsd:anyType':
      return 'any';

    default:
      {
        const [ns, type] = xsdType.split(':');

        if (simpleTypes[type]) {
          return simpleTypes[type];
        }

        if (ns) {
          return type;
        }

        return xsdType;
      }
  }
}
/**
 *
 */


async function readWSDLFile(filePath) {
  const xmlData = await fs.readFile(filePath, 'utf8');
  const json = await xml2js.parseStringPromise(xmlData, {
    explicitArray: false
  });
  return castTypeUsingSchema(json, WSDLSchema);
}
/**
 *
 */


function getTypeInfo(el, simpleTypes) {
  let type = toJsType(el.$.type, simpleTypes);
  const isArray = el.$.maxOccurs === 'unbounded';
  const nillable = !isArray && el.$.minOccurs === 0 || el.$.nillable;
  return isArray ? nillable ? ['?', type] : [type] : nillable ? `?${type}` : type;
}
/**
 *
 */


function extractComplexTypes(wsdl) {
  console.log(wsdl.definitions.types['xsd:schema']);
  let schemas = {};
  const simpleTypes = {};
  const types = wsdl.definitions.types;

  for (const sc of (_ref = (_types$schema = types.schema) !== null && _types$schema !== void 0 ? _types$schema : types['xsd:schema']) !== null && _ref !== void 0 ? _ref : []) {
    var _ref, _types$schema;

    for (const st of (_ref2 = (_sc$simpleType = sc.simpleType) !== null && _sc$simpleType !== void 0 ? _sc$simpleType : sc['xsd:simpleType']) !== null && _ref2 !== void 0 ? _ref2 : []) {
      var _ref2, _sc$simpleType, _simpleType$restricti;

      const simpleType = castTypeUsingSchema(st, WSDLSimpleTypeSchema);
      const rs = (_simpleType$restricti = simpleType.restriction) !== null && _simpleType$restricti !== void 0 ? _simpleType$restricti : simpleType['xsd:restriction'];
      const base = rs.$.base.split(':')[1];
      simpleTypes[simpleType.$.name] = base;
    }
  }

  console.log({
    simpleTypes
  });

  for (const sc of (_ref3 = (_types$schema2 = types.schema) !== null && _types$schema2 !== void 0 ? _types$schema2 : types['xsd:schema']) !== null && _ref3 !== void 0 ? _ref3 : []) {
    var _ref3, _types$schema2;

    for (const ct of (_ref4 = (_sc$complexType = sc.complexType) !== null && _sc$complexType !== void 0 ? _sc$complexType : sc['xsd:complexType']) !== null && _ref4 !== void 0 ? _ref4 : []) {
      var _ref4, _sc$complexType, _complexType$sequence, _seq$element, _complexType$complexC;

      const complexType = castTypeUsingSchema(ct, WSDLComplexTypeSchema);
      const schema = {
        type: complexType.$.name,
        props: {}
      };
      const seq = (_complexType$sequence = complexType.sequence) !== null && _complexType$sequence !== void 0 ? _complexType$sequence : complexType['xsd:sequence'];
      const els = (_seq$element = seq === null || seq === void 0 ? void 0 : seq.element) !== null && _seq$element !== void 0 ? _seq$element : seq === null || seq === void 0 ? void 0 : seq['xsd:element'];

      for (const el of els !== null && els !== void 0 ? els : []) {
        schema.props[el.$.name] = getTypeInfo(el, simpleTypes);
      }

      const cc = (_complexType$complexC = complexType.complexContent) !== null && _complexType$complexC !== void 0 ? _complexType$complexC : complexType['xsd:complexContent'];

      if (cc) {
        var _cc$extension;

        const extension = (_cc$extension = cc.extension) !== null && _cc$extension !== void 0 ? _cc$extension : cc['xsd:extension'];

        if (extension) {
          var _extension$sequence, _seq$element2;

          schema.extends = extension.$.base.split(':')[1];
          const seq = (_extension$sequence = extension.sequence) !== null && _extension$sequence !== void 0 ? _extension$sequence : extension['xsd:sequence'];
          const els = (_seq$element2 = seq === null || seq === void 0 ? void 0 : seq.element) !== null && _seq$element2 !== void 0 ? _seq$element2 : seq === null || seq === void 0 ? void 0 : seq['xsd:element'];

          for (const el of els !== null && els !== void 0 ? els : []) {
            schema.props[el.$.name] = getTypeInfo(el, simpleTypes);
          }
        }
      }

      schemas[complexType.$.name] = schema;
    }
  }

  return schemas;
}
/**
 *
 */


const GENERATED_MESSAGE_COMMENT = `/**
 * This file is generated from WSDL file by wsdl2schema.ts.
 * Do not modify directly.
 * To generate the file, run "ts-node path/to/wsdl2schema.ts path/to/wsdl.xml path/to/schema.ts"
 */
`;
/**
 *
 */

async function dumpSchema(schemas, outFile) {
  const out = fs.createWriteStream(outFile, 'utf8');

  const print = (str, indent = 0) => {
    for (let i = 0; i < indent; i++) {
      out.write(' ');
    }

    out.write(str);
  };

  const println = (str = '', indent = 0) => {
    print(str + '\n', indent);
  };

  return new _Promise((resolve, reject) => {
    out.on('error', reject);
    out.on('finish', () => resolve());
    println(GENERATED_MESSAGE_COMMENT);
    print('export const ApiSchemas = ');
    writeSchema(schemas);
    println(' as const;');
    println();
    writeTypeDefs(schemas);
    out.end();
  });

  function writeSchema(o, indent = 0) {
    if (indent > 20) {
      print("'any'");
      return;
    }

    if (_Array$isArray(o)) {
      print('[');
      let i = 0;

      for (const co of o) {
        if (i > 0) {
          print(', ');
        }

        writeSchema(co, indent);
        i++;
      }

      print(']');
    } else if (isMapObject(o)) {
      const keys = _Object$keys(o);

      if (keys.length > 0) {
        println('{');

        for (const name of keys) {
          const co = o[name];
          const nameId = /^[\w_$]+$/.test(name) ? name : `'${name}'`;
          print(`${nameId}: `, indent + 2);
          writeSchema(co, indent + 2);
          println(',');
        }

        print('}', indent);
      } else {
        print('{}');
      }
    } else {
      print(_JSON$stringify(o).replace(/"/g, "'"));
    }
  }

  function writeTypeDef(o, schemas, indent = 0) {
    if (typeof o === 'string') {
      print(o);
    } else if (isMapObject(o)) {
      if ('type' in o && 'props' in o) {
        if ('extends' in o && typeof o.extends === 'string') {
          print(`${o.extends} & `);
        }

        writeTypeDef(o.props, schemas, indent);
        return;
      }

      const keys = _Object$keys(o);

      if (keys.length > 0) {
        println('{');

        for (const prop of _Object$keys(o)) {
          let value = o[prop];
          let nillable = false;
          let isArray = false;

          if (_Array$isArray(value)) {
            isArray = true;
            const len = value.length;

            if (len === 2 && value[0] === '?') {
              nillable = true;
              value = value[1];
            } else {
              value = value[0];
            }
          } else if (isMapObject(value)) {
            if ('?' in value) {
              nillable = true;
              value = value['?'];
            }
          }

          if (typeof value === 'string' && value[0] === '?') {
            nillable = true;
            value = value.substring(1);
          }

          print(`${prop}${nillable ? '?' : ''}: `, indent + 2);
          writeTypeDef(value, schemas, indent + 2);

          if (isArray) {
            print('[]');
          }

          if (nillable) {
            print(' | null | undefined');
          }

          println(';');
        }

        print('}', indent);
      } else {
        print('{}');
      }
    }
  }

  function writeTypeDefs(schemas) {
    for (const name of _Object$keys(schemas)) {
      const schema = schemas[name];
      print(`export type ${name} = `);
      writeTypeDef(schema, schemas);
      println(';');
      println();
    }

    println('export type ApiSchemaTypes = {');

    for (const name of _Object$keys(schemas)) {
      println(`${name}: ${name};`, 2);
    }

    println('};');
  }
}
/**
 *
 */


async function main() {
  const wsdlFilePath = process.argv[2];

  if (!wsdlFilePath) {
    console.error('No input WSDL file is specified.');
    return;
  }

  const outFilePath = process.argv[3];

  if (!wsdlFilePath) {
    console.error('No output typescript schema file is specified.');
    return;
  }

  const wsdl = await readWSDLFile(wsdlFilePath);
  const schemas = extractComplexTypes(wsdl);
  dumpSchema(schemas, outFilePath);
}

main();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcGkvd3NkbC93c2RsMnNjaGVtYS50cyJdLCJuYW1lcyI6WyJmcyIsInhtbDJqcyIsImNhc3RUeXBlVXNpbmdTY2hlbWEiLCJpc01hcE9iamVjdCIsIldTRExSZXN0cmljdGlvblNjaGVtYSIsIiQiLCJiYXNlIiwiZW51bWVyYXRpb24iLCJ2YWx1ZSIsIldTRExTaW1wbGVUeXBlU2NoZW1hIiwibmFtZSIsInJlc3RyaWN0aW9uIiwiV1NETEVsZW1lbnRTY2hlbWEiLCJ0eXBlIiwibWluT2NjdXJzIiwibWF4T2NjdXJzIiwibmlsbGFibGUiLCJXU0RMU2VxdWVuY2VTY2hlbWEiLCJlbGVtZW50IiwiV1NETEV4dGVuc2lvblNjaGVtYSIsInNlcXVlbmNlIiwiV1NETENvbXBsZXhDb250ZW50U2NoZW1hIiwiZXh0ZW5zaW9uIiwiV1NETENvbXBsZXhUeXBlU2NoZW1hIiwiY29tcGxleENvbnRlbnQiLCJXU0RMU2NoZW1hU2NoZW1hIiwiY29tcGxleFR5cGUiLCJzaW1wbGVUeXBlIiwiV1NETFNjaGVtYSIsImRlZmluaXRpb25zIiwidHlwZXMiLCJzY2hlbWEiLCJtZXNzYWdlIiwicG9ydFR5cGUiLCJvcGVyYXRpb24iLCJiaW5kaW5nIiwic2VydmljZSIsImRvY3VtZW50YXRpb24iLCJ0b0pzVHlwZSIsInhzZFR5cGUiLCJzaW1wbGVUeXBlcyIsIm5zIiwic3BsaXQiLCJyZWFkV1NETEZpbGUiLCJmaWxlUGF0aCIsInhtbERhdGEiLCJyZWFkRmlsZSIsImpzb24iLCJwYXJzZVN0cmluZ1Byb21pc2UiLCJleHBsaWNpdEFycmF5IiwiZ2V0VHlwZUluZm8iLCJlbCIsImlzQXJyYXkiLCJleHRyYWN0Q29tcGxleFR5cGVzIiwid3NkbCIsImNvbnNvbGUiLCJsb2ciLCJzY2hlbWFzIiwic2MiLCJzdCIsInJzIiwiY3QiLCJwcm9wcyIsInNlcSIsImVscyIsImNjIiwiZXh0ZW5kcyIsIkdFTkVSQVRFRF9NRVNTQUdFX0NPTU1FTlQiLCJkdW1wU2NoZW1hIiwib3V0RmlsZSIsIm91dCIsImNyZWF0ZVdyaXRlU3RyZWFtIiwicHJpbnQiLCJzdHIiLCJpbmRlbnQiLCJpIiwid3JpdGUiLCJwcmludGxuIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uIiwid3JpdGVTY2hlbWEiLCJ3cml0ZVR5cGVEZWZzIiwiZW5kIiwibyIsImNvIiwia2V5cyIsImxlbmd0aCIsIm5hbWVJZCIsInRlc3QiLCJyZXBsYWNlIiwid3JpdGVUeXBlRGVmIiwicHJvcCIsImxlbiIsInN1YnN0cmluZyIsIm1haW4iLCJ3c2RsRmlsZVBhdGgiLCJwcm9jZXNzIiwiYXJndiIsImVycm9yIiwib3V0RmlsZVBhdGgiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxPQUFPQSxFQUFQLE1BQWUsVUFBZjtBQUNBLE9BQU9DLE1BQVAsTUFBbUIsUUFBbkI7QUFDQSxTQUFTQyxtQkFBVCxRQUFvQyxZQUFwQztBQUVBLFNBQVNDLFdBQVQsUUFBNEIscUJBQTVCO0FBRUE7QUFDQTtBQUNBOztBQUNBLE1BQU1DLHFCQUFxQixHQUFHO0FBQzVCQyxFQUFBQSxDQUFDLEVBQUU7QUFBRUMsSUFBQUEsSUFBSSxFQUFFO0FBQVIsR0FEeUI7QUFFNUJDLEVBQUFBLFdBQVcsRUFBRSxDQUNYO0FBQ0VGLElBQUFBLENBQUMsRUFBRTtBQUFFRyxNQUFBQSxLQUFLLEVBQUU7QUFBVDtBQURMLEdBRFcsQ0FGZTtBQU81QixxQkFBbUIsQ0FDakI7QUFDRUgsSUFBQUEsQ0FBQyxFQUFFO0FBQUVHLE1BQUFBLEtBQUssRUFBRTtBQUFUO0FBREwsR0FEaUI7QUFQUyxDQUE5QjtBQWNBLE1BQU1DLG9CQUFvQixHQUFHO0FBQzNCSixFQUFBQSxDQUFDLEVBQUU7QUFBRUssSUFBQUEsSUFBSSxFQUFFO0FBQVIsR0FEd0I7QUFFM0JDLEVBQUFBLFdBQVcsRUFBRVAscUJBRmM7QUFHM0IscUJBQW1CQTtBQUhRLENBQTdCO0FBTUEsTUFBTVEsaUJBQWlCLEdBQUc7QUFDeEJQLEVBQUFBLENBQUMsRUFBRTtBQUNESyxJQUFB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QUFBQSxPQUFPLENBQUM0QyxLQUFSLENBQWMsZ0RBQWQ7QUFDQTtBQUNEOztBQUNELFFBQU03QyxJQUFJLEdBQUcsTUFBTVgsWUFBWSxDQUFDcUQsWUFBRCxDQUEvQjtBQUNBLFFBQU12QyxPQUFPLEdBQUdKLG1CQUFtQixDQUFDQyxJQUFELENBQW5DO0FBQ0FjLEVBQUFBLFVBQVUsQ0FBQ1gsT0FBRCxFQUFVMkMsV0FBVixDQUFWO0FBQ0Q7O0FBRURMLElBQUkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IHhtbDJqcyBmcm9tICd4bWwyanMnO1xuaW1wb3J0IHsgY2FzdFR5cGVVc2luZ1NjaGVtYSB9IGZyb20gJy4uLy4uL3NvYXAnO1xuaW1wb3J0IHsgU29hcFNjaGVtYUVsZW1lbnRUeXBlLCBTb2FwU2NoZW1hRGVmIH0gZnJvbSAnLi4vLi4vdHlwZXMnO1xuaW1wb3J0IHsgaXNNYXBPYmplY3QgfSBmcm9tICcuLi8uLi91dGlsL2Z1bmN0aW9uJztcblxuLyoqXG4gKlxuICovXG5jb25zdCBXU0RMUmVzdHJpY3Rpb25TY2hlbWEgPSB7XG4gICQ6IHsgYmFzZTogJ3N0cmluZycgfSxcbiAgZW51bWVyYXRpb246IFtcbiAgICB7XG4gICAgICAkOiB7IHZhbHVlOiAnc3RyaW5nJyB9LFxuICAgIH0sXG4gIF0sXG4gICd4c2Q6ZW51bWVyYXRpb24nOiBbXG4gICAge1xuICAgICAgJDogeyB2YWx1ZTogJ3N0cmluZycgfSxcbiAgICB9LFxuICBdLFxufSBhcyBjb25zdDtcblxuY29uc3QgV1NETFNpbXBsZVR5cGVTY2hlbWEgPSB7XG4gICQ6IHsgbmFtZTogJ3N0cmluZycgfSxcbiAgcmVzdHJpY3Rpb246IFdTRExSZXN0cmljdGlvblNjaGVtYSxcbiAgJ3hzZDpyZXN0cmljdGlvbic6IFdTRExSZXN0cmljdGlvblNjaGVtYSxcbn0gYXMgY29uc3Q7XG5cbmNvbnN0IFdTRExFbGVtZW50U2NoZW1hID0ge1xuICAkOiB7XG4gICAgbmFtZTogJ3N0cmluZycsXG4gICAgdHlwZTogJ3N0cmluZycsXG4gICAgbWluT2NjdXJzOiAnP251bWJlcicsXG4gICAgbWF4T2NjdXJzOiAnP3N0cmluZycsXG4gICAgbmlsbGFibGU6ICc/Ym9vbGVhbicsXG4gIH0sXG59IGFzIGNvbnN0O1xuXG5jb25zdCBXU0RMU2VxdWVuY2VTY2hlbWEgPSB7XG4gIGVsZW1lbnQ6IFsnPycsIFdTRExFbGVtZW50U2NoZW1hXSxcbiAgJ3hzZDplbGVtZW50JzogWyc/JywgV1NETEVsZW1lbnRTY2hlbWFdLFxufSBhcyBjb25zdDtcblxuY29uc3QgV1NETEV4dGVuc2lvblNjaGVtYSA9IHtcbiAgJDogeyBiYXNlOiAnc3RyaW5nJyB9LFxuICBzZXF1ZW5jZTogeyAnPyc6IFdTRExTZXF1ZW5jZVNjaGVtYSB9LFxuICAneHNkOnNlcXVlbmNlJzogeyAnPyc6IFdTRExTZXF1ZW5jZVNjaGVtYSB9LFxufSBhcyBjb25zdDtcblxuY29uc3QgV1NETENvbXBsZXhDb250ZW50U2NoZW1hID0ge1xuICBleHRlbnNpb246IHsgJz8nOiBXU0RMRXh0ZW5zaW9uU2NoZW1hIH0sXG4gICd4c2Q6ZXh0ZW5zaW9uJzogeyAnPyc6IFdTRExFeHRlbnNpb25TY2hlbWEgfSxcbn0gYXMgY29uc3Q7XG5cbmNvbnN0IFdTRExDb21wbGV4VHlwZVNjaGVtYSA9IHtcbiAgJDogeyBuYW1lOiAnc3RyaW5nJyB9LFxuICBzZXF1ZW5jZTogeyAnPyc6IFdTRExTZXF1ZW5jZVNjaGVtYSB9LFxuICAneHNkOnNlcXVlbmNlJzogeyAnPyc6IFdTRExTZXF1ZW5jZVNjaGVtYSB9LFxuICBjb21wbGV4Q29udGVudDogeyAnPyc6IFdTRExDb21wbGV4Q29udGVudFNjaGVtYSB9LFxuICAneHNkOmNvbXBsZXhDb250ZW50JzogeyAnPyc6IFdTRExDb21wbGV4Q29udGVudFNjaGVtYSB9LFxufSBhcyBjb25zdDtcblxuY29uc3QgV1NETFNjaGVtYVNjaGVtYSA9IHtcbiAgJDogJ2FueScsXG4gIGNvbXBsZXhUeXBlOiBbJz8nLCAnYW55J10sXG4gIHNpbXBsZVR5cGU6IFsnPycsICdhbnknXSxcbiAgJ3hzZDpjb21wbGV4VHlwZSc6IFsnPycsICdhbnknXSxcbiAgJ3hzZDpzaW1wbGVUeXBlJzogWyc/JywgJ2FueSddLFxufSBhcyBjb25zdDtcblxuY29uc3QgV1NETFNjaGVtYSA9IHtcbiAgZGVmaW5pdGlvbnM6IHtcbiAgICAkOiAnYW55JyxcbiAgICB0eXBlczoge1xuICAgICAgc2NoZW1hOiBbJz8nLCBXU0RMU2NoZW1hU2NoZW1hXSxcbiAgICAgICd4c2Q6c2NoZW1hJzogWyc/JywgV1NETFNjaGVtYVNjaGVtYV0sXG4gICAgfSxcbiAgICBtZXNzYWdlOiBbJ2FueSddLFxuICAgIHBvcnRUeXBlOiB7XG4gICAgICAkOiAnYW55JyxcbiAgICAgIG9wZXJhdGlvbjogWydhbnknXSxcbiAgICB9LFxuICAgIGJpbmRpbmc6IHtcbiAgICAgICQ6ICdhbnknLFxuICAgICAgb3BlcmF0aW9uOiBbJ2FueSddLFxuICAgIH0sXG4gICAgc2VydmljZToge1xuICAgICAgJDogJ2FueScsXG4gICAgICBkb2N1bWVudGF0aW9uOiAnc3RyaW5nJyxcbiAgICAgIG9wZXJhdGlvbjogWydhbnknXSxcbiAgICB9LFxuICB9LFxufSBhcyBjb25zdDtcblxuLyoqXG4gKlxuICovXG50eXBlIFdTREwgPSBTb2FwU2NoZW1hRWxlbWVudFR5cGU8dHlwZW9mIFdTRExTY2hlbWE+O1xuXG50eXBlIFdTRExFbGVtZW50ID0gU29hcFNjaGVtYUVsZW1lbnRUeXBlPHR5cGVvZiBXU0RMRWxlbWVudFNjaGVtYT47XG5cbnR5cGUgV1NETFNpbXBsZVR5cGUgPSBTb2FwU2NoZW1hRWxlbWVudFR5cGU8dHlwZW9mIFdTRExTaW1wbGVUeXBlU2NoZW1hPjtcblxudHlwZSBXU0RMQ29tcGxleFR5cGUgPSBTb2FwU2NoZW1hRWxlbWVudFR5cGU8dHlwZW9mIFdTRExDb21wbGV4VHlwZVNjaGVtYT47XG5cbi8qKlxuICpcbiAqL1xuZnVuY3Rpb24gdG9Kc1R5cGUoeHNkVHlwZTogc3RyaW5nLCBzaW1wbGVUeXBlczogeyBbdHlwZTogc3RyaW5nXTogc3RyaW5nIH0pIHtcbiAgc3dpdGNoICh4c2RUeXBlKSB7XG4gICAgY2FzZSAneHNkOmJvb2xlYW4nOlxuICAgICAgcmV0dXJuICdib29sZWFuJztcbiAgICBjYXNlICd4c2Q6c3RyaW5nJzpcbiAgICBjYXNlICd4c2Q6ZGF0ZSc6XG4gICAgY2FzZSAneHNkOmRhdGVUaW1lJzpcbiAgICBjYXNlICd4c2Q6dGltZSc6XG4gICAgY2FzZSAneHNkOmJhc2U2NEJpbmFyeSc6XG4gICAgICByZXR1cm4gJ3N0cmluZyc7XG4gICAgY2FzZSAneHNkOmludCc6XG4gICAgY2FzZSAneHNkOmxvbmcnOlxuICAgIGNhc2UgJ3hzZDpkb3VibGUnOlxuICAgICAgcmV0dXJuICdudW1iZXInO1xuICAgIGNhc2UgJ3hzZDphbnlUeXBlJzpcbiAgICAgIHJldHVybiAnYW55JztcbiAgICBkZWZhdWx0OiB7XG4gICAgICBjb25zdCBbbnMsIHR5cGVdID0geHNkVHlwZS5zcGxpdCgnOicpO1xuICAgICAgaWYgKHNpbXBsZVR5cGVzW3R5cGVdKSB7XG4gICAgICAgIHJldHVybiBzaW1wbGVUeXBlc1t0eXBlXTtcbiAgICAgIH1cbiAgICAgIGlmIChucykge1xuICAgICAgICByZXR1cm4gdHlwZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB4c2RUeXBlO1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlYWRXU0RMRmlsZShmaWxlUGF0aDogc3RyaW5nKSB7XG4gIGNvbnN0IHhtbERhdGEgPSBhd2FpdCBmcy5yZWFkRmlsZShmaWxlUGF0aCwgJ3V0ZjgnKTtcbiAgY29uc3QganNvbiA9IGF3YWl0IHhtbDJqcy5wYXJzZVN0cmluZ1Byb21pc2UoeG1sRGF0YSwge1xuICAgIGV4cGxpY2l0QXJyYXk6IGZhbHNlLFxuICB9KTtcbiAgcmV0dXJuIGNhc3RUeXBlVXNpbmdTY2hlbWEoanNvbiwgV1NETFNjaGVtYSkgYXMgV1NETDtcbn1cblxuLyoqXG4gKlxuICovXG5mdW5jdGlvbiBnZXRUeXBlSW5mbyhlbDogV1NETEVsZW1lbnQsIHNpbXBsZVR5cGVzOiB7IFtuYW1lOiBzdHJpbmddOiBzdHJpbmcgfSkge1xuICBsZXQgdHlwZSA9IHRvSnNUeXBlKGVsLiQudHlwZSwgc2ltcGxlVHlwZXMpO1xuICBjb25zdCBpc0FycmF5ID0gZWwuJC5tYXhPY2N1cnMgPT09ICd1bmJvdW5kZWQnO1xuICBjb25zdCBuaWxsYWJsZSA9ICghaXNBcnJheSAmJiBlbC4kLm1pbk9jY3VycyA9PT0gMCkgfHwgZWwuJC5uaWxsYWJsZTtcbiAgcmV0dXJuIGlzQXJyYXlcbiAgICA/IG5pbGxhYmxlXG4gICAgICA/IFsnPycsIHR5cGVdXG4gICAgICA6IFt0eXBlXVxuICAgIDogbmlsbGFibGVcbiAgICA/IGA/JHt0eXBlfWBcbiAgICA6IHR5cGU7XG59XG5cbi8qKlxuICpcbiAqL1xuZnVuY3Rpb24gZXh0cmFjdENvbXBsZXhUeXBlcyh3c2RsOiBXU0RMKSB7XG4gIGNvbnNvbGUubG9nKHdzZGwuZGVmaW5pdGlvbnMudHlwZXNbJ3hzZDpzY2hlbWEnXSk7XG4gIGxldCBzY2hlbWFzOiB7IFtuYW1lOiBzdHJpbmddOiBTb2FwU2NoZW1hRGVmIH0gPSB7fTtcbiAgY29uc3Qgc2ltcGxlVHlwZXM6IHsgW3R5cGU6IHN0cmluZ106IHN0cmluZyB9ID0ge307XG4gIGNvbnN0IHR5cGVzID0gd3NkbC5kZWZpbml0aW9ucy50eXBlcztcbiAgZm9yIChjb25zdCBzYyBvZiB0eXBlcy5zY2hlbWEgPz8gdHlwZXNbJ3hzZDpzY2hlbWEnXSA/PyBbXSkge1xuICAgIGZvciAoY29uc3Qgc3Qgb2Ygc2Muc2ltcGxlVHlwZSA/PyBzY1sneHNkOnNpbXBsZVR5cGUnXSA/PyBbXSkge1xuICAgICAgY29uc3Qgc2ltcGxlVHlwZTogV1NETFNpbXBsZVR5cGUgPSBjYXN0VHlwZVVzaW5nU2NoZW1hKFxuICAgICAgICBzdCxcbiAgICAgICAgV1NETFNpbXBsZVR5cGVTY2hlbWEsXG4gICAgICApO1xuICAgICAgY29uc3QgcnMgPSBzaW1wbGVUeXBlLnJlc3RyaWN0aW9uID8/IHNpbXBsZVR5cGVbJ3hzZDpyZXN0cmljdGlvbiddO1xuICAgICAgY29uc3QgYmFzZSA9IHJzLiQuYmFzZS5zcGxpdCgnOicpWzFdO1xuICAgICAgc2ltcGxlVHlwZXNbc2ltcGxlVHlwZS4kLm5hbWVdID0gYmFzZTtcbiAgICB9XG4gIH1cbiAgY29uc29sZS5sb2coeyBzaW1wbGVUeXBlcyB9KTtcbiAgZm9yIChjb25zdCBzYyBvZiB0eXBlcy5zY2hlbWEgPz8gdHlwZXNbJ3hzZDpzY2hlbWEnXSA/PyBbXSkge1xuICAgIGZvciAoY29uc3QgY3Qgb2Ygc2MuY29tcGxleFR5cGUgPz8gc2NbJ3hzZDpjb21wbGV4VHlwZSddID8/IFtdKSB7XG4gICAgICBjb25zdCBjb21wbGV4VHlwZTogV1NETENvbXBsZXhUeXBlID0gY2FzdFR5cGVVc2luZ1NjaGVtYShcbiAgICAgICAgY3QsXG4gICAgICAgIFdTRExDb21wbGV4VHlwZVNjaGVtYSxcbiAgICAgICk7XG4gICAgICBjb25zdCBzY2hlbWE6IHtcbiAgICAgICAgdHlwZTogc3RyaW5nO1xuICAgICAgICBleHRlbmRzPzogc3RyaW5nO1xuICAgICAgICBwcm9wczogeyBbbmFtZTogc3RyaW5nXTogYW55IH07XG4gICAgICB9ID0ge1xuICAgICAgICB0eXBlOiBjb21wbGV4VHlwZS4kLm5hbWUsXG4gICAgICAgIHByb3BzOiB7fSxcbiAgICAgIH07XG4gICAgICBjb25zdCBzZXEgPSBjb21wbGV4VHlwZS5zZXF1ZW5jZSA/PyBjb21wbGV4VHlwZVsneHNkOnNlcXVlbmNlJ107XG4gICAgICBjb25zdCBlbHMgPSBzZXE/LmVsZW1lbnQgPz8gc2VxPy5bJ3hzZDplbGVtZW50J107XG4gICAgICBmb3IgKGNvbnN0IGVsIG9mIGVscyA/PyBbXSkge1xuICAgICAgICBzY2hlbWEucHJvcHNbZWwuJC5uYW1lXSA9IGdldFR5cGVJbmZvKGVsLCBzaW1wbGVUeXBlcyk7XG4gICAgICB9XG4gICAgICBjb25zdCBjYyA9XG4gICAgICAgIGNvbXBsZXhUeXBlLmNvbXBsZXhDb250ZW50ID8/IGNvbXBsZXhUeXBlWyd4c2Q6Y29tcGxleENvbnRlbnQnXTtcbiAgICAgIGlmIChjYykge1xuICAgICAgICBjb25zdCBleHRlbnNpb24gPSBjYy5leHRlbnNpb24gPz8gY2NbJ3hzZDpleHRlbnNpb24nXTtcbiAgICAgICAgaWYgKGV4dGVuc2lvbikge1xuICAgICAgICAgIHNjaGVtYS5leHRlbmRzID0gZXh0ZW5zaW9uLiQuYmFzZS5zcGxpdCgnOicpWzFdO1xuICAgICAgICAgIGNvbnN0IHNlcSA9IGV4dGVuc2lvbi5zZXF1ZW5jZSA/PyBleHRlbnNpb25bJ3hzZDpzZXF1ZW5jZSddO1xuICAgICAgICAgIGNvbnN0IGVscyA9IHNlcT8uZWxlbWVudCA/PyBzZXE/LlsneHNkOmVsZW1lbnQnXTtcbiAgICAgICAgICBmb3IgKGNvbnN0IGVsIG9mIGVscyA/PyBbXSkge1xuICAgICAgICAgICAgc2NoZW1hLnByb3BzW2VsLiQubmFtZV0gPSBnZXRUeXBlSW5mbyhlbCwgc2ltcGxlVHlwZXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgc2NoZW1hc1tjb21wbGV4VHlwZS4kLm5hbWVdID0gc2NoZW1hO1xuICAgIH1cbiAgfVxuICByZXR1cm4gc2NoZW1hcztcbn1cblxuLyoqXG4gKlxuICovXG5jb25zdCBHRU5FUkFURURfTUVTU0FHRV9DT01NRU5UID0gYC8qKlxuICogVGhpcyBmaWxlIGlzIGdlbmVyYXRlZCBmcm9tIFdTREwgZmlsZSBieSB3c2RsMnNjaGVtYS50cy5cbiAqIERvIG5vdCBtb2RpZnkgZGlyZWN0bHkuXG4gKiBUbyBnZW5lcmF0ZSB0aGUgZmlsZSwgcnVuIFwidHMtbm9kZSBwYXRoL3RvL3dzZGwyc2NoZW1hLnRzIHBhdGgvdG8vd3NkbC54bWwgcGF0aC90by9zY2hlbWEudHNcIlxuICovXG5gO1xuXG4vKipcbiAqXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGR1bXBTY2hlbWEoc2NoZW1hczogeyBbbmFtZTogc3RyaW5nXTogYW55IH0sIG91dEZpbGU6IHN0cmluZykge1xuICBjb25zdCBvdXQgPSBmcy5jcmVhdGVXcml0ZVN0cmVhbShvdXRGaWxlLCAndXRmOCcpO1xuICBjb25zdCBwcmludCA9IChzdHI6IHN0cmluZywgaW5kZW50OiBudW1iZXIgPSAwKSA9PiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmRlbnQ7IGkrKykge1xuICAgICAgb3V0LndyaXRlKCcgJyk7XG4gICAgfVxuICAgIG91dC53cml0ZShzdHIpO1xuICB9O1xuICBjb25zdCBwcmludGxuID0gKHN0cjogc3RyaW5nID0gJycsIGluZGVudDogbnVtYmVyID0gMCkgPT4ge1xuICAgIHByaW50KHN0ciArICdcXG4nLCBpbmRlbnQpO1xuICB9O1xuICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIG91dC5vbignZXJyb3InLCByZWplY3QpO1xuICAgIG91dC5vbignZmluaXNoJywgKCkgPT4gcmVzb2x2ZSgpKTtcbiAgICBwcmludGxuKEdFTkVSQVRFRF9NRVNTQUdFX0NPTU1FTlQpO1xuICAgIHByaW50KCdleHBvcnQgY29uc3QgQXBpU2NoZW1hcyA9ICcpO1xuICAgIHdyaXRlU2NoZW1hKHNjaGVtYXMpO1xuICAgIHByaW50bG4oJyBhcyBjb25zdDsnKTtcbiAgICBwcmludGxuKCk7XG4gICAgd3JpdGVUeXBlRGVmcyhzY2hlbWFzKTtcbiAgICBvdXQuZW5kKCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHdyaXRlU2NoZW1hKG86IGFueSwgaW5kZW50OiBudW1iZXIgPSAwKSB7XG4gICAgaWYgKGluZGVudCA+IDIwKSB7XG4gICAgICBwcmludChcIidhbnknXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShvKSkge1xuICAgICAgcHJpbnQoJ1snKTtcbiAgICAgIGxldCBpID0gMDtcbiAgICAgIGZvciAoY29uc3QgY28gb2Ygbykge1xuICAgICAgICBpZiAoaSA+IDApIHtcbiAgICAgICAgICBwcmludCgnLCAnKTtcbiAgICAgICAgfVxuICAgICAgICB3cml0ZVNjaGVtYShjbywgaW5kZW50KTtcbiAgICAgICAgaSsrO1xuICAgICAgfVxuICAgICAgcHJpbnQoJ10nKTtcbiAgICB9IGVsc2UgaWYgKGlzTWFwT2JqZWN0KG8pKSB7XG4gICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMobyk7XG4gICAgICBpZiAoa2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHByaW50bG4oJ3snKTtcbiAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIGtleXMpIHtcbiAgICAgICAgICBjb25zdCBjbyA9IG9bbmFtZV07XG4gICAgICAgICAgY29uc3QgbmFtZUlkID0gL15bXFx3XyRdKyQvLnRlc3QobmFtZSkgPyBuYW1lIDogYCcke25hbWV9J2A7XG4gICAgICAgICAgcHJpbnQoYCR7bmFtZUlkfTogYCwgaW5kZW50ICsgMik7XG4gICAgICAgICAgd3JpdGVTY2hlbWEoY28sIGluZGVudCArIDIpO1xuICAgICAgICAgIHByaW50bG4oJywnKTtcbiAgICAgICAgfVxuICAgICAgICBwcmludCgnfScsIGluZGVudCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcmludCgne30nKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcHJpbnQoSlNPTi5zdHJpbmdpZnkobykucmVwbGFjZSgvXCIvZywgXCInXCIpKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB3cml0ZVR5cGVEZWYoXG4gICAgbzogYW55LFxuICAgIHNjaGVtYXM6IHsgW25hbWU6IHN0cmluZ106IFNvYXBTY2hlbWFEZWYgfSxcbiAgICBpbmRlbnQ6IG51bWJlciA9IDAsXG4gICkge1xuICAgIGlmICh0eXBlb2YgbyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHByaW50KG8pO1xuICAgIH0gZWxzZSBpZiAoaXNNYXBPYmplY3QobykpIHtcbiAgICAgIGlmICgndHlwZScgaW4gbyAmJiAncHJvcHMnIGluIG8pIHtcbiAgICAgICAgaWYgKCdleHRlbmRzJyBpbiBvICYmIHR5cGVvZiBvLmV4dGVuZHMgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgcHJpbnQoYCR7by5leHRlbmRzfSAmIGApO1xuICAgICAgICB9XG4gICAgICAgIHdyaXRlVHlwZURlZihvLnByb3BzLCBzY2hlbWFzLCBpbmRlbnQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMobyk7XG4gICAgICBpZiAoa2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHByaW50bG4oJ3snKTtcbiAgICAgICAgZm9yIChjb25zdCBwcm9wIG9mIE9iamVjdC5rZXlzKG8pKSB7XG4gICAgICAgICAgbGV0IHZhbHVlOiBhbnkgPSBvW3Byb3BdO1xuICAgICAgICAgIGxldCBuaWxsYWJsZSA9IGZhbHNlO1xuICAgICAgICAgIGxldCBpc0FycmF5ID0gZmFsc2U7XG4gICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICBpc0FycmF5ID0gdHJ1ZTtcbiAgICAgICAgICAgIGNvbnN0IGxlbiA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICAgIGlmIChsZW4gPT09IDIgJiYgdmFsdWVbMF0gPT09ICc/Jykge1xuICAgICAgICAgICAgICBuaWxsYWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgIHZhbHVlID0gdmFsdWVbMV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAoaXNNYXBPYmplY3QodmFsdWUpKSB7XG4gICAgICAgICAgICBpZiAoJz8nIGluIHZhbHVlKSB7XG4gICAgICAgICAgICAgIG5pbGxhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZVsnPyddO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB2YWx1ZVswXSA9PT0gJz8nKSB7XG4gICAgICAgICAgICBuaWxsYWJsZSA9IHRydWU7XG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnN1YnN0cmluZygxKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcHJpbnQoYCR7cHJvcH0ke25pbGxhYmxlID8gJz8nIDogJyd9OiBgLCBpbmRlbnQgKyAyKTtcbiAgICAgICAgICB3cml0ZVR5cGVEZWYodmFsdWUsIHNjaGVtYXMsIGluZGVudCArIDIpO1xuICAgICAgICAgIGlmIChpc0FycmF5KSB7XG4gICAgICAgICAgICBwcmludCgnW10nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG5pbGxhYmxlKSB7XG4gICAgICAgICAgICBwcmludCgnIHwgbnVsbCB8IHVuZGVmaW5lZCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBwcmludGxuKCc7Jyk7XG4gICAgICAgIH1cbiAgICAgICAgcHJpbnQoJ30nLCBpbmRlbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcHJpbnQoJ3t9Jyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gd3JpdGVUeXBlRGVmcyhzY2hlbWFzOiB7IFtuYW1lOiBzdHJpbmddOiBTb2FwU2NoZW1hRGVmIH0pIHtcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmtleXMoc2NoZW1hcykpIHtcbiAgICAgIGNvbnN0IHNjaGVtYSA9IHNjaGVtYXNbbmFtZV07XG4gICAgICBwcmludChgZXhwb3J0IHR5cGUgJHtuYW1lfSA9IGApO1xuICAgICAgd3JpdGVUeXBlRGVmKHNjaGVtYSwgc2NoZW1hcyk7XG4gICAgICBwcmludGxuKCc7Jyk7XG4gICAgICBwcmludGxuKCk7XG4gICAgfVxuICAgIHByaW50bG4oJ2V4cG9ydCB0eXBlIEFwaVNjaGVtYVR5cGVzID0geycpO1xuICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3Qua2V5cyhzY2hlbWFzKSkge1xuICAgICAgcHJpbnRsbihgJHtuYW1lfTogJHtuYW1lfTtgLCAyKTtcbiAgICB9XG4gICAgcHJpbnRsbignfTsnKTtcbiAgfVxufVxuXG4vKipcbiAqXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIG1haW4oKSB7XG4gIGNvbnN0IHdzZGxGaWxlUGF0aCA9IHByb2Nlc3MuYXJndlsyXTtcbiAgaWYgKCF3c2RsRmlsZVBhdGgpIHtcbiAgICBjb25zb2xlLmVycm9yKCdObyBpbnB1dCBXU0RMIGZpbGUgaXMgc3BlY2lmaWVkLicpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBvdXRGaWxlUGF0aCA9IHByb2Nlc3MuYXJndlszXTtcbiAgaWYgKCF3c2RsRmlsZVBhdGgpIHtcbiAgICBjb25zb2xlLmVycm9yKCdObyBvdXRwdXQgdHlwZXNjcmlwdCBzY2hlbWEgZmlsZSBpcyBzcGVjaWZpZWQuJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHdzZGwgPSBhd2FpdCByZWFkV1NETEZpbGUod3NkbEZpbGVQYXRoKTtcbiAgY29uc3Qgc2NoZW1hcyA9IGV4dHJhY3RDb21wbGV4VHlwZXMod3NkbCk7XG4gIGR1bXBTY2hlbWEoc2NoZW1hcywgb3V0RmlsZVBhdGgpO1xufVxuXG5tYWluKCk7XG4iXX0=