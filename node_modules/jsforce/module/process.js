import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import "core-js/modules/es.promise";
import _mapInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/map";
import _JSON$stringify from "@babel/runtime-corejs3/core-js-stable/json/stringify";
import _Array$isArray from "@babel/runtime-corejs3/core-js-stable/array/is-array";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";

function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context; _forEachInstanceProperty(_context = ownKeys(Object(source), true)).call(_context, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context2; _forEachInstanceProperty(_context2 = ownKeys(Object(source))).call(_context2, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }

/**
 * @file Process class to manage/run workflow rule and approval process
 * @author Shinichi Tomita <shinichi.tomita@gmail.com>
 */

/**
 *
 */

/**
 *
 */

/**
 * A class which manages process (workflow) rules
 */
export class ProcessRule {
  /**
   *
   */
  constructor(conn) {
    _defineProperty(this, "_conn", void 0);

    this._conn = conn;
  }
  /**
   * Get all process rule definitions registered to sobjects
   */


  async list() {
    const res = await this._conn.request('/process/rules');
    return res.rules;
  }
  /**
   * Trigger process rule for given entities
   */


  trigger(contextIds) {
    const contextIds_ = _Array$isArray(contextIds) ? contextIds : [contextIds]; // https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/dome_process_rules_trigger.htm

    return this._conn.request({
      method: 'POST',
      url: '/process/rules/',
      body: _JSON$stringify({
        contextIds: contextIds_
      }),
      headers: {
        'content-type': 'application/json'
      }
    });
  }

}
/**
 *
 */

/**
 * A class which manages approval processes
 */
export class ApprovalProcess {
  /**
   *
   */
  constructor(conn) {
    _defineProperty(this, "_conn", void 0);

    this._conn = conn;
  }
  /**
   * Get all approval process definitions registered to sobjects
   */


  async list() {
    const res = await this._conn.request('/process/approvals');
    return res.approvals;
  }
  /**
   * Send bulk requests for approval process
   */


  request(requests) {
    const requests_ = _mapInstanceProperty(requests).call(requests, req => '_request' in req ? req._request : req);

    return this._conn.request({
      method: 'POST',
      url: '/process/approvals',
      headers: {
        'content-type': 'application/json'
      },
      body: _JSON$stringify({
        requests: requests_
      })
    });
  }
  /**
   * Create approval process request
   *
   * @private
   */


  _createRequest(actionType, contextId, comments, options = {}) {
    return new ApprovalProcessRequest(this, _objectSpread({
      actionType,
      contextId,
      comments
    }, options));
  }
  /**
   * Submit approval request for an item
   */


  submit(contextId, comments, options) {
    return this._createRequest('Submit', contextId, comments, options);
  }
  /**
   * Approve approval request for an item
   */


  approve(workitemId, comments, options = {}) {
    return this._createRequest('Approve', workitemId, comments, options);
  }
  /**
   * Reject approval request for an item
   */


  reject(workitemId, comments, options = {}) {
    return this._createRequest('Reject', workitemId, comments, options);
  }

}
/**
 *
 */

/**
 * A class representing approval process request
 */
class ApprovalProcessRequest {
  constructor(process, request) {
    _defineProperty(this, "_process", void 0);

    _defineProperty(this, "_request", void 0);

    _defineProperty(this, "_promise", void 0);

    this._process = process;
    this._request = request;
  }
  /**
   * Promise/A+ interface
   * http://promises-aplus.github.io/promises-spec/
   */


  then(onResolve, onReject) {
    if (!this._promise) {
      this._promise = this._process.request([this]).then(rets => rets[0]);
    }

    this._promise.then(onResolve, onReject);
  }

}
/**
 * A class which manages process rules and approval processes
 */


export class Process {
  /**
   *
   */
  constructor(conn) {
    _defineProperty(this, "rule", void 0);

    _defineProperty(this, "approval", void 0);

    this.rule = new ProcessRule(conn);
    this.approval = new ApprovalProcess(conn);
  }

}
export default Process;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wcm9jZXNzLnRzIl0sIm5hbWVzIjpbIlByb2Nlc3NSdWxlIiwiY29uc3RydWN0b3IiLCJjb25uIiwiX2Nvbm4iLCJsaXN0IiwicmVzIiwicmVxdWVzdCIsInJ1bGVzIiwidHJpZ2dlciIsImNvbnRleHRJZHMiLCJjb250ZXh0SWRzXyIsIm1ldGhvZCIsInVybCIsImJvZHkiLCJoZWFkZXJzIiwiQXBwcm92YWxQcm9jZXNzIiwiYXBwcm92YWxzIiwicmVxdWVzdHMiLCJyZXF1ZXN0c18iLCJyZXEiLCJfcmVxdWVzdCIsIl9jcmVhdGVSZXF1ZXN0IiwiYWN0aW9uVHlwZSIsImNvbnRleHRJZCIsImNvbW1lbnRzIiwib3B0aW9ucyIsIkFwcHJvdmFsUHJvY2Vzc1JlcXVlc3QiLCJzdWJtaXQiLCJhcHByb3ZlIiwid29ya2l0ZW1JZCIsInJlamVjdCIsInByb2Nlc3MiLCJfcHJvY2VzcyIsInRoZW4iLCJvblJlc29sdmUiLCJvblJlamVjdCIsIl9wcm9taXNlIiwicmV0cyIsIlByb2Nlc3MiLCJydWxlIiwiYXBwcm92YWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBOztBQUlBO0FBQ0E7QUFDQTs7QUFPQTtBQUNBO0FBQ0E7O0FBVUE7QUFDQTtBQUNBO0FBQ0EsT0FBTyxNQUFNQSxXQUFOLENBQW9DO0FBR3pDO0FBQ0Y7QUFDQTtBQUNFQyxFQUFBQSxXQUFXLENBQUNDLElBQUQsRUFBc0I7QUFBQTs7QUFDL0IsU0FBS0MsS0FBTCxHQUFhRCxJQUFiO0FBQ0Q7QUFFRDtBQUNGO0FBQ0E7OztBQUNFLFFBQU1FLElBQU4sR0FBYTtBQUNYLFVBQU1DLEdBQUcsR0FBRyxNQUFNLEtBQUtGLEtBQUwsQ0FBV0csT0FBWCxDQUNoQixnQkFEZ0IsQ0FBbEI7QUFHQSxXQUFPRCxHQUFHLENBQUNFLEtBQVg7QUFDRDtBQUVEO0FBQ0Y7QUFDQTs7O0FBQ0VDLEVBQUFBLE9BQU8sQ0FBQ0MsVUFBRCxFQUFnQztBQUNy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QUE7O0FBQUE7O0FBQUE7O0FBQ0EsU0FBSzBCLFFBQUwsR0FBZ0JELE9BQWhCO0FBQ0EsU0FBS1gsUUFBTCxHQUFnQmQsT0FBaEI7QUFDRDtBQUVEO0FBQ0Y7QUFDQTtBQUNBOzs7QUFDRTJCLEVBQUFBLElBQUksQ0FDRkMsU0FERSxFQUlGQyxRQUpFLEVBS0Y7QUFDQSxRQUFJLENBQUMsS0FBS0MsUUFBVixFQUFvQjtBQUNsQixXQUFLQSxRQUFMLEdBQWdCLEtBQUtKLFFBQUwsQ0FDYjFCLE9BRGEsQ0FDTCxDQUFDLElBQUQsQ0FESyxFQUViMkIsSUFGYSxDQUVQSSxJQUFELElBQWVBLElBQUksQ0FBQyxDQUFELENBRlgsQ0FBaEI7QUFHRDs7QUFDRCxTQUFLRCxRQUFMLENBQWNILElBQWQsQ0FBbUJDLFNBQW5CLEVBQThCQyxRQUE5QjtBQUNEOztBQTdCNEM7QUFnQy9DO0FBQ0E7QUFDQTs7O0FBQ0EsT0FBTyxNQUFNRyxPQUFOLENBQWdDO0FBSXJDO0FBQ0Y7QUFDQTtBQUNFckMsRUFBQUEsV0FBVyxDQUFDQyxJQUFELEVBQXNCO0FBQUE7O0FBQUE7O0FBQy9CLFNBQUtxQyxJQUFMLEdBQVksSUFBSXZDLFdBQUosQ0FBZ0JFLElBQWhCLENBQVo7QUFDQSxTQUFLc0MsUUFBTCxHQUFnQixJQUFJekIsZUFBSixDQUFvQmIsSUFBcEIsQ0FBaEI7QUFDRDs7QUFWb0M7QUFhdkMsZUFBZW9DLE9BQWYiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIFByb2Nlc3MgY2xhc3MgdG8gbWFuYWdlL3J1biB3b3JrZmxvdyBydWxlIGFuZCBhcHByb3ZhbCBwcm9jZXNzXG4gKiBAYXV0aG9yIFNoaW5pY2hpIFRvbWl0YSA8c2hpbmljaGkudG9taXRhQGdtYWlsLmNvbT5cbiAqL1xuaW1wb3J0IENvbm5lY3Rpb24gZnJvbSAnLi9jb25uZWN0aW9uJztcbmltcG9ydCB7IFByb2Nlc3NSdWxlcywgU2NoZW1hIH0gZnJvbSAnLi90eXBlcyc7XG5cbi8qKlxuICpcbiAqL1xuZXhwb3J0IHR5cGUgUHJvY2Vzc1J1bGVEZWZpbml0aW9uID0ge1xuICBpZDogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG4gIG9iamVjdDogc3RyaW5nO1xufTtcblxuLyoqXG4gKlxuICovXG5leHBvcnQgdHlwZSBQcm9jZXNzUnVsZVRyaWdnZXJSZXN1bHQgPVxuICB8IHtcbiAgICAgIHN1Y2Nlc3M6IHRydWU7XG4gICAgfVxuICB8IHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlO1xuICAgICAgZXJyb3JzOiBBcnJheTx7IG1lc3NhZ2U6IHN0cmluZyB9PjtcbiAgICB9O1xuXG4vKipcbiAqIEEgY2xhc3Mgd2hpY2ggbWFuYWdlcyBwcm9jZXNzICh3b3JrZmxvdykgcnVsZXNcbiAqL1xuZXhwb3J0IGNsYXNzIFByb2Nlc3NSdWxlPFMgZXh0ZW5kcyBTY2hlbWE+IHtcbiAgX2Nvbm46IENvbm5lY3Rpb248Uz47XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25uOiBDb25uZWN0aW9uPFM+KSB7XG4gICAgdGhpcy5fY29ubiA9IGNvbm47XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBwcm9jZXNzIHJ1bGUgZGVmaW5pdGlvbnMgcmVnaXN0ZXJlZCB0byBzb2JqZWN0c1xuICAgKi9cbiAgYXN5bmMgbGlzdCgpIHtcbiAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLl9jb25uLnJlcXVlc3Q8eyBydWxlczogUHJvY2Vzc1J1bGVzIH0+KFxuICAgICAgJy9wcm9jZXNzL3J1bGVzJyxcbiAgICApO1xuICAgIHJldHVybiByZXMucnVsZXM7XG4gIH1cblxuICAvKipcbiAgICogVHJpZ2dlciBwcm9jZXNzIHJ1bGUgZm9yIGdpdmVuIGVudGl0aWVzXG4gICAqL1xuICB0cmlnZ2VyKGNvbnRleHRJZHM6IHN0cmluZyB8IHN0cmluZ1tdKSB7XG4gICAgY29uc3QgY29udGV4dElkc18gPSBBcnJheS5pc0FycmF5KGNvbnRleHRJZHMpID8gY29udGV4dElkcyA6IFtjb250ZXh0SWRzXTtcbiAgICAvLyBodHRwczovL2RldmVsb3Blci5zYWxlc2ZvcmNlLmNvbS9kb2NzL2F0bGFzLmVuLXVzLmFwaV9yZXN0Lm1ldGEvYXBpX3Jlc3QvZG9tZV9wcm9jZXNzX3J1bGVzX3RyaWdnZXIuaHRtXG4gICAgcmV0dXJuIHRoaXMuX2Nvbm4ucmVxdWVzdDxcbiAgICAgIHwge1xuICAgICAgICAgIGVycm9yczogbnVsbDtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlO1xuICAgICAgICB9XG4gICAgICB8IHtcbiAgICAgICAgICAvLyBEb2NzIGRvbid0IHNheSB3aGF0IHRoZSB0cmlnZ2VyIGVycm9ycyBhcmVcbiAgICAgICAgICBlcnJvcnM6IGFueVtdO1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlO1xuICAgICAgICB9XG4gICAgPih7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIHVybDogJy9wcm9jZXNzL3J1bGVzLycsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGNvbnRleHRJZHM6IGNvbnRleHRJZHNfLFxuICAgICAgfSksXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICpcbiAqL1xuZXhwb3J0IHR5cGUgQXBwcm92YWxQcm9jZXNzRGVmaW5pdGlvbiA9IHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBvYmplY3Q6IHN0cmluZztcbiAgc29ydE9yZGVyOiBudW1iZXI7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsO1xufTtcblxuLyoqXG4gKlxuICovXG5leHBvcnQgdHlwZSBBcHByb3ZhbFByb2Nlc3NSZXF1ZXN0UmVzdWx0ID1cbiAgfCB7XG4gICAgICBzdWNjZXNzOiB0cnVlO1xuICAgICAgYWN0b3JJZHM6IHN0cmluZ1tdO1xuICAgICAgZW50aXR5SWQ6IHN0cmluZztcbiAgICAgIGluc3RhbmNlSWQ6IHN0cmluZztcbiAgICAgIGluc3RhbmNlU3RhdHVzOiBzdHJpbmc7XG4gICAgICBuZXdXb3JrSXRlbUlkczogc3RyaW5nW107XG4gICAgfVxuICB8IHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlO1xuICAgICAgZXJyb3JzOiBBcnJheTx7IG1lc3NhZ2U6IHN0cmluZyB9PjtcbiAgICB9O1xuXG4vKipcbiAqXG4gKi9cbmV4cG9ydCB0eXBlIEFwcHJvdmFsUHJvY2Vzc0FjdGlvbk9wdGlvbnMgPSB7XG4gIHByb2Nlc3NEZWZpbml0aW9uTmFtZU9ySWQ/OiBzdHJpbmc7XG4gIHNraXBFbnRyeUNyaXRlcmlhPzogYm9vbGVhbjtcbn07XG5cbi8qKlxuICogQSBjbGFzcyB3aGljaCBtYW5hZ2VzIGFwcHJvdmFsIHByb2Nlc3Nlc1xuICovXG5leHBvcnQgY2xhc3MgQXBwcm92YWxQcm9jZXNzPFMgZXh0ZW5kcyBTY2hlbWE+IHtcbiAgX2Nvbm46IENvbm5lY3Rpb248Uz47XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25uOiBDb25uZWN0aW9uPFM+KSB7XG4gICAgdGhpcy5fY29ubiA9IGNvbm47XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBhcHByb3ZhbCBwcm9jZXNzIGRlZmluaXRpb25zIHJlZ2lzdGVyZWQgdG8gc29iamVjdHNcbiAgICovXG4gIGFzeW5jIGxpc3QoKSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5fY29ubi5yZXF1ZXN0PHtcbiAgICAgIGFwcHJvdmFsczogeyBbaW5kZXg6IHN0cmluZ106IEFwcHJvdmFsUHJvY2Vzc0RlZmluaXRpb24gfTtcbiAgICB9PignL3Byb2Nlc3MvYXBwcm92YWxzJyk7XG4gICAgcmV0dXJuIHJlcy5hcHByb3ZhbHM7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBidWxrIHJlcXVlc3RzIGZvciBhcHByb3ZhbCBwcm9jZXNzXG4gICAqL1xuICByZXF1ZXN0KFxuICAgIHJlcXVlc3RzOiBBcnJheTxBcHByb3ZhbFByb2Nlc3NSZXF1ZXN0Q29uZmlnIHwgQXBwcm92YWxQcm9jZXNzUmVxdWVzdDxTPj4sXG4gICkge1xuICAgIGNvbnN0IHJlcXVlc3RzXyA9IHJlcXVlc3RzLm1hcCgocmVxKSA9PlxuICAgICAgJ19yZXF1ZXN0JyBpbiByZXEgPyByZXEuX3JlcXVlc3QgOiByZXEsXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5fY29ubi5yZXF1ZXN0PEFwcHJvdmFsUHJvY2Vzc1JlcXVlc3RSZXN1bHRbXT4oe1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICB1cmw6ICcvcHJvY2Vzcy9hcHByb3ZhbHMnLFxuICAgICAgaGVhZGVyczogeyAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHJlcXVlc3RzOiByZXF1ZXN0c18gfSksXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGFwcHJvdmFsIHByb2Nlc3MgcmVxdWVzdFxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX2NyZWF0ZVJlcXVlc3QoXG4gICAgYWN0aW9uVHlwZTogJ1N1Ym1pdCcgfCAnQXBwcm92ZScgfCAnUmVqZWN0JyxcbiAgICBjb250ZXh0SWQ6IHN0cmluZyxcbiAgICBjb21tZW50cz86IHN0cmluZyxcbiAgICBvcHRpb25zOiBBcHByb3ZhbFByb2Nlc3NBY3Rpb25PcHRpb25zID0ge30sXG4gICkge1xuICAgIHJldHVybiBuZXcgQXBwcm92YWxQcm9jZXNzUmVxdWVzdCh0aGlzLCB7XG4gICAgICBhY3Rpb25UeXBlLFxuICAgICAgY29udGV4dElkLFxuICAgICAgY29tbWVudHMsXG4gICAgICAuLi5vcHRpb25zLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFN1Ym1pdCBhcHByb3ZhbCByZXF1ZXN0IGZvciBhbiBpdGVtXG4gICAqL1xuICBzdWJtaXQoXG4gICAgY29udGV4dElkOiBzdHJpbmcsXG4gICAgY29tbWVudHM/OiBzdHJpbmcsXG4gICAgb3B0aW9ucz86IEFwcHJvdmFsUHJvY2Vzc0FjdGlvbk9wdGlvbnMsXG4gICkge1xuICAgIHJldHVybiB0aGlzLl9jcmVhdGVSZXF1ZXN0KCdTdWJtaXQnLCBjb250ZXh0SWQsIGNvbW1lbnRzLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBcHByb3ZlIGFwcHJvdmFsIHJlcXVlc3QgZm9yIGFuIGl0ZW1cbiAgICovXG4gIGFwcHJvdmUoXG4gICAgd29ya2l0ZW1JZDogc3RyaW5nLFxuICAgIGNvbW1lbnRzPzogc3RyaW5nLFxuICAgIG9wdGlvbnM6IEFwcHJvdmFsUHJvY2Vzc0FjdGlvbk9wdGlvbnMgPSB7fSxcbiAgKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NyZWF0ZVJlcXVlc3QoJ0FwcHJvdmUnLCB3b3JraXRlbUlkLCBjb21tZW50cywgb3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogUmVqZWN0IGFwcHJvdmFsIHJlcXVlc3QgZm9yIGFuIGl0ZW1cbiAgICovXG4gIHJlamVjdChcbiAgICB3b3JraXRlbUlkOiBzdHJpbmcsXG4gICAgY29tbWVudHM/OiBzdHJpbmcsXG4gICAgb3B0aW9uczogQXBwcm92YWxQcm9jZXNzQWN0aW9uT3B0aW9ucyA9IHt9LFxuICApIHtcbiAgICByZXR1cm4gdGhpcy5fY3JlYXRlUmVxdWVzdCgnUmVqZWN0Jywgd29ya2l0ZW1JZCwgY29tbWVudHMsIG9wdGlvbnMpO1xuICB9XG59XG5cbi8qKlxuICpcbiAqL1xuZXhwb3J0IHR5cGUgQXBwcm92YWxQcm9jZXNzUmVxdWVzdENvbmZpZyA9IHtcbiAgYWN0aW9uVHlwZTogJ1N1Ym1pdCcgfCAnQXBwcm92ZScgfCAnUmVqZWN0JztcbiAgY29udGV4dElkOiBzdHJpbmc7XG4gIGNvbW1lbnRzPzogc3RyaW5nO1xuICBuZXh0QXBwcm92ZXJJZHM/OiBzdHJpbmdbXTtcbiAgcHJvY2Vzc0RlZmluaXRpb25OYW1lT3JJZD86IHN0cmluZztcbiAgc2tpcEVudHJ5Q3JpdGVyaWE/OiBib29sZWFuO1xufTtcblxuLyoqXG4gKiBBIGNsYXNzIHJlcHJlc2VudGluZyBhcHByb3ZhbCBwcm9jZXNzIHJlcXVlc3RcbiAqL1xuY2xhc3MgQXBwcm92YWxQcm9jZXNzUmVxdWVzdDxTIGV4dGVuZHMgU2NoZW1hPiB7XG4gIF9wcm9jZXNzOiBBcHByb3ZhbFByb2Nlc3M8Uz47XG4gIF9yZXF1ZXN0OiBBcHByb3ZhbFByb2Nlc3NSZXF1ZXN0Q29uZmlnO1xuICBfcHJvbWlzZTogUHJvbWlzZTxBcHByb3ZhbFByb2Nlc3NSZXF1ZXN0UmVzdWx0PiB8IHVuZGVmaW5lZDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm9jZXNzOiBBcHByb3ZhbFByb2Nlc3M8Uz4sXG4gICAgcmVxdWVzdDogQXBwcm92YWxQcm9jZXNzUmVxdWVzdENvbmZpZyxcbiAgKSB7XG4gICAgdGhpcy5fcHJvY2VzcyA9IHByb2Nlc3M7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICAvKipcbiAgICogUHJvbWlzZS9BKyBpbnRlcmZhY2VcbiAgICogaHR0cDovL3Byb21pc2VzLWFwbHVzLmdpdGh1Yi5pby9wcm9taXNlcy1zcGVjL1xuICAgKi9cbiAgdGhlbjxVPihcbiAgICBvblJlc29sdmU/OiAoXG4gICAgICByZXM6IEFwcHJvdmFsUHJvY2Vzc1JlcXVlc3RSZXN1bHQsXG4gICAgKSA9PiBVIHwgUHJvbWlzZUxpa2U8VT4gfCBudWxsLFxuICAgIG9uUmVqZWN0PzogKGVycjogYW55KSA9PiBVIHwgUHJvbWlzZUxpa2U8VT4gfCBudWxsLFxuICApIHtcbiAgICBpZiAoIXRoaXMuX3Byb21pc2UpIHtcbiAgICAgIHRoaXMuX3Byb21pc2UgPSB0aGlzLl9wcm9jZXNzXG4gICAgICAgIC5yZXF1ZXN0KFt0aGlzXSlcbiAgICAgICAgLnRoZW4oKHJldHM6IGFueSkgPT4gcmV0c1swXSk7XG4gICAgfVxuICAgIHRoaXMuX3Byb21pc2UudGhlbihvblJlc29sdmUsIG9uUmVqZWN0KTtcbiAgfVxufVxuXG4vKipcbiAqIEEgY2xhc3Mgd2hpY2ggbWFuYWdlcyBwcm9jZXNzIHJ1bGVzIGFuZCBhcHByb3ZhbCBwcm9jZXNzZXNcbiAqL1xuZXhwb3J0IGNsYXNzIFByb2Nlc3M8UyBleHRlbmRzIFNjaGVtYT4ge1xuICBydWxlOiBQcm9jZXNzUnVsZTxTPjtcbiAgYXBwcm92YWw6IEFwcHJvdmFsUHJvY2VzczxTPjtcblxuICAvKipcbiAgICpcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNvbm46IENvbm5lY3Rpb248Uz4pIHtcbiAgICB0aGlzLnJ1bGUgPSBuZXcgUHJvY2Vzc1J1bGUoY29ubik7XG4gICAgdGhpcy5hcHByb3ZhbCA9IG5ldyBBcHByb3ZhbFByb2Nlc3MoY29ubik7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUHJvY2VzcztcbiJdfQ==