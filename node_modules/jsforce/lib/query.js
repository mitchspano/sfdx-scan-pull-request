"use strict";

var _interopRequireWildcard = require("@babel/runtime-corejs3/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime-corejs3/helpers/interopRequireDefault");

var _Object$defineProperty = require("@babel/runtime-corejs3/core-js-stable/object/define-property");

var _Object$defineProperties = require("@babel/runtime-corejs3/core-js-stable/object/define-properties");

var _Object$getOwnPropertyDescriptors = require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors");

var _forEachInstanceProperty = require("@babel/runtime-corejs3/core-js-stable/instance/for-each");

var _Object$getOwnPropertyDescriptor = require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor");

var _filterInstanceProperty = require("@babel/runtime-corejs3/core-js-stable/instance/filter");

var _Object$getOwnPropertySymbols = require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols");

var _Object$keys2 = require("@babel/runtime-corejs3/core-js-stable/object/keys");

require("core-js/modules/es.array.iterator");

require("core-js/modules/es.array.sort");

require("core-js/modules/es.promise");

_Object$defineProperty(exports, "__esModule", {
  value: true
});

exports.default = exports.SubQuery = exports.Query = exports.ResponseTargets = void 0;

var _slice = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/slice"));

var _concat = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/concat"));

var _keys = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/keys"));

var _entries = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/entries"));

var _map = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/map"));

var _isArray = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/array/is-array"));

var _promise = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/promise"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime-corejs3/helpers/objectWithoutProperties"));

var _includes = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/includes"));

var _sort = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/sort"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime-corejs3/helpers/defineProperty"));

var _reduce = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/reduce"));

var _events = require("events");

var _logger = require("./util/logger");

var _recordStream = _interopRequireWildcard(require("./record-stream"));

var _soqlBuilder = require("./soql-builder");

function ownKeys(object, enumerableOnly) { var keys = _Object$keys2(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context13; _forEachInstanceProperty(_context13 = ownKeys(Object(source), true)).call(_context13, function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context14; _forEachInstanceProperty(_context14 = ownKeys(Object(source))).call(_context14, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }

const ResponseTargetValues = ['QueryResult', 'Records', 'SingleRecord', 'Count'];
const ResponseTargets = (0, _reduce.default)(ResponseTargetValues).call(ResponseTargetValues, (values, target) => _objectSpread(_objectSpread({}, values), {}, {
  [target]: target
}), {});
exports.ResponseTargets = ResponseTargets;

/**
 *
 */
const DEFAULT_BULK_THRESHOLD = 200;
/**
 * Query
 */

class Query extends _events.EventEmitter {
  /**
   *
   */
  constructor(conn, config, options) {
    super();
    (0, _defineProperty2.default)(this, "_conn", void 0);
    (0, _defineProperty2.default)(this, "_logger", void 0);
    (0, _defineProperty2.default)(this, "_soql", void 0);
    (0, _defineProperty2.default)(this, "_locator", void 0);
    (0, _defineProperty2.default)(this, "_config", {});
    (0, _defineProperty2.default)(this, "_children", []);
    (0, _defineProperty2.default)(this, "_options", void 0);
    (0, _defineProperty2.default)(this, "_executed", false);
    (0, _defineProperty2.default)(this, "_finished", false);
    (0, _defineProperty2.default)(this, "_chaining", false);
    (0, _defineProperty2.default)(this, "_promise", void 0);
    (0, _defineProperty2.default)(this, "_stream", void 0);
    (0, _defineProperty2.default)(this, "totalSize", 0);
    (0, _defineProperty2.default)(this, "totalFetched", 0);
    (0, _defineProperty2.default)(this, "records", []);
    (0, _defineProperty2.default)(this, "offset", this.skip);
    (0, _defineProperty2.default)(this, "orderby", (0, _sort.default)(this));
    (0, _defineProperty2.default)(this, "exec", this.execute);
    (0, _defineProperty2.default)(this, "run", this.execute);
    (0, _defineProperty2.default)(this, "delete", this.destroy);
    (0, _defineProperty2.default)(this, "del", this.destroy);
    this._conn = conn;
    this._logger = conn._logLevel ? Query._logger.createInstance(conn._logLevel) : Query._logger;

    if (typeof config === 'string') {
      this._soql = config;

      this._logger.debug(`config is soql: ${config}`);
    } else if (typeof config.locator === 'string') {
      const locator = config.locator;

      this._logger.debug(`config is locator: ${locator}`);

      this._locator = (0, _includes.default)(locator).call(locator, '/') ? this.urlToLocator(locator) : locator;
    } else {
      this._logger.debug(`config is QueryConfig: ${config}`);

      const _ref = config,
            {
        fields,
        includes,
        sort
      } = _ref,
            _config = (0, _objectWithoutProperties2.default)(_ref, ["fields", "includes", "sort"]);

      this._config = _config;
      this.select(fields);

      if (includes) {
        this.includeChildren(includes);
      }

      if (sort) {
        var _context;

        (0, _sort.default)(_context = this).call(_context, sort);
      }
    }

    this._options = _objectSpread({
      headers: {},
      maxFetch: 10000,
      autoFetch: false,
      scanAll: false,
      responseTarget: 'QueryResult'
    }, options || {}); // promise instance

    this._promise = new _promise.default((resolve, reject) => {
      this.on('response', resolve);
      this.on('error', reject);
    });
    this._stream = new _recordStream.Serializable();
    this.on('record', record => this._stream.push(record));
    this.on('end', () => this._stream.push(null));
    this.on('error', err => {
      try {
        this._stream.emit('error', err);
      } catch (e) {// eslint-disable-line no-empty
      }
    });
  }
  /**
   * Select fields to include in the returning result
   */


  select(fields = '*') {
    if (this._soql) {
      throw Error('Cannot set select fields for the query which has already built SOQL.');
    }

    function toFieldArray(fields) {
      var _context2, _context3, _context4, _context5;

      return typeof fields === 'string' ? fields.split(/\s*,\s*/) : (0, _isArray.default)(fields) ? (0, _reduce.default)(_context2 = (0, _map.default)(_context3 = fields).call(_context3, toFieldArray)).call(_context2, (fs, f) => [...fs, ...f], []) : (0, _reduce.default)(_context4 = (0, _map.default)(_context5 = (0, _entries.default)(fields)).call(_context5, ([f, v]) => {
        if (typeof v === 'number' || typeof v === 'boolean') {
          return v ? [f] : [];
        } else {
          var _context6;

          return (0, _map.default)(_context6 = toFieldArray(v)).call(_context6, p => `${f}.${p}`);
        }
      })).call(_context4, (fs, f) => [...fs, ...f], []);
    }

    if (fields) {
      this._config.fields = toFieldArray(fields);
    } // force convert query record type without changing instance;


    return this;
  }
  /**
   * Set query conditions to filter the result records
   */


  where(conditions) {
    if (this._soql) {
      throw Error('Cannot set where conditions for the query which has already built SOQL.');
    }

    this._config.conditions = conditions;
    return this;
  }
  /**
   * Limit the returning result
   */


  limit(limit) {
    if (this._soql) {
      throw Error('Cannot set limit for the query which has already built SOQL.');
    }

    this._config.limit = limit;
    return this;
  }
  /**
   * Skip records
   */


  skip(offset) {
    if (this._soql) {
      throw Error('Cannot set skip/offset for the query which has already built SOQL.');
    }

    this._config.offset = offset;
    return this;
  }
  /**
   * Synonym of Query#skip()
   */


  sort(sort, dir) {
    if (this._soql) {
      throw Error('Cannot set sort for the query which has already built SOQL.');
    }

    if (typeof sort === 'string' && typeof dir !== 'undefined') {
      this._config.sort = [[sort, dir]];
    } else {
      this._config.sort = sort;
    }

    return this;
  }
  /**
   * Synonym of Query#sort()
   */


  include(childRelName, conditions, fields, options = {}) {
    if (this._soql) {
      throw Error('Cannot include child relationship into the query which has already built SOQL.');
    }

    const childConfig = {
      fields: fields === null ? undefined : fields,
      table: childRelName,
      conditions: conditions === null ? undefined : conditions,
      limit: options.limit,
      offset: options.offset,
      sort: (0, _sort.default)(options)
    }; // eslint-disable-next-line no-use-before-define

    const childQuery = new SubQuery(this._conn, childRelName, childConfig, this);

    this._children.push(childQuery);

    return childQuery;
  }
  /**
   * Include child relationship queries, but not moving down to the children context
   */


  includeChildren(includes) {
    if (this._soql) {
      throw Error('Cannot include child relationship into the query which has already built SOQL.');
    }

    for (const crname of (0, _keys.default)(includes)) {
      const _ref2 = includes[crname],
            {
        conditions,
        fields
      } = _ref2,
            options = (0, _objectWithoutProperties2.default)(_ref2, ["conditions", "fields"]);
      this.include(crname, conditions, fields, options);
    }

    return this;
  }
  /**
   * Setting maxFetch query option
   */


  maxFetch(maxFetch) {
    this._options.maxFetch = maxFetch;
    return this;
  }
  /**
   * Switching auto fetch mode
   */


  autoFetch(autoFetch) {
    this._options.autoFetch = autoFetch;
    return this;
  }
  /**
   * Set flag to scan all records including deleted and archived.
   */


  scanAll(scanAll) {
    this._options.scanAll = scanAll;
    return this;
  }
  /**
   *
   */


  setResponseTarget(responseTarget) {
    if (responseTarget in ResponseTargets) {
      this._options.responseTarget = responseTarget;
    } // force change query response target without changing instance


    return this;
  }
  /**
   * Execute query and fetch records from server.
   */


  execute(options_ = {}) {
    if (this._executed) {
      throw new Error('re-executing already executed query');
    }

    if (this._finished) {
      throw new Error('executing already closed query');
    }

    const options = {
      headers: options_.headers || this._options.headers,
      responseTarget: options_.responseTarget || this._options.responseTarget,
      autoFetch: options_.autoFetch || this._options.autoFetch,
      maxFetch: options_.maxFetch || this._options.maxFetch,
      scanAll: options_.scanAll || this._options.scanAll
    }; // collect fetched records in array
    // only when response target is Records and
    // either callback or chaining promises are available to this query.

    this.once('fetch', () => {
      if (options.responseTarget === ResponseTargets.Records && this._chaining) {
        this._logger.debug('--- collecting all fetched records ---');

        const records = [];

        const onRecord = record => records.push(record);

        this.on('record', onRecord);
        this.once('end', () => {
          this.removeListener('record', onRecord);
          this.emit('response', records, this);
        });
      }
    }); // flag to prevent re-execution

    this._executed = true;

    (async () => {
      // start actual query
      this._logger.debug('>>> Query start >>>');

      try {
        await this._execute(options);

        this._logger.debug('*** Query finished ***');
      } catch (error) {
        this._logger.debug('--- Query error ---', error);

        this.emit('error', error);
      }
    })(); // return Query instance for chaining


    return this;
  }
  /**
   * Synonym of Query#execute()
   */


  locatorToUrl() {
    return this._locator ? [this._conn._baseUrl(), '/query/', this._locator].join('') : '';
  }

  urlToLocator(url) {
    return url.split('/').pop();
  }

  constructResponse(rawDone, responseTarget) {
    var _this$records$, _this$records;

    switch (responseTarget) {
      case 'Count':
        return this.totalSize;

      case 'SingleRecord':
        return (_this$records$ = (_this$records = this.records) === null || _this$records === void 0 ? void 0 : _this$records[0]) !== null && _this$records$ !== void 0 ? _this$records$ : null;

      case 'Records':
        return this.records;
      // QueryResult is default response target

      default:
        return _objectSpread(_objectSpread({}, {
          records: this.records,
          totalSize: this.totalSize,
          done: rawDone !== null && rawDone !== void 0 ? rawDone : true // when no records, done is omitted

        }), this._locator ? {
          nextRecordsUrl: this.locatorToUrl()
        } : {});
    }
  }
  /**
   * @private
   */


  async _execute(options) {
    var _this$records2, _context7, _data$records$length, _data$records;

    const {
      headers,
      responseTarget,
      autoFetch,
      maxFetch,
      scanAll
    } = options;

    this._logger.debug('execute with options', options);

    let url;

    if (this._locator) {
      url = this.locatorToUrl();
    } else {
      const soql = await this.toSOQL();

      this._logger.debug(`SOQL = ${soql}`);

      url = [this._conn._baseUrl(), '/', scanAll ? 'queryAll' : 'query', '?q=', encodeURIComponent(soql)].join('');
    }

    const data = await this._conn.request({
      method: 'GET',
      url,
      headers
    });
    this.emit('fetch');
    this.totalSize = data.totalSize;
    this.records = (_this$records2 = this.records) === null || _this$records2 === void 0 ? void 0 : (0, _concat.default)(_this$records2).call(_this$records2, maxFetch - this.records.length > data.records.length ? data.records : (0, _slice.default)(_context7 = data.records).call(_context7, 0, maxFetch - this.records.length));
    this._locator = data.nextRecordsUrl ? this.urlToLocator(data.nextRecordsUrl) : undefined;
    this._finished = this._finished || data.done || !autoFetch || // this is what the response looks like when there are no results
    data.records.length === 0 && data.done === undefined; // streaming record instances

    const numRecords = (_data$records$length = (_data$records = data.records) === null || _data$records === void 0 ? void 0 : _data$records.length) !== null && _data$records$length !== void 0 ? _data$records$length : 0;
    let totalFetched = this.totalFetched;

    for (let i = 0; i < numRecords; i++) {
      if (totalFetched >= maxFetch) {
        this._finished = true;
        break;
      }

      const record = data.records[i];
      this.emit('record', record, totalFetched, this);
      totalFetched += 1;
    }

    this.totalFetched = totalFetched;

    if (this._finished) {
      const response = this.constructResponse(data.done, responseTarget); // only fire response event when it should be notified per fetch

      if (responseTarget !== ResponseTargets.Records) {
        this.emit('response', response, this);
      }

      this.emit('end');
      return response;
    } else {
      return this._execute(options);
    }
  }
  /**
   * Obtain readable stream instance
   */


  stream(type = 'csv') {
    if (!this._finished && !this._executed) {
      this.execute({
        autoFetch: true
      });
    }

    return type === 'record' ? this._stream : this._stream.stream(type);
  }
  /**
   * Pipe the queried records to another stream
   * This is for backward compatibility; Query is not a record stream instance anymore in 2.0.
   * If you want a record stream instance, use `Query#stream('record')`.
   */


  pipe(stream) {
    return this.stream('record').pipe(stream);
  }
  /**
   * @protected
   */


  async _expandFields(sobject_) {
    var _context8, _context9, _context10;

    if (this._soql) {
      throw new Error('Cannot expand fields for the query which has already built SOQL.');
    }

    const {
      fields = [],
      table = ''
    } = this._config;
    const sobject = sobject_ || table;

    this._logger.debug(`_expandFields: sobject = ${sobject}, fields = ${fields.join(', ')}`);

    const [efields] = await _promise.default.all([this._expandAsteriskFields(sobject, fields), ...(0, _map.default)(_context8 = this._children).call(_context8, async childQuery => {
      await childQuery._expandFields();
      return [];
    })]);
    this._config.fields = efields;
    this._config.includes = (0, _reduce.default)(_context9 = (0, _map.default)(_context10 = this._children).call(_context10, cquery => {
      const cconfig = cquery._query._config;
      return [cconfig.table, cconfig];
    })).call(_context9, (includes, [ctable, cconfig]) => _objectSpread(_objectSpread({}, includes), {}, {
      [ctable]: cconfig
    }), {});
  }
  /**
   *
   */


  async _findRelationObject(relName) {
    const table = this._config.table;

    if (!table) {
      throw new Error('No table information provided in the query');
    }

    this._logger.debug(`finding table for relation "${relName}" in "${table}"...`);

    const sobject = await this._conn.describe$(table);
    const upperRname = relName.toUpperCase();

    for (const cr of sobject.childRelationships) {
      if ((cr.relationshipName || '').toUpperCase() === upperRname && cr.childSObject) {
        return cr.childSObject;
      }
    }

    throw new Error(`No child relationship found: ${relName}`);
  }
  /**
   *
   */


  async _expandAsteriskFields(sobject, fields) {
    const expandedFields = await _promise.default.all((0, _map.default)(fields).call(fields, async field => this._expandAsteriskField(sobject, field)));
    return (0, _reduce.default)(expandedFields).call(expandedFields, (eflds, flds) => [...eflds, ...flds], []);
  }
  /**
   *
   */


  async _expandAsteriskField(sobject, field) {
    this._logger.debug(`expanding field "${field}" in "${sobject}"...`);

    const fpath = field.split('.');

    if (fpath[fpath.length - 1] === '*') {
      var _context11;

      const so = await this._conn.describe$(sobject);

      this._logger.debug(`table ${sobject} has been described`);

      if (fpath.length > 1) {
        const rname = fpath.shift();

        for (const f of so.fields) {
          if (f.relationshipName && rname && f.relationshipName.toUpperCase() === rname.toUpperCase()) {
            const rfield = f;
            const referenceTo = rfield.referenceTo || [];
            const rtable = referenceTo.length === 1 ? referenceTo[0] : 'Name';
            const fpaths = await this._expandAsteriskField(rtable, fpath.join('.'));
            return (0, _map.default)(fpaths).call(fpaths, fp => `${rname}.${fp}`);
          }
        }

        return [];
      }

      return (0, _map.default)(_context11 = so.fields).call(_context11, f => f.name);
    }

    return [field];
  }
  /**
   * Explain plan for executing query
   */


  async explain() {
    const soql = await this.toSOQL();

    this._logger.debug(`SOQL = ${soql}`);

    const url = `/query/?explain=${encodeURIComponent(soql)}`;
    return this._conn.request(url);
  }
  /**
   * Return SOQL expression for the query
   */


  async toSOQL() {
    if (this._soql) {
      return this._soql;
    }

    await this._expandFields();
    return (0, _soqlBuilder.createSOQL)(this._config);
  }
  /**
   * Promise/A+ interface
   * http://promises-aplus.github.io/promises-spec/
   *
   * Delegate to deferred promise, return promise instance for query result
   */


  then(onResolve, onReject) {
    this._chaining = true;

    if (!this._finished && !this._executed) {
      this.execute();
    }

    if (!this._promise) {
      throw new Error('invalid state: promise is not set after query execution');
    }

    return this._promise.then(onResolve, onReject);
  }

  catch(onReject) {
    return this.then(null, onReject);
  }

  promise() {
    return _promise.default.resolve(this);
  }
  /**
   * Bulk delete queried records
   */


  destroy(type, options) {
    if (typeof type === 'object' && type !== null) {
      options = type;
      type = undefined;
    }

    options = options || {};
    const type_ = type || this._config.table;

    if (!type_) {
      throw new Error('SOQL based query needs SObject type information to bulk delete.');
    } // Set the threshold number to pass to bulk API


    const thresholdNum = options.allowBulk === false ? -1 : typeof options.bulkThreshold === 'number' ? options.bulkThreshold : // determine threshold if the connection version supports SObject collection API or not
    this._conn._ensureVersion(42) ? DEFAULT_BULK_THRESHOLD : this._conn._maxRequest / 2;
    return new _promise.default((resolve, reject) => {
      const createBatch = () => this._conn.sobject(type_).deleteBulk().on('response', resolve).on('error', reject);

      let records = [];
      let batch = null;

      const handleRecord = rec => {
        if (!rec.Id) {
          const err = new Error('Queried record does not include Salesforce record ID.');
          this.emit('error', err);
          return;
        }

        const record = {
          Id: rec.Id
        };

        if (batch) {
          batch.write(record);
        } else {
          records.push(record);

          if (thresholdNum >= 0 && records.length > thresholdNum) {
            // Use bulk delete instead of SObject REST API
            batch = createBatch();

            for (const record of records) {
              batch.write(record);
            }

            records = [];
          }
        }
      };

      const handleEnd = () => {
        if (batch) {
          batch.end();
        } else {
          const ids = (0, _map.default)(records).call(records, record => record.Id);

          this._conn.sobject(type_).destroy(ids, {
            allowRecursive: true
          }).then(resolve, reject);
        }
      };

      this.stream('record').on('data', handleRecord).on('end', handleEnd).on('error', reject);
    });
  }
  /**
   * Synonym of Query#destroy()
   */


  update(mapping, type, options) {
    if (typeof type === 'object' && type !== null) {
      options = type;
      type = undefined;
    }

    options = options || {};
    const type_ = type || this._config && this._config.table;

    if (!type_) {
      throw new Error('SOQL based query needs SObject type information to bulk update.');
    }

    const updateStream = typeof mapping === 'function' ? (0, _map.default)(_recordStream.default).call(_recordStream.default, mapping) : _recordStream.default.recordMapStream(mapping); // Set the threshold number to pass to bulk API

    const thresholdNum = options.allowBulk === false ? -1 : typeof options.bulkThreshold === 'number' ? options.bulkThreshold : // determine threshold if the connection version supports SObject collection API or not
    this._conn._ensureVersion(42) ? DEFAULT_BULK_THRESHOLD : this._conn._maxRequest / 2;
    return new _promise.default((resolve, reject) => {
      const createBatch = () => this._conn.sobject(type_).updateBulk().on('response', resolve).on('error', reject);

      let records = [];
      let batch = null;

      const handleRecord = record => {
        if (batch) {
          batch.write(record);
        } else {
          records.push(record);
        }

        if (thresholdNum >= 0 && records.length > thresholdNum) {
          // Use bulk update instead of SObject REST API
          batch = createBatch();

          for (const record of records) {
            batch.write(record);
          }

          records = [];
        }
      };

      const handleEnd = () => {
        if (batch) {
          batch.end();
        } else {
          this._conn.sobject(type_).update(records, {
            allowRecursive: true
          }).then(resolve, reject);
        }
      };

      this.stream('record').on('error', reject).pipe(updateStream).on('data', handleRecord).on('end', handleEnd).on('error', reject);
    });
  }

}
/*--------------------------------------------*/

/**
 * SubQuery object for representing child relationship query
 */


exports.Query = Query;
(0, _defineProperty2.default)(Query, "_logger", (0, _logger.getLogger)('query'));

class SubQuery {
  /**
   *
   */
  constructor(conn, relName, config, parent) {
    (0, _defineProperty2.default)(this, "_relName", void 0);
    (0, _defineProperty2.default)(this, "_query", void 0);
    (0, _defineProperty2.default)(this, "_parent", void 0);
    (0, _defineProperty2.default)(this, "offset", this.skip);
    (0, _defineProperty2.default)(this, "orderby", (0, _sort.default)(this));
    this._relName = relName;
    this._query = new Query(conn, config);
    this._parent = parent;
  }
  /**
   *
   */


  select(fields) {
    // force convert query record type without changing instance
    this._query = this._query.select(fields);
    return this;
  }
  /**
   *
   */


  where(conditions) {
    this._query = this._query.where(conditions);
    return this;
  }
  /**
   * Limit the returning result
   */


  limit(limit) {
    this._query = this._query.limit(limit);
    return this;
  }
  /**
   * Skip records
   */


  skip(offset) {
    this._query = this._query.skip(offset);
    return this;
  }
  /**
   * Synonym of SubQuery#skip()
   */


  sort(sort, dir) {
    var _context12;

    this._query = (0, _sort.default)(_context12 = this._query).call(_context12, sort, dir);
    return this;
  }
  /**
   * Synonym of SubQuery#sort()
   */


  /**
   *
   */
  async _expandFields() {
    const sobject = await this._parent._findRelationObject(this._relName);
    return this._query._expandFields(sobject);
  }
  /**
   * Back the context to parent query object
   */


  end() {
    return this._parent;
  }

}

exports.SubQuery = SubQuery;
var _default = Query;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9xdWVyeS50cyJdLCJuYW1lcyI6WyJSZXNwb25zZVRhcmdldFZhbHVlcyIsIlJlc3BvbnNlVGFyZ2V0cyIsInZhbHVlcyIsInRhcmdldCIsIkRFRkFVTFRfQlVMS19USFJFU0hPTEQiLCJRdWVyeSIsIkV2ZW50RW1pdHRlciIsImNvbnN0cnVjdG9yIiwiY29ubiIsImNvbmZpZyIsIm9wdGlvbnMiLCJza2lwIiwiZXhlY3V0ZSIsImRlc3Ryb3kiLCJfY29ubiIsIl9sb2dnZXIiLCJfbG9nTGV2ZWwiLCJjcmVhdGVJbnN0YW5jZSIsIl9zb3FsIiwiZGVidWciLCJsb2NhdG9yIiwiX2xvY2F0b3IiLCJ1cmxUb0xvY2F0b3IiLCJmaWVsZHMiLCJpbmNsdWRlcyIsInNvcnQiLCJfY29uZmlnIiwic2VsZWN0IiwiaW5jbHVkZUNoaWxkcmVuIiwiX29wdGlvbnMiLCJoZWFkZXJzIiwibWF4RmV0Y2giLCJhdXRvRmV0Y2giLCJzY2FuQWxsIiwicmVzcG9uc2VUYXJnZXQiLCJfcHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbiIsIl9zdHJlYW0iLCJTZXJpYWxpemFibGUiLCJyZWNvcmQiLCJwdXNoIiwiZXJyIiwiZW1pdCIsImUiLCJFcnJvciIsInRvRmllbGRBcnJheSIsInNwbGl0IiwiZnMiLCJmIiwidiIsInAiLCJ3aGVyZSIsImNvbmRpdGlvbnMiLCJsaW1pdCIsIm9mZnNldCIsImRpciIsImluY2x1ZGUiLCJjaGlsZFJlbE5hbWUiLCJjaGlsZENvbmZpZyIsInVuZGVmaW5lZCIsInRhYmxlIiwiY2hpbGRRdWVyeSIsIlN1YlF1ZXJ5IiwiX2NoaWxkcmVuIiwiY3JuYW1lIiwic2V0UmVzcG9uc2VUYXJnZXQiLCJvcHRpb25zXyIsIl9leGVjdXRlZCIsIl9maW5pc2hlZCIsIm9uY2UiLCJSZWNvcmRzIiwiX2NoYWluaW5nIiwicmVjb3JkcyIsIm9uUmVjb3JkIiwicmVtb3ZlTGlzdGVuZXIiLCJfZXhlY3V0ZSIsImVycm9yIiwibG9jYXRvclRvVXJsIiwiX2Jhc2VVcmwiLCJqb2luIiwidXJsIiwicG9wIiwiY29uc3RydWN0UmVzcG9uc2UiLCJyYXdEb25lIiwidG90YWxTaXplIiwiZG9uZSIsIm5leHRSZWNvcmRzVXJsIiwic29xbCIsInRvU09RTCIsImVuY29kZVVSSUNvbXBvbmVudCIsImRhdGEiLCJyZXF1ZXN0IiwibWV0aG9kIiwibGVuZ3RoIiwibnVtUmVjb3JkcyIsInRvdGFsRmV0Y2hlZCIsImkiLCJyZXNwb25zZSIsInN0cmVhbSIsInR5cGUiLCJwaXBlIiwiX2V4cGFuZEZpZWxkcyIsInNvYmplY3RfIiwic29iamVjdCIsImVmaWVsZHMiLCJhbGwiLCJfZXhwYW5kQXN0ZXJpc2tGaWVsZHMiLCJjcXVlcnkiLCJjY29uZmlnIiwiX3F1ZXJ5IiwiY3RhYmxlIiwiX2ZpbmRSZWxhdGlvbk9iamVjdCIsInJlbE5hbWUiLCJkZXNjcmliZSQiLCJ1cHBlclJuYW1lIiwidG9VcHBlckNhc2UiLCJjciIsImNoaWxkUmVsYXRpb25zaGlwcyIsInJlbGF0aW9uc2hpcE5hbWUiLCJjaGlsZFNPYmplY3QiLCJleHBhbmRlZEZpZWxkcyIsImZpZWxkIiwiX2V4cGFuZEFzdGVyaXNrRmllbGQiLCJlZmxkcyIsImZsZHMiLCJmcGF0aCIsInNvIiwicm5hbWUiLCJzaGlmdCIsInJmaWVsZCIsInJlZmVyZW5jZVRvIiwicnRhYmxlIiwiZnBhdGhzIiwiZnAiLCJuYW1lIiwiZXhwbGFpbiIsInRoZW4iLCJvblJlc29sdmUiLCJvblJlamVjdCIsImNhdGNoIiwicHJvbWlzZSIsInR5cGVfIiwidGhyZXNob2xkTnVtIiwiYWxsb3dCdWxrIiwiYnVsa1RocmVzaG9sZCIsIl9lbnN1cmVWZXJzaW9uIiwiX21heFJlcXVlc3QiLCJjcmVhdGVCYXRjaCIsImRlbGV0ZUJ1bGsiLCJiYXRjaCIsImhhbmRsZVJlY29yZCIsInJlYyIsIklkIiwid3JpdGUiLCJoYW5kbGVFbmQiLCJlbmQiLCJpZHMiLCJhbGxvd1JlY3Vyc2l2ZSIsInVwZGF0ZSIsIm1hcHBpbmciLCJ1cGRhdGVTdHJlYW0iLCJSZWNvcmRTdHJlYW0iLCJyZWNvcmRNYXBTdHJlYW0iLCJ1cGRhdGVCdWxrIiwicGFyZW50IiwiX3JlbE5hbWUiLCJfcGFyZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBSUE7O0FBQ0E7O0FBQ0E7O0FBRUE7Ozs7OztBQTRJQSxNQUFNQSxvQkFBb0IsR0FBRyxDQUMzQixhQUQyQixFQUUzQixTQUYyQixFQUczQixjQUgyQixFQUkzQixPQUoyQixDQUE3QjtBQVNPLE1BQU1DLGVBRVosR0FBRyxxQkFBQUQsb0JBQW9CLE1BQXBCLENBQUFBLG9CQUFvQixFQUN0QixDQUFDRSxNQUFELEVBQVNDLE1BQVQscUNBQTBCRCxNQUExQjtBQUFrQyxHQUFDQyxNQUFELEdBQVVBO0FBQTVDLEVBRHNCLEVBRXRCLEVBRnNCLENBRmpCOzs7QUE4QlA7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsc0JBQXNCLEdBQUcsR0FBL0I7QUFFQTtBQUNBO0FBQ0E7O0FBQ08sTUFBTUMsS0FBTixTQUtHQyxvQkFMSCxDQUtnQjtBQW9CckI7QUFDRjtBQUNBO0FBQ0VDLEVBQUFBLFdBQVcsQ0FDVEMsSUFEUyxFQUVUQyxNQUZTLEVBR1RDLE9BSFMsRUFJVDtBQUNBO0FBREE7QUFBQTtBQUFBO0FBQUE7QUFBQSxtREFwQnlCLEVBb0J6QjtBQUFBLHFEQW5CbUQsRUFtQm5EO0FBQUE7QUFBQSxxREFqQm1CLEtBaUJuQjtBQUFBLHFEQWhCbUIsS0FnQm5CO0FBQUEscURBZm1CLEtBZW5CO0FBQUE7QUFBQTtBQUFBLHFEQVhVLENBV1Y7QUFBQSx3REFWYSxDQVViO0FBQUEsbURBVGEsRUFTYjtBQUFBLGtEQXVJTyxLQUFLQyxJQXZJWjtBQUFBLHNFQW9LcUMsSUFwS3JDO0FBQUEsZ0RBa1dLLEtBQUtDLE9BbFdWO0FBQUEsK0NBdVdJLEtBQUtBLE9BdldUO0FBQUEsa0RBMnVCTyxLQUFLQyxPQTN1Qlo7QUFBQSwrQ0FndkJJ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S0FBS0EsTUFBTCxDQUFZMUQsS0FBWixDQUFrQkMsVUFBbEIsQ0FBZDtBQUNBLFdBQU8sSUFBUDtBQUNEO0FBRUQ7QUFDRjtBQUNBOzs7QUFDRUMsRUFBQUEsS0FBSyxDQUFDQSxLQUFELEVBQWdCO0FBQ25CLFNBQUt3RCxNQUFMLEdBQWMsS0FBS0EsTUFBTCxDQUFZeEQsS0FBWixDQUFrQkEsS0FBbEIsQ0FBZDtBQUNBLFdBQU8sSUFBUDtBQUNEO0FBRUQ7QUFDRjtBQUNBOzs7QUFDRTVDLEVBQUFBLElBQUksQ0FBQzZDLE1BQUQsRUFBaUI7QUFDbkIsU0FBS3VELE1BQUwsR0FBYyxLQUFLQSxNQUFMLENBQVlwRyxJQUFaLENBQWlCNkMsTUFBakIsQ0FBZDtBQUNBLFdBQU8sSUFBUDtBQUNEO0FBRUQ7QUFDRjtBQUNBOzs7QUFVRS9CLEVBQUFBLElBQUksQ0FDRkEsSUFERSxFQUVGZ0MsR0FGRSxFQUdGO0FBQUE7O0FBQ0EsU0FBS3NELE1BQUwsR0FBYyxxQ0FBS0EsTUFBTCxtQkFBaUJ0RixJQUFqQixFQUE4QmdDLEdBQTlCLENBQWQ7QUFDQSxXQUFPLElBQVA7QUFDRDtBQUVEO0FBQ0Y7QUFDQTs7O0FBR0U7QUFDRjtBQUNBO0FBQ0UsUUFBTThDLGFBQU4sR0FBc0I7QUFDcEIsVUFBTUUsT0FBTyxHQUFHLE1BQU0sS0FBSytELE9BQUwsQ0FBYXZELG1CQUFiLENBQWlDLEtBQUtzRCxRQUF0QyxDQUF0QjtBQUNBLFdBQU8sS0FBS3hELE1BQUwsQ0FBWVIsYUFBWixDQUEwQkUsT0FBMUIsQ0FBUDtBQUNEO0FBRUQ7QUFDRjtBQUNBOzs7QUFDRW9ELEVBQUFBLEdBQUcsR0FNMEI7QUFDM0IsV0FBUSxLQUFLVyxPQUFiO0FBQ0Q7O0FBOUdEOzs7ZUFpSGFuSyxLIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBNYW5hZ2VzIHF1ZXJ5IGZvciByZWNvcmRzIGluIFNhbGVzZm9yY2VcbiAqIEBhdXRob3IgU2hpbmljaGkgVG9taXRhIDxzaGluaWNoaS50b21pdGFAZ21haWwuY29tPlxuICovXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgTG9nZ2VyLCBnZXRMb2dnZXIgfSBmcm9tICcuL3V0aWwvbG9nZ2VyJztcbmltcG9ydCBSZWNvcmRTdHJlYW0sIHsgU2VyaWFsaXphYmxlIH0gZnJvbSAnLi9yZWNvcmQtc3RyZWFtJztcbmltcG9ydCBDb25uZWN0aW9uIGZyb20gJy4vY29ubmVjdGlvbic7XG5pbXBvcnQgeyBjcmVhdGVTT1FMIH0gZnJvbSAnLi9zb3FsLWJ1aWxkZXInO1xuaW1wb3J0IHsgUXVlcnlDb25maWcgYXMgU09RTFF1ZXJ5Q29uZmlnLCBTb3J0RGlyIH0gZnJvbSAnLi9zb3FsLWJ1aWxkZXInO1xuaW1wb3J0IHtcbiAgUmVjb3JkLFxuICBPcHRpb25hbCxcbiAgU2NoZW1hLFxuICBTT2JqZWN0TmFtZXMsXG4gIENoaWxkUmVsYXRpb25zaGlwTmFtZXMsXG4gIENoaWxkUmVsYXRpb25zaGlwU09iamVjdE5hbWUsXG4gIEZpZWxkUHJvamVjdGlvbkNvbmZpZyxcbiAgRmllbGRQYXRoU3BlY2lmaWVyLFxuICBGaWVsZFBhdGhTY29wZWRQcm9qZWN0aW9uLFxuICBTT2JqZWN0UmVjb3JkLFxuICBTT2JqZWN0SW5wdXRSZWNvcmQsXG4gIFNPYmplY3RVcGRhdGVSZWNvcmQsXG4gIFNhdmVSZXN1bHQsXG4gIERhdGVTdHJpbmcsXG4gIFNPYmplY3RDaGlsZFJlbGF0aW9uc2hpcFByb3AsXG4gIFNPYmplY3RGaWVsZE5hbWVzLFxufSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IFJlYWRhYmxlIH0gZnJvbSAnc3RyZWFtJztcbmltcG9ydCBTZkRhdGUgZnJvbSAnLi9kYXRlJztcblxuLyoqXG4gKlxuICovXG5leHBvcnQgdHlwZSBRdWVyeUZpZWxkPFxuICBTIGV4dGVuZHMgU2NoZW1hLFxuICBOIGV4dGVuZHMgU09iamVjdE5hbWVzPFM+LFxuICBGUCBleHRlbmRzIEZpZWxkUGF0aFNwZWNpZmllcjxTLCBOPiA9IEZpZWxkUGF0aFNwZWNpZmllcjxTLCBOPlxuPiA9IEZQIHwgRlBbXSB8IHN0cmluZyB8IHN0cmluZ1tdIHwgeyBbZmllbGQ6IHN0cmluZ106IG51bWJlciB8IGJvb2xlYW4gfTtcblxuLyoqXG4gKlxuICovXG50eXBlIENWYWx1ZTxUPiA9IFQgZXh0ZW5kcyBEYXRlU3RyaW5nXG4gID8gU2ZEYXRlXG4gIDogVCBleHRlbmRzIHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW5cbiAgPyBUXG4gIDogbmV2ZXI7XG5cbnR5cGUgQ29uZE9wPFQ+ID1cbiAgfCBbJyRlcScsIENWYWx1ZTxUPiB8IG51bGxdXG4gIHwgWyckbmUnLCBDVmFsdWU8VD4gfCBudWxsXVxuICB8IFsnJGd0JywgQ1ZhbHVlPFQ+XVxuICB8IFsnJGd0ZScsIENWYWx1ZTxUPl1cbiAgfCBbJyRsdCcsIENWYWx1ZTxUPl1cbiAgfCBbJyRsdGUnLCBDVmFsdWU8VD5dXG4gIHwgWyckbGlrZScsIFQgZXh0ZW5kcyBzdHJpbmcgPyBUIDogbmV2ZXJdXG4gIHwgWyckbmxpa2UnLCBUIGV4dGVuZHMgc3RyaW5nID8gVCA6IG5ldmVyXVxuICB8IFsnJGluJywgQXJyYXk8Q1ZhbHVlPFQ+Pl1cbiAgfCBbJyRuaW4nLCBBcnJheTxDVmFsdWU8VD4+XVxuICB8IFsnJGluY2x1ZGVzJywgVCBleHRlbmRzIHN0cmluZyA/IFRbXSA6IG5ldmVyXVxuICB8IFsnJGV4Y2x1ZGVzJywgVCBleHRlbmRzIHN0cmluZyA/IFRbXSA6IG5ldmVyXVxuICB8IFsnJGV4aXN0cycsIGJvb2xlYW5dO1xuXG50eXBlIENvbmRWYWx1ZU9iajxULCBPcCA9IENvbmRPcDxUPlswXT4gPSBPcCBleHRlbmRzIENvbmRPcDxUPlswXVxuICA/IE9wIGV4dGVuZHMgc3RyaW5nXG4gICAgPyB7IFtLIGluIE9wXTogRXh0cmFjdDxDb25kT3A8VD4sIFtPcCwgYW55XT5bMV0gfVxuICAgIDogbmV2ZXJcbiAgOiBuZXZlcjtcblxudHlwZSBDb25kVmFsdWU8VD4gPSBDVmFsdWU8VD4gfCBBcnJheTxDVmFsdWU8VD4+IHwgbnVsbCB8IENvbmRWYWx1ZU9iajxUPjtcblxudHlwZSBDb25kaXRpb25TZXQ8UiBleHRlbmRzIFJlY29yZD4gPSB7XG4gIFtLIGluIGtleW9mIFJdPzogQ29uZFZhbHVlPFJbS10+O1xufTtcblxuZXhwb3J0IHR5cGUgUXVlcnlDb25kaXRpb248UyBleHRlbmRzIFNjaGVtYSwgTiBleHRlbmRzIFNPYmplY3ROYW1lczxTPj4gPVxuICB8IHtcbiAgICAgICRvcjogUXVlcnlDb25kaXRpb248UywgTj5bXTtcbiAgICB9XG4gIHwge1xuICAgICAgJGFuZDogUXVlcnlDb25kaXRpb248UywgTj5bXTtcbiAgICB9XG4gIHwgQ29uZGl0aW9uU2V0PFNPYmplY3RSZWNvcmQ8UywgTj4+O1xuXG5leHBvcnQgdHlwZSBRdWVyeVNvcnQ8XG4gIFMgZXh0ZW5kcyBTY2hlbWEsXG4gIE4gZXh0ZW5kcyBTT2JqZWN0TmFtZXM8Uz4sXG4gIFIgZXh0ZW5kcyBTT2JqZWN0UmVjb3JkPFMsIE4+ID0gU09iamVjdFJlY29yZDxTLCBOPlxuPiA9XG4gIHwge1xuICAgICAgW0sgaW4ga2V5b2YgUl0/OiBTb3J0RGlyO1xuICAgIH1cbiAgfCBBcnJheTxba2V5b2YgUiwgU29ydERpcl0+O1xuXG4vKipcbiAqXG4gKi9cbmV4cG9ydCB0eXBlIFF1ZXJ5Q29uZmlnPFxuICBTIGV4dGVuZHMgU2NoZW1hLFxuICBOIGV4dGVuZHMgU09iamVjdE5hbWVzPFM+LFxuICBGUCBleHRlbmRzIEZpZWxkUGF0aFNwZWNpZmllcjxTLCBOPiA9IEZpZWxkUGF0aFNwZWNpZmllcjxTLCBOPlxuPiA9IHtcbiAgZmllbGRzPzogUXVlcnlGaWVsZDxTLCBOLCBGUD47XG4gIGluY2x1ZGVzPzoge1xuICAgIFtDUk4gaW4gQ2hpbGRSZWxhdGlvbnNoaXBOYW1lczxTLCBOPl0/OiBRdWVyeUNvbmZpZzxcbiAgICAgIFMsXG4gICAgICBDaGlsZFJlbGF0aW9uc2hpcFNPYmplY3ROYW1lPFMsIE4sIENSTj5cbiAgICA+O1xuICB9O1xuICB0YWJsZT86IHN0cmluZztcbiAgY29uZGl0aW9ucz86IFF1ZXJ5Q29uZGl0aW9uPFMsIE4+O1xuICBzb3J0PzogUXVlcnlTb3J0PFMsIE4+O1xuICBsaW1pdD86IG51bWJlcjtcbiAgb2Zmc2V0PzogbnVtYmVyO1xufTtcblxuZXhwb3J0IHR5cGUgUXVlcnlPcHRpb25zID0ge1xuICBoZWFkZXJzOiB7IFtuYW1lOiBzdHJpbmddOiBzdHJpbmcgfTtcbiAgbWF4RmV0Y2g6IG51bWJlcjtcbiAgYXV0b0ZldGNoOiBib29sZWFuO1xuICBzY2FuQWxsOiBib29sZWFuO1xuICByZXNwb25zZVRhcmdldDogUXVlcnlSZXNwb25zZVRhcmdldDtcbn07XG5cbmV4cG9ydCB0eXBlIFF1ZXJ5UmVzdWx0PFIgZXh0ZW5kcyBSZWNvcmQ+ID0ge1xuICBkb25lOiBib29sZWFuO1xuICB0b3RhbFNpemU6IG51bWJlcjtcbiAgcmVjb3JkczogUltdO1xuICBuZXh0UmVjb3Jkc1VybD86IHN0cmluZztcbn07XG5cbmV4cG9ydCB0eXBlIFF1ZXJ5RXhwbGFpblJlc3VsdCA9IHtcbiAgcGxhbnM6IEFycmF5PHtcbiAgICBjYXJkaW5hbGl0eTogbnVtYmVyO1xuICAgIGZpZWxkczogc3RyaW5nW107XG4gICAgbGVhZGluZ09wZXJhdGlvblR5cGU6ICdJbmRleCcgfCAnT3RoZXInIHwgJ1NoYXJpbmcnIHwgJ1RhYmxlU2Nhbic7XG4gICAgbm90ZXM6IEFycmF5PHtcbiAgICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgICBmaWVsZHM6IHN0cmluZ1tdO1xuICAgICAgdGFibGVFbnVtT3JJZDogc3RyaW5nO1xuICAgIH0+O1xuICAgIHJlbGF0aXZlQ29zdDogbnVtYmVyO1xuICAgIHNvYmplY3RDYXJkaW5hbGl0eTogbnVtYmVyO1xuICAgIHNvYmplY3RUeXBlOiBzdHJpbmc7XG4gIH0+O1xufTtcblxuY29uc3QgUmVzcG9uc2VUYXJnZXRWYWx1ZXMgPSBbXG4gICdRdWVyeVJlc3VsdCcsXG4gICdSZWNvcmRzJyxcbiAgJ1NpbmdsZVJlY29yZCcsXG4gICdDb3VudCcsXG5dIGFzIGNvbnN0O1xuXG5leHBvcnQgdHlwZSBRdWVyeVJlc3BvbnNlVGFyZ2V0ID0gdHlwZW9mIFJlc3BvbnNlVGFyZ2V0VmFsdWVzW251bWJlcl07XG5cbmV4cG9ydCBjb25zdCBSZXNwb25zZVRhcmdldHM6IHtcbiAgW0sgaW4gUXVlcnlSZXNwb25zZVRhcmdldF06IEs7XG59ID0gUmVzcG9uc2VUYXJnZXRWYWx1ZXMucmVkdWNlKFxuICAodmFsdWVzLCB0YXJnZXQpID0+ICh7IC4uLnZhbHVlcywgW3RhcmdldF06IHRhcmdldCB9KSxcbiAge30gYXMge1xuICAgIFtLIGluIFF1ZXJ5UmVzcG9uc2VUYXJnZXRdOiBLO1xuICB9LFxuKTtcblxuZXhwb3J0IHR5cGUgUXVlcnlSZXNwb25zZTxcbiAgUiBleHRlbmRzIFJlY29yZCxcbiAgUVJUIGV4dGVuZHMgUXVlcnlSZXNwb25zZVRhcmdldCA9IFF1ZXJ5UmVzcG9uc2VUYXJnZXRcbj4gPSBRUlQgZXh0ZW5kcyAnUXVlcnlSZXN1bHQnXG4gID8gUXVlcnlSZXN1bHQ8Uj5cbiAgOiBRUlQgZXh0ZW5kcyAnUmVjb3JkcydcbiAgPyBSW11cbiAgOiBRUlQgZXh0ZW5kcyAnU2luZ2xlUmVjb3JkJ1xuICA/IFIgfCBudWxsXG4gIDogbnVtYmVyOyAvLyBRUlQgZXh0ZW5kcyAnQ291bnQnXG5cbmV4cG9ydCB0eXBlIFF1ZXJ5RGVzdHJveU9wdGlvbnMgPSB7XG4gIGFsbG93QnVsaz86IGJvb2xlYW47XG4gIGJ1bGtUaHJlc2hvbGQ/OiBudW1iZXI7XG59O1xuXG5leHBvcnQgdHlwZSBRdWVyeVVwZGF0ZU9wdGlvbnMgPSB7XG4gIGFsbG93QnVsaz86IGJvb2xlYW47XG4gIGJ1bGtUaHJlc2hvbGQ/OiBudW1iZXI7XG59O1xuXG4vKipcbiAqXG4gKi9cbmNvbnN0IERFRkFVTFRfQlVMS19USFJFU0hPTEQgPSAyMDA7XG5cbi8qKlxuICogUXVlcnlcbiAqL1xuZXhwb3J0IGNsYXNzIFF1ZXJ5PFxuICBTIGV4dGVuZHMgU2NoZW1hLFxuICBOIGV4dGVuZHMgU09iamVjdE5hbWVzPFM+LFxuICBSIGV4dGVuZHMgUmVjb3JkID0gUmVjb3JkLFxuICBRUlQgZXh0ZW5kcyBRdWVyeVJlc3BvbnNlVGFyZ2V0ID0gUXVlcnlSZXNwb25zZVRhcmdldFxuPiBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIHN0YXRpYyBfbG9nZ2VyID0gZ2V0TG9nZ2VyKCdxdWVyeScpO1xuXG4gIF9jb25uOiBDb25uZWN0aW9uPFM+O1xuICBfbG9nZ2VyOiBMb2dnZXI7XG4gIF9zb3FsOiBPcHRpb25hbDxzdHJpbmc+O1xuICBfbG9jYXRvcjogT3B0aW9uYWw8c3RyaW5nPjtcbiAgX2NvbmZpZzogU09RTFF1ZXJ5Q29uZmlnID0ge307XG4gIF9jaGlsZHJlbjogU3ViUXVlcnk8UywgTiwgUiwgUVJULCBhbnksIGFueSwgYW55PltdID0gW107XG4gIF9vcHRpb25zOiBRdWVyeU9wdGlvbnM7XG4gIF9leGVjdXRlZDogYm9vbGVhbiA9IGZhbHNlO1xuICBfZmluaXNoZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgX2NoYWluaW5nOiBib29sZWFuID0gZmFsc2U7XG4gIF9wcm9taXNlOiBQcm9taXNlPFF1ZXJ5UmVzcG9uc2U8UiwgUVJUPj47XG4gIF9zdHJlYW06IFNlcmlhbGl6YWJsZTxSPjtcblxuICB0b3RhbFNpemUgPSAwO1xuICB0b3RhbEZldGNoZWQgPSAwO1xuICByZWNvcmRzOiBSW10gPSBbXTtcblxuICAvKipcbiAgICpcbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgIGNvbm46IENvbm5lY3Rpb248Uz4sXG4gICAgY29uZmlnOiBzdHJpbmcgfCBRdWVyeUNvbmZpZzxTLCBOPiB8IHsgbG9jYXRvcjogc3RyaW5nIH0sXG4gICAgb3B0aW9ucz86IFBhcnRpYWw8UXVlcnlPcHRpb25zPixcbiAgKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9jb25uID0gY29ubjtcbiAgICB0aGlzLl9sb2dnZXIgPSBjb25uLl9sb2dMZXZlbFxuICAgICAgPyBRdWVyeS5fbG9nZ2VyLmNyZWF0ZUluc3RhbmNlKGNvbm4uX2xvZ0xldmVsKVxuICAgICAgOiBRdWVyeS5fbG9nZ2VyO1xuICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJykge1xuICAgICAgdGhpcy5fc29xbCA9IGNvbmZpZztcbiAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhgY29uZmlnIGlzIHNvcWw6ICR7Y29uZmlnfWApO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIChjb25maWcgYXMgYW55KS5sb2NhdG9yID09PSAnc3RyaW5nJykge1xuICAgICAgY29uc3QgbG9jYXRvcjogc3RyaW5nID0gKGNvbmZpZyBhcyBhbnkpLmxvY2F0b3I7XG4gICAgICB0aGlzLl9sb2dnZXIuZGVidWcoYGNvbmZpZyBpcyBsb2NhdG9yOiAke2xvY2F0b3J9YCk7XG4gICAgICB0aGlzLl9sb2NhdG9yID0gbG9jYXRvci5pbmNsdWRlcygnLycpXG4gICAgICAgID8gdGhpcy51cmxUb0xvY2F0b3IobG9jYXRvcilcbiAgICAgICAgOiBsb2NhdG9yO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9sb2dnZXIuZGVidWcoYGNvbmZpZyBpcyBRdWVyeUNvbmZpZzogJHtjb25maWd9YCk7XG4gICAgICBjb25zdCB7IGZpZWxkcywgaW5jbHVkZXMsIHNvcnQsIC4uLl9jb25maWcgfSA9IGNvbmZpZyBhcyBRdWVyeUNvbmZpZzxcbiAgICAgICAgUyxcbiAgICAgICAgTlxuICAgICAgPjtcbiAgICAgIHRoaXMuX2NvbmZpZyA9IF9jb25maWc7XG4gICAgICB0aGlzLnNlbGVjdChmaWVsZHMpO1xuICAgICAgaWYgKGluY2x1ZGVzKSB7XG4gICAgICAgIHRoaXMuaW5jbHVkZUNoaWxkcmVuKGluY2x1ZGVzKTtcbiAgICAgIH1cbiAgICAgIGlmIChzb3J0KSB7XG4gICAgICAgIHRoaXMuc29ydChzb3J0KTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5fb3B0aW9ucyA9IHtcbiAgICAgIGhlYWRlcnM6IHt9LFxuICAgICAgbWF4RmV0Y2g6IDEwMDAwLFxuICAgICAgYXV0b0ZldGNoOiBmYWxzZSxcbiAgICAgIHNjYW5BbGw6IGZhbHNlLFxuICAgICAgcmVzcG9uc2VUYXJnZXQ6ICdRdWVyeVJlc3VsdCcsXG4gICAgICAuLi4ob3B0aW9ucyB8fCB7fSksXG4gICAgfSBhcyBRdWVyeU9wdGlvbnM7XG4gICAgLy8gcHJvbWlzZSBpbnN0YW5jZVxuICAgIHRoaXMuX3Byb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLm9uKCdyZXNwb25zZScsIHJlc29sdmUpO1xuICAgICAgdGhpcy5vbignZXJyb3InLCByZWplY3QpO1xuICAgIH0pO1xuICAgIHRoaXMuX3N0cmVhbSA9IG5ldyBTZXJpYWxpemFibGUoKTtcbiAgICB0aGlzLm9uKCdyZWNvcmQnLCAocmVjb3JkKSA9PiB0aGlzLl9zdHJlYW0ucHVzaChyZWNvcmQpKTtcbiAgICB0aGlzLm9uKCdlbmQnLCAoKSA9PiB0aGlzLl9zdHJlYW0ucHVzaChudWxsKSk7XG4gICAgdGhpcy5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLl9zdHJlYW0uZW1pdCgnZXJyb3InLCBlcnIpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWVtcHR5XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0IGZpZWxkcyB0byBpbmNsdWRlIGluIHRoZSByZXR1cm5pbmcgcmVzdWx0XG4gICAqL1xuICBzZWxlY3Q8XG4gICAgUiBleHRlbmRzIFJlY29yZCA9IFJlY29yZCxcbiAgICBGUCBleHRlbmRzIEZpZWxkUGF0aFNwZWNpZmllcjxTLCBOPiA9IEZpZWxkUGF0aFNwZWNpZmllcjxTLCBOPixcbiAgICBGUEMgZXh0ZW5kcyBGaWVsZFByb2plY3Rpb25Db25maWcgPSBGaWVsZFBhdGhTY29wZWRQcm9qZWN0aW9uPFMsIE4sIEZQPixcbiAgICBSMiBleHRlbmRzIFNPYmplY3RSZWNvcmQ8UywgTiwgRlBDLCBSPiA9IFNPYmplY3RSZWNvcmQ8UywgTiwgRlBDLCBSPlxuICA+KGZpZWxkczogUXVlcnlGaWVsZDxTLCBOLCBGUD4gPSAnKicpOiBRdWVyeTxTLCBOLCBSMiwgUVJUPiB7XG4gICAgaWYgKHRoaXMuX3NvcWwpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAnQ2Fubm90IHNldCBzZWxlY3QgZmllbGRzIGZvciB0aGUgcXVlcnkgd2hpY2ggaGFzIGFscmVhZHkgYnVpbHQgU09RTC4nLFxuICAgICAgKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdG9GaWVsZEFycmF5KGZpZWxkczogUXVlcnlGaWVsZDxTLCBOLCBGUD4pOiBzdHJpbmdbXSB7XG4gICAgICByZXR1cm4gdHlwZW9mIGZpZWxkcyA9PT0gJ3N0cmluZydcbiAgICAgICAgPyBmaWVsZHMuc3BsaXQoL1xccyosXFxzKi8pXG4gICAgICAgIDogQXJyYXkuaXNBcnJheShmaWVsZHMpXG4gICAgICAgID8gKGZpZWxkcyBhcyBBcnJheTxzdHJpbmcgfCBGUD4pXG4gICAgICAgICAgICAubWFwKHRvRmllbGRBcnJheSlcbiAgICAgICAgICAgIC5yZWR1Y2UoKGZzLCBmKSA9PiBbLi4uZnMsIC4uLmZdLCBbXSBhcyBzdHJpbmdbXSlcbiAgICAgICAgOiBPYmplY3QuZW50cmllcyhmaWVsZHMgYXMgeyBbbmFtZTogc3RyaW5nXTogUXVlcnlGaWVsZDxTLCBOLCBGUD4gfSlcbiAgICAgICAgICAgIC5tYXAoKFtmLCB2XSkgPT4ge1xuICAgICAgICAgICAgICBpZiAodHlwZW9mIHYgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdiA/IFtmXSA6IFtdO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0b0ZpZWxkQXJyYXkodikubWFwKChwKSA9PiBgJHtmfS4ke3B9YCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAucmVkdWNlKChmcywgZikgPT4gWy4uLmZzLCAuLi5mXSwgW10gYXMgc3RyaW5nW10pO1xuICAgIH1cbiAgICBpZiAoZmllbGRzKSB7XG4gICAgICB0aGlzLl9jb25maWcuZmllbGRzID0gdG9GaWVsZEFycmF5KGZpZWxkcyk7XG4gICAgfVxuICAgIC8vIGZvcmNlIGNvbnZlcnQgcXVlcnkgcmVjb3JkIHR5cGUgd2l0aG91dCBjaGFuZ2luZyBpbnN0YW5jZTtcbiAgICByZXR1cm4gKHRoaXMgYXMgYW55KSBhcyBRdWVyeTxTLCBOLCBSMiwgUVJUPjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgcXVlcnkgY29uZGl0aW9ucyB0byBmaWx0ZXIgdGhlIHJlc3VsdCByZWNvcmRzXG4gICAqL1xuICB3aGVyZShjb25kaXRpb25zOiBRdWVyeUNvbmRpdGlvbjxTLCBOPiB8IHN0cmluZykge1xuICAgIGlmICh0aGlzLl9zb3FsKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgJ0Nhbm5vdCBzZXQgd2hlcmUgY29uZGl0aW9ucyBmb3IgdGhlIHF1ZXJ5IHdoaWNoIGhhcyBhbHJlYWR5IGJ1aWx0IFNPUUwuJyxcbiAgICAgICk7XG4gICAgfVxuICAgIHRoaXMuX2NvbmZpZy5jb25kaXRpb25zID0gY29uZGl0aW9ucztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBMaW1pdCB0aGUgcmV0dXJuaW5nIHJlc3VsdFxuICAgKi9cbiAgbGltaXQobGltaXQ6IG51bWJlcikge1xuICAgIGlmICh0aGlzLl9zb3FsKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgJ0Nhbm5vdCBzZXQgbGltaXQgZm9yIHRoZSBxdWVyeSB3aGljaCBoYXMgYWxyZWFkeSBidWlsdCBTT1FMLicsXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLl9jb25maWcubGltaXQgPSBsaW1pdDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTa2lwIHJlY29yZHNcbiAgICovXG4gIHNraXAob2Zmc2V0OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5fc29xbCkge1xuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICdDYW5ub3Qgc2V0IHNraXAvb2Zmc2V0IGZvciB0aGUgcXVlcnkgd2hpY2ggaGFzIGFscmVhZHkgYnVpbHQgU09RTC4nLFxuICAgICAgKTtcbiAgICB9XG4gICAgdGhpcy5fY29uZmlnLm9mZnNldCA9IG9mZnNldDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTeW5vbnltIG9mIFF1ZXJ5I3NraXAoKVxuICAgKi9cbiAgb2Zmc2V0ID0gdGhpcy5za2lwO1xuXG4gIC8qKlxuICAgKiBTZXQgcXVlcnkgc29ydCB3aXRoIGRpcmVjdGlvblxuICAgKi9cbiAgc29ydChzb3J0OiBRdWVyeVNvcnQ8UywgTj4pOiB0aGlzO1xuICBzb3J0KHNvcnQ6IHN0cmluZyk6IHRoaXM7XG4gIHNvcnQoc29ydDogU09iamVjdEZpZWxkTmFtZXM8UywgTj4sIGRpcjogU29ydERpcik6IHRoaXM7XG4gIHNvcnQoc29ydDogc3RyaW5nLCBkaXI6IFNvcnREaXIpOiB0aGlzO1xuICBzb3J0KFxuICAgIHNvcnQ6IFF1ZXJ5U29ydDxTLCBOPiB8IFNPYmplY3RGaWVsZE5hbWVzPFMsIE4+IHwgc3RyaW5nLFxuICAgIGRpcj86IFNvcnREaXIsXG4gICkge1xuICAgIGlmICh0aGlzLl9zb3FsKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgJ0Nhbm5vdCBzZXQgc29ydCBmb3IgdGhlIHF1ZXJ5IHdoaWNoIGhhcyBhbHJlYWR5IGJ1aWx0IFNPUUwuJyxcbiAgICAgICk7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygc29ydCA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIGRpciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMuX2NvbmZpZy5zb3J0ID0gW1tzb3J0LCBkaXJdXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fY29uZmlnLnNvcnQgPSBzb3J0IGFzIHN0cmluZyB8IHsgW2ZpZWxkOiBzdHJpbmddOiBTb3J0RGlyIH07XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFN5bm9ueW0gb2YgUXVlcnkjc29ydCgpXG4gICAqL1xuICBvcmRlcmJ5OiB0eXBlb2YgUXVlcnkucHJvdG90eXBlLnNvcnQgPSB0aGlzLnNvcnQ7XG5cbiAgLyoqXG4gICAqIEluY2x1ZGUgY2hpbGQgcmVsYXRpb25zaGlwIHF1ZXJ5IGFuZCBtb3ZlIGRvd24gdG8gdGhlIGNoaWxkIHF1ZXJ5IGNvbnRleHRcbiAgICovXG4gIGluY2x1ZGU8XG4gICAgQ1JOIGV4dGVuZHMgQ2hpbGRSZWxhdGlvbnNoaXBOYW1lczxTLCBOPixcbiAgICBDTiBleHRlbmRzIENoaWxkUmVsYXRpb25zaGlwU09iamVjdE5hbWU8UywgTiwgQ1JOPixcbiAgICBDRlAgZXh0ZW5kcyBGaWVsZFBhdGhTcGVjaWZpZXI8UywgQ04+ID0gRmllbGRQYXRoU3BlY2lmaWVyPFMsIENOPixcbiAgICBDRlBDIGV4dGVuZHMgRmllbGRQcm9qZWN0aW9uQ29uZmlnID0gRmllbGRQYXRoU2NvcGVkUHJvamVjdGlvbjxTLCBDTiwgQ0ZQPixcbiAgICBDUiBleHRlbmRzIFJlY29yZCA9IFNPYmplY3RSZWNvcmQ8UywgQ04sIENGUEM+XG4gID4oXG4gICAgY2hpbGRSZWxOYW1lOiBDUk4sXG4gICAgY29uZGl0aW9ucz86IE9wdGlvbmFsPFF1ZXJ5Q29uZGl0aW9uPFMsIENOPj4sXG4gICAgZmllbGRzPzogT3B0aW9uYWw8UXVlcnlGaWVsZDxTLCBDTiwgQ0ZQPj4sXG4gICAgb3B0aW9ucz86IHsgbGltaXQ/OiBudW1iZXI7IG9mZnNldD86IG51bWJlcjsgc29ydD86IFF1ZXJ5U29ydDxTLCBDTj4gfSxcbiAgKTogU3ViUXVlcnk8UywgTiwgUiwgUVJULCBDUk4sIENOLCBDUj47XG4gIGluY2x1ZGU8XG4gICAgQ1JOIGV4dGVuZHMgQ2hpbGRSZWxhdGlvbnNoaXBOYW1lczxTLCBOPixcbiAgICBDTiBleHRlbmRzIFNPYmplY3ROYW1lczxTPixcbiAgICBDUiBleHRlbmRzIFJlY29yZCA9IFNPYmplY3RSZWNvcmQ8UywgQ04+XG4gID4oXG4gICAgY2hpbGRSZWxOYW1lOiBzdHJpbmcsXG4gICAgY29uZGl0aW9ucz86IE9wdGlvbmFsPFF1ZXJ5Q29uZGl0aW9uPFMsIENOPj4sXG4gICAgZmllbGRzPzogT3B0aW9uYWw8UXVlcnlGaWVsZDxTLCBDTj4+LFxuICAgIG9wdGlvbnM/OiB7IGxpbWl0PzogbnVtYmVyOyBvZmZzZXQ/OiBudW1iZXI7IHNvcnQ/OiBRdWVyeVNvcnQ8UywgQ04+IH0sXG4gICk6IFN1YlF1ZXJ5PFMsIE4sIFIsIFFSVCwgQ1JOLCBDTiwgQ1I+O1xuXG4gIGluY2x1ZGU8XG4gICAgQ1JOIGV4dGVuZHMgQ2hpbGRSZWxhdGlvbnNoaXBOYW1lczxTLCBOPixcbiAgICBDTiBleHRlbmRzIENoaWxkUmVsYXRpb25zaGlwU09iamVjdE5hbWU8UywgTiwgQ1JOPixcbiAgICBDRlAgZXh0ZW5kcyBGaWVsZFBhdGhTcGVjaWZpZXI8UywgQ04+ID0gRmllbGRQYXRoU3BlY2lmaWVyPFMsIENOPixcbiAgICBDRlBDIGV4dGVuZHMgRmllbGRQcm9qZWN0aW9uQ29uZmlnID0gRmllbGRQYXRoU2NvcGVkUHJvamVjdGlvbjxTLCBDTiwgQ0ZQPixcbiAgICBDUiBleHRlbmRzIFJlY29yZCA9IFNPYmplY3RSZWNvcmQ8UywgQ04sIENGUEM+XG4gID4oXG4gICAgY2hpbGRSZWxOYW1lOiBDUk4gfCBzdHJpbmcsXG4gICAgY29uZGl0aW9ucz86IE9wdGlvbmFsPFF1ZXJ5Q29uZGl0aW9uPFMsIENOPj4sXG4gICAgZmllbGRzPzogT3B0aW9uYWw8UXVlcnlGaWVsZDxTLCBDTiwgQ0ZQPj4sXG4gICAgb3B0aW9uczogeyBsaW1pdD86IG51bWJlcjsgb2Zmc2V0PzogbnVtYmVyOyBzb3J0PzogUXVlcnlTb3J0PFMsIENOPiB9ID0ge30sXG4gICk6IFN1YlF1ZXJ5PFMsIE4sIFIsIFFSVCwgQ1JOLCBDTiwgQ1I+IHtcbiAgICBpZiAodGhpcy5fc29xbCkge1xuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICdDYW5ub3QgaW5jbHVkZSBjaGlsZCByZWxhdGlvbnNoaXAgaW50byB0aGUgcXVlcnkgd2hpY2ggaGFzIGFscmVhZHkgYnVpbHQgU09RTC4nLFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgY2hpbGRDb25maWc6IFF1ZXJ5Q29uZmlnPFMsIENOLCBDRlA+ID0ge1xuICAgICAgZmllbGRzOiBmaWVsZHMgPT09IG51bGwgPyB1bmRlZmluZWQgOiBmaWVsZHMsXG4gICAgICB0YWJsZTogY2hpbGRSZWxOYW1lLFxuICAgICAgY29uZGl0aW9uczogY29uZGl0aW9ucyA9PT0gbnVsbCA/IHVuZGVmaW5lZCA6IGNvbmRpdGlvbnMsXG4gICAgICBsaW1pdDogb3B0aW9ucy5saW1pdCxcbiAgICAgIG9mZnNldDogb3B0aW9ucy5vZmZzZXQsXG4gICAgICBzb3J0OiBvcHRpb25zLnNvcnQsXG4gICAgfTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlLWJlZm9yZS1kZWZpbmVcbiAgICBjb25zdCBjaGlsZFF1ZXJ5ID0gbmV3IFN1YlF1ZXJ5PFMsIE4sIFIsIFFSVCwgQ1JOLCBDTiwgQ1I+KFxuICAgICAgdGhpcy5fY29ubixcbiAgICAgIGNoaWxkUmVsTmFtZSBhcyBDUk4sXG4gICAgICBjaGlsZENvbmZpZyxcbiAgICAgIHRoaXMsXG4gICAgKTtcbiAgICB0aGlzLl9jaGlsZHJlbi5wdXNoKGNoaWxkUXVlcnkpO1xuICAgIHJldHVybiBjaGlsZFF1ZXJ5O1xuICB9XG5cbiAgLyoqXG4gICAqIEluY2x1ZGUgY2hpbGQgcmVsYXRpb25zaGlwIHF1ZXJpZXMsIGJ1dCBub3QgbW92aW5nIGRvd24gdG8gdGhlIGNoaWxkcmVuIGNvbnRleHRcbiAgICovXG4gIGluY2x1ZGVDaGlsZHJlbihcbiAgICBpbmNsdWRlczoge1xuICAgICAgW0NSTiBpbiBDaGlsZFJlbGF0aW9uc2hpcE5hbWVzPFMsIE4+XT86IFF1ZXJ5Q29uZmlnPFxuICAgICAgICBTLFxuICAgICAgICBDaGlsZFJlbGF0aW9uc2hpcFNPYmplY3ROYW1lPFMsIE4sIENSTj5cbiAgICAgID47XG4gICAgfSxcbiAgKSB7XG4gICAgdHlwZSBDUk4gPSBDaGlsZFJlbGF0aW9uc2hpcE5hbWVzPFMsIE4+O1xuICAgIGlmICh0aGlzLl9zb3FsKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgJ0Nhbm5vdCBpbmNsdWRlIGNoaWxkIHJlbGF0aW9uc2hpcCBpbnRvIHRoZSBxdWVyeSB3aGljaCBoYXMgYWxyZWFkeSBidWlsdCBTT1FMLicsXG4gICAgICApO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGNybmFtZSBvZiBPYmplY3Qua2V5cyhpbmNsdWRlcykgYXMgQ1JOW10pIHtcbiAgICAgIGNvbnN0IHsgY29uZGl0aW9ucywgZmllbGRzLCAuLi5vcHRpb25zIH0gPSBpbmNsdWRlc1tcbiAgICAgICAgY3JuYW1lXG4gICAgICBdIGFzIFF1ZXJ5Q29uZmlnPFMsIENoaWxkUmVsYXRpb25zaGlwU09iamVjdE5hbWU8UywgTiwgQ1JOPj47XG4gICAgICB0aGlzLmluY2x1ZGUoY3JuYW1lLCBjb25kaXRpb25zLCBmaWVsZHMsIG9wdGlvbnMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXR0aW5nIG1heEZldGNoIHF1ZXJ5IG9wdGlvblxuICAgKi9cbiAgbWF4RmV0Y2gobWF4RmV0Y2g6IG51bWJlcikge1xuICAgIHRoaXMuX29wdGlvbnMubWF4RmV0Y2ggPSBtYXhGZXRjaDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTd2l0Y2hpbmcgYXV0byBmZXRjaCBtb2RlXG4gICAqL1xuICBhdXRvRmV0Y2goYXV0b0ZldGNoOiBib29sZWFuKSB7XG4gICAgdGhpcy5fb3B0aW9ucy5hdXRvRmV0Y2ggPSBhdXRvRmV0Y2g7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogU2V0IGZsYWcgdG8gc2NhbiBhbGwgcmVjb3JkcyBpbmNsdWRpbmcgZGVsZXRlZCBhbmQgYXJjaGl2ZWQuXG4gICAqL1xuICBzY2FuQWxsKHNjYW5BbGw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9vcHRpb25zLnNjYW5BbGwgPSBzY2FuQWxsO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBzZXRSZXNwb25zZVRhcmdldDxRUlQxIGV4dGVuZHMgUXVlcnlSZXNwb25zZVRhcmdldD4oXG4gICAgcmVzcG9uc2VUYXJnZXQ6IFFSVDEsXG4gICk6IFF1ZXJ5PFMsIE4sIFIsIFFSVDE+IHtcbiAgICBpZiAocmVzcG9uc2VUYXJnZXQgaW4gUmVzcG9uc2VUYXJnZXRzKSB7XG4gICAgICB0aGlzLl9vcHRpb25zLnJlc3BvbnNlVGFyZ2V0ID0gcmVzcG9uc2VUYXJnZXQ7XG4gICAgfVxuICAgIC8vIGZvcmNlIGNoYW5nZSBxdWVyeSByZXNwb25zZSB0YXJnZXQgd2l0aG91dCBjaGFuZ2luZyBpbnN0YW5jZVxuICAgIHJldHVybiAodGhpcyBhcyBRdWVyeTxTLCBOLCBSPikgYXMgUXVlcnk8UywgTiwgUiwgUVJUMT47XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBxdWVyeSBhbmQgZmV0Y2ggcmVjb3JkcyBmcm9tIHNlcnZlci5cbiAgICovXG4gIGV4ZWN1dGU8UVJUMSBleHRlbmRzIFF1ZXJ5UmVzcG9uc2VUYXJnZXQgPSBRUlQ+KFxuICAgIG9wdGlvbnNfOiBQYXJ0aWFsPFF1ZXJ5T3B0aW9ucz4gJiB7IHJlc3BvbnNlVGFyZ2V0PzogUVJUMSB9ID0ge30sXG4gICk6IFF1ZXJ5PFMsIE4sIFIsIFFSVDE+IHtcbiAgICBpZiAodGhpcy5fZXhlY3V0ZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigncmUtZXhlY3V0aW5nIGFscmVhZHkgZXhlY3V0ZWQgcXVlcnknKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fZmluaXNoZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignZXhlY3V0aW5nIGFscmVhZHkgY2xvc2VkIHF1ZXJ5Jyk7XG4gICAgfVxuXG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIGhlYWRlcnM6IG9wdGlvbnNfLmhlYWRlcnMgfHwgdGhpcy5fb3B0aW9ucy5oZWFkZXJzLFxuICAgICAgcmVzcG9uc2VUYXJnZXQ6IG9wdGlvbnNfLnJlc3BvbnNlVGFyZ2V0IHx8IHRoaXMuX29wdGlvbnMucmVzcG9uc2VUYXJnZXQsXG4gICAgICBhdXRvRmV0Y2g6IG9wdGlvbnNfLmF1dG9GZXRjaCB8fCB0aGlzLl9vcHRpb25zLmF1dG9GZXRjaCxcbiAgICAgIG1heEZldGNoOiBvcHRpb25zXy5tYXhGZXRjaCB8fCB0aGlzLl9vcHRpb25zLm1heEZldGNoLFxuICAgICAgc2NhbkFsbDogb3B0aW9uc18uc2NhbkFsbCB8fCB0aGlzLl9vcHRpb25zLnNjYW5BbGwsXG4gICAgfTtcblxuICAgIC8vIGNvbGxlY3QgZmV0Y2hlZCByZWNvcmRzIGluIGFycmF5XG4gICAgLy8gb25seSB3aGVuIHJlc3BvbnNlIHRhcmdldCBpcyBSZWNvcmRzIGFuZFxuICAgIC8vIGVpdGhlciBjYWxsYmFjayBvciBjaGFpbmluZyBwcm9taXNlcyBhcmUgYXZhaWxhYmxlIHRvIHRoaXMgcXVlcnkuXG4gICAgdGhpcy5vbmNlKCdmZXRjaCcsICgpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgb3B0aW9ucy5yZXNwb25zZVRhcmdldCA9PT0gUmVzcG9uc2VUYXJnZXRzLlJlY29yZHMgJiZcbiAgICAgICAgdGhpcy5fY2hhaW5pbmdcbiAgICAgICkge1xuICAgICAgICB0aGlzLl9sb2dnZXIuZGVidWcoJy0tLSBjb2xsZWN0aW5nIGFsbCBmZXRjaGVkIHJlY29yZHMgLS0tJyk7XG4gICAgICAgIGNvbnN0IHJlY29yZHM6IFJlY29yZFtdID0gW107XG4gICAgICAgIGNvbnN0IG9uUmVjb3JkID0gKHJlY29yZDogUmVjb3JkKSA9PiByZWNvcmRzLnB1c2gocmVjb3JkKTtcbiAgICAgICAgdGhpcy5vbigncmVjb3JkJywgb25SZWNvcmQpO1xuICAgICAgICB0aGlzLm9uY2UoJ2VuZCcsICgpID0+IHtcbiAgICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKCdyZWNvcmQnLCBvblJlY29yZCk7XG4gICAgICAgICAgdGhpcy5lbWl0KCdyZXNwb25zZScsIHJlY29yZHMsIHRoaXMpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGZsYWcgdG8gcHJldmVudCByZS1leGVjdXRpb25cbiAgICB0aGlzLl9leGVjdXRlZCA9IHRydWU7XG5cbiAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gc3RhcnQgYWN0dWFsIHF1ZXJ5XG4gICAgICB0aGlzLl9sb2dnZXIuZGVidWcoJz4+PiBRdWVyeSBzdGFydCA+Pj4nKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuX2V4ZWN1dGUob3B0aW9ucyk7XG4gICAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZygnKioqIFF1ZXJ5IGZpbmlzaGVkICoqKicpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5fbG9nZ2VyLmRlYnVnKCctLS0gUXVlcnkgZXJyb3IgLS0tJywgZXJyb3IpO1xuICAgICAgICB0aGlzLmVtaXQoJ2Vycm9yJywgZXJyb3IpO1xuICAgICAgfVxuICAgIH0pKCk7XG5cbiAgICAvLyByZXR1cm4gUXVlcnkgaW5zdGFuY2UgZm9yIGNoYWluaW5nXG4gICAgcmV0dXJuICh0aGlzIGFzIFF1ZXJ5PFMsIE4sIFI+KSBhcyBRdWVyeTxTLCBOLCBSLCBRUlQxPjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTeW5vbnltIG9mIFF1ZXJ5I2V4ZWN1dGUoKVxuICAgKi9cbiAgZXhlYyA9IHRoaXMuZXhlY3V0ZTtcblxuICAvKipcbiAgICogU3lub255bSBvZiBRdWVyeSNleGVjdXRlKClcbiAgICovXG4gIHJ1biA9IHRoaXMuZXhlY3V0ZTtcblxuICBwcml2YXRlIGxvY2F0b3JUb1VybCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbG9jYXRvclxuICAgICAgPyBbdGhpcy5fY29ubi5fYmFzZVVybCgpLCAnL3F1ZXJ5LycsIHRoaXMuX2xvY2F0b3JdLmpvaW4oJycpXG4gICAgICA6ICcnO1xuICB9XG5cbiAgcHJpdmF0ZSB1cmxUb0xvY2F0b3IodXJsOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdXJsLnNwbGl0KCcvJykucG9wKCk7XG4gIH1cblxuICBwcml2YXRlIGNvbnN0cnVjdFJlc3BvbnNlKFxuICAgIHJhd0RvbmU6IGJvb2xlYW4sXG4gICAgcmVzcG9uc2VUYXJnZXQ6IFF1ZXJ5UmVzcG9uc2VUYXJnZXRbM10sXG4gICk6IG51bWJlcjtcbiAgcHJpdmF0ZSBjb25zdHJ1Y3RSZXNwb25zZShcbiAgICByYXdEb25lOiBib29sZWFuLFxuICAgIHJlc3BvbnNlVGFyZ2V0OiBRdWVyeVJlc3BvbnNlVGFyZ2V0WzJdLFxuICApOiBSO1xuICBwcml2YXRlIGNvbnN0cnVjdFJlc3BvbnNlKFxuICAgIHJhd0RvbmU6IGJvb2xlYW4sXG4gICAgcmVzcG9uc2VUYXJnZXQ6IFF1ZXJ5UmVzcG9uc2VUYXJnZXRbMV0sXG4gICk6IFJbXTtcbiAgcHJpdmF0ZSBjb25zdHJ1Y3RSZXNwb25zZShcbiAgICByYXdEb25lOiBib29sZWFuLFxuICAgIHJlc3BvbnNlVGFyZ2V0OiBRdWVyeVJlc3BvbnNlVGFyZ2V0WzBdLFxuICApOiBRdWVyeVJlc3VsdDxSPjtcbiAgcHJpdmF0ZSBjb25zdHJ1Y3RSZXNwb25zZShcbiAgICByYXdEb25lOiBib29sZWFuLFxuICAgIHJlc3BvbnNlVGFyZ2V0OiBRdWVyeVJlc3BvbnNlVGFyZ2V0LFxuICApOiBRdWVyeVJlc3VsdDxSPiB8IFJbXSB8IG51bWJlciB8IFIge1xuICAgIHN3aXRjaCAocmVzcG9uc2VUYXJnZXQpIHtcbiAgICAgIGNhc2UgJ0NvdW50JzpcbiAgICAgICAgcmV0dXJuIHRoaXMudG90YWxTaXplO1xuICAgICAgY2FzZSAnU2luZ2xlUmVjb3JkJzpcbiAgICAgICAgcmV0dXJuIHRoaXMucmVjb3Jkcz8uWzBdID8/IG51bGw7XG4gICAgICBjYXNlICdSZWNvcmRzJzpcbiAgICAgICAgcmV0dXJuIHRoaXMucmVjb3JkcztcbiAgICAgIC8vIFF1ZXJ5UmVzdWx0IGlzIGRlZmF1bHQgcmVzcG9uc2UgdGFyZ2V0XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLntcbiAgICAgICAgICAgIHJlY29yZHM6IHRoaXMucmVjb3JkcyxcbiAgICAgICAgICAgIHRvdGFsU2l6ZTogdGhpcy50b3RhbFNpemUsXG4gICAgICAgICAgICBkb25lOiByYXdEb25lID8/IHRydWUsIC8vIHdoZW4gbm8gcmVjb3JkcywgZG9uZSBpcyBvbWl0dGVkXG4gICAgICAgICAgfSxcbiAgICAgICAgICAuLi4odGhpcy5fbG9jYXRvciA/IHsgbmV4dFJlY29yZHNVcmw6IHRoaXMubG9jYXRvclRvVXJsKCkgfSA6IHt9KSxcbiAgICAgICAgfTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBhc3luYyBfZXhlY3V0ZShvcHRpb25zOiBRdWVyeU9wdGlvbnMpOiBQcm9taXNlPFF1ZXJ5UmVzcG9uc2U8Uj4+IHtcbiAgICBjb25zdCB7IGhlYWRlcnMsIHJlc3BvbnNlVGFyZ2V0LCBhdXRvRmV0Y2gsIG1heEZldGNoLCBzY2FuQWxsIH0gPSBvcHRpb25zO1xuICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZygnZXhlY3V0ZSB3aXRoIG9wdGlvbnMnLCBvcHRpb25zKTtcbiAgICBsZXQgdXJsO1xuICAgIGlmICh0aGlzLl9sb2NhdG9yKSB7XG4gICAgICB1cmwgPSB0aGlzLmxvY2F0b3JUb1VybCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzb3FsID0gYXdhaXQgdGhpcy50b1NPUUwoKTtcbiAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhgU09RTCA9ICR7c29xbH1gKTtcbiAgICAgIHVybCA9IFtcbiAgICAgICAgdGhpcy5fY29ubi5fYmFzZVVybCgpLFxuICAgICAgICAnLycsXG4gICAgICAgIHNjYW5BbGwgPyAncXVlcnlBbGwnIDogJ3F1ZXJ5JyxcbiAgICAgICAgJz9xPScsXG4gICAgICAgIGVuY29kZVVSSUNvbXBvbmVudChzb3FsKSxcbiAgICAgIF0uam9pbignJyk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLl9jb25uLnJlcXVlc3Q8Uj4oeyBtZXRob2Q6ICdHRVQnLCB1cmwsIGhlYWRlcnMgfSk7XG4gICAgdGhpcy5lbWl0KCdmZXRjaCcpO1xuICAgIHRoaXMudG90YWxTaXplID0gZGF0YS50b3RhbFNpemU7XG4gICAgdGhpcy5yZWNvcmRzID0gdGhpcy5yZWNvcmRzPy5jb25jYXQoXG4gICAgICBtYXhGZXRjaCAtIHRoaXMucmVjb3Jkcy5sZW5ndGggPiBkYXRhLnJlY29yZHMubGVuZ3RoXG4gICAgICAgID8gZGF0YS5yZWNvcmRzXG4gICAgICAgIDogZGF0YS5yZWNvcmRzLnNsaWNlKDAsIG1heEZldGNoIC0gdGhpcy5yZWNvcmRzLmxlbmd0aCksXG4gICAgKTtcbiAgICB0aGlzLl9sb2NhdG9yID0gZGF0YS5uZXh0UmVjb3Jkc1VybFxuICAgICAgPyB0aGlzLnVybFRvTG9jYXRvcihkYXRhLm5leHRSZWNvcmRzVXJsKVxuICAgICAgOiB1bmRlZmluZWQ7XG4gICAgdGhpcy5fZmluaXNoZWQgPVxuICAgICAgdGhpcy5fZmluaXNoZWQgfHxcbiAgICAgIGRhdGEuZG9uZSB8fFxuICAgICAgIWF1dG9GZXRjaCB8fFxuICAgICAgLy8gdGhpcyBpcyB3aGF0IHRoZSByZXNwb25zZSBsb29rcyBsaWtlIHdoZW4gdGhlcmUgYXJlIG5vIHJlc3VsdHNcbiAgICAgIChkYXRhLnJlY29yZHMubGVuZ3RoID09PSAwICYmIGRhdGEuZG9uZSA9PT0gdW5kZWZpbmVkKTtcblxuICAgIC8vIHN0cmVhbWluZyByZWNvcmQgaW5zdGFuY2VzXG4gICAgY29uc3QgbnVtUmVjb3JkcyA9IGRhdGEucmVjb3Jkcz8ubGVuZ3RoID8/IDA7XG4gICAgbGV0IHRvdGFsRmV0Y2hlZCA9IHRoaXMudG90YWxGZXRjaGVkO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtUmVjb3JkczsgaSsrKSB7XG4gICAgICBpZiAodG90YWxGZXRjaGVkID49IG1heEZldGNoKSB7XG4gICAgICAgIHRoaXMuX2ZpbmlzaGVkID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjb25zdCByZWNvcmQgPSBkYXRhLnJlY29yZHNbaV07XG4gICAgICB0aGlzLmVtaXQoJ3JlY29yZCcsIHJlY29yZCwgdG90YWxGZXRjaGVkLCB0aGlzKTtcbiAgICAgIHRvdGFsRmV0Y2hlZCArPSAxO1xuICAgIH1cbiAgICB0aGlzLnRvdGFsRmV0Y2hlZCA9IHRvdGFsRmV0Y2hlZDtcblxuICAgIGlmICh0aGlzLl9maW5pc2hlZCkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSB0aGlzLmNvbnN0cnVjdFJlc3BvbnNlKGRhdGEuZG9uZSwgcmVzcG9uc2VUYXJnZXQpO1xuICAgICAgLy8gb25seSBmaXJlIHJlc3BvbnNlIGV2ZW50IHdoZW4gaXQgc2hvdWxkIGJlIG5vdGlmaWVkIHBlciBmZXRjaFxuICAgICAgaWYgKHJlc3BvbnNlVGFyZ2V0ICE9PSBSZXNwb25zZVRhcmdldHMuUmVjb3Jkcykge1xuICAgICAgICB0aGlzLmVtaXQoJ3Jlc3BvbnNlJywgcmVzcG9uc2UsIHRoaXMpO1xuICAgICAgfVxuICAgICAgdGhpcy5lbWl0KCdlbmQnKTtcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuX2V4ZWN1dGUob3B0aW9ucyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE9idGFpbiByZWFkYWJsZSBzdHJlYW0gaW5zdGFuY2VcbiAgICovXG4gIHN0cmVhbSh0eXBlOiAncmVjb3JkJyk6IFNlcmlhbGl6YWJsZTxSPjtcbiAgc3RyZWFtKHR5cGU6ICdjc3YnKTogUmVhZGFibGU7XG4gIHN0cmVhbSh0eXBlOiAncmVjb3JkJyB8ICdjc3YnID0gJ2NzdicpIHtcbiAgICBpZiAoIXRoaXMuX2ZpbmlzaGVkICYmICF0aGlzLl9leGVjdXRlZCkge1xuICAgICAgdGhpcy5leGVjdXRlKHsgYXV0b0ZldGNoOiB0cnVlIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdHlwZSA9PT0gJ3JlY29yZCcgPyB0aGlzLl9zdHJlYW0gOiB0aGlzLl9zdHJlYW0uc3RyZWFtKHR5cGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBpcGUgdGhlIHF1ZXJpZWQgcmVjb3JkcyB0byBhbm90aGVyIHN0cmVhbVxuICAgKiBUaGlzIGlzIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5OyBRdWVyeSBpcyBub3QgYSByZWNvcmQgc3RyZWFtIGluc3RhbmNlIGFueW1vcmUgaW4gMi4wLlxuICAgKiBJZiB5b3Ugd2FudCBhIHJlY29yZCBzdHJlYW0gaW5zdGFuY2UsIHVzZSBgUXVlcnkjc3RyZWFtKCdyZWNvcmQnKWAuXG4gICAqL1xuICBwaXBlKHN0cmVhbTogTm9kZUpTLldyaXRhYmxlU3RyZWFtKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RyZWFtKCdyZWNvcmQnKS5waXBlKHN0cmVhbSk7XG4gIH1cblxuICAvKipcbiAgICogQHByb3RlY3RlZFxuICAgKi9cbiAgYXN5bmMgX2V4cGFuZEZpZWxkcyhzb2JqZWN0Xz86IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLl9zb3FsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdDYW5ub3QgZXhwYW5kIGZpZWxkcyBmb3IgdGhlIHF1ZXJ5IHdoaWNoIGhhcyBhbHJlYWR5IGJ1aWx0IFNPUUwuJyxcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IHsgZmllbGRzID0gW10sIHRhYmxlID0gJycgfSA9IHRoaXMuX2NvbmZpZztcbiAgICBjb25zdCBzb2JqZWN0ID0gc29iamVjdF8gfHwgdGFibGU7XG4gICAgdGhpcy5fbG9nZ2VyLmRlYnVnKFxuICAgICAgYF9leHBhbmRGaWVsZHM6IHNvYmplY3QgPSAke3NvYmplY3R9LCBmaWVsZHMgPSAke2ZpZWxkcy5qb2luKCcsICcpfWAsXG4gICAgKTtcbiAgICBjb25zdCBbZWZpZWxkc10gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICB0aGlzLl9leHBhbmRBc3Rlcmlza0ZpZWxkcyhzb2JqZWN0LCBmaWVsZHMpLFxuICAgICAgLi4udGhpcy5fY2hpbGRyZW4ubWFwKGFzeW5jIChjaGlsZFF1ZXJ5KSA9PiB7XG4gICAgICAgIGF3YWl0IGNoaWxkUXVlcnkuX2V4cGFuZEZpZWxkcygpO1xuICAgICAgICByZXR1cm4gW10gYXMgc3RyaW5nW107XG4gICAgICB9KSxcbiAgICBdKTtcbiAgICB0aGlzLl9jb25maWcuZmllbGRzID0gZWZpZWxkcztcbiAgICB0aGlzLl9jb25maWcuaW5jbHVkZXMgPSB0aGlzLl9jaGlsZHJlblxuICAgICAgLm1hcCgoY3F1ZXJ5KSA9PiB7XG4gICAgICAgIGNvbnN0IGNjb25maWcgPSBjcXVlcnkuX3F1ZXJ5Ll9jb25maWc7XG4gICAgICAgIHJldHVybiBbY2NvbmZpZy50YWJsZSwgY2NvbmZpZ10gYXMgW3N0cmluZywgU09RTFF1ZXJ5Q29uZmlnXTtcbiAgICAgIH0pXG4gICAgICAucmVkdWNlKFxuICAgICAgICAoaW5jbHVkZXMsIFtjdGFibGUsIGNjb25maWddKSA9PiAoe1xuICAgICAgICAgIC4uLmluY2x1ZGVzLFxuICAgICAgICAgIFtjdGFibGVdOiBjY29uZmlnLFxuICAgICAgICB9KSxcbiAgICAgICAge30gYXMgeyBbbmFtZTogc3RyaW5nXTogU09RTFF1ZXJ5Q29uZmlnIH0sXG4gICAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBhc3luYyBfZmluZFJlbGF0aW9uT2JqZWN0KHJlbE5hbWU6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgdGFibGUgPSB0aGlzLl9jb25maWcudGFibGU7XG4gICAgaWYgKCF0YWJsZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyB0YWJsZSBpbmZvcm1hdGlvbiBwcm92aWRlZCBpbiB0aGUgcXVlcnknKTtcbiAgICB9XG4gICAgdGhpcy5fbG9nZ2VyLmRlYnVnKFxuICAgICAgYGZpbmRpbmcgdGFibGUgZm9yIHJlbGF0aW9uIFwiJHtyZWxOYW1lfVwiIGluIFwiJHt0YWJsZX1cIi4uLmAsXG4gICAgKTtcbiAgICBjb25zdCBzb2JqZWN0ID0gYXdhaXQgdGhpcy5fY29ubi5kZXNjcmliZSQodGFibGUpO1xuICAgIGNvbnN0IHVwcGVyUm5hbWUgPSByZWxOYW1lLnRvVXBwZXJDYXNlKCk7XG4gICAgZm9yIChjb25zdCBjciBvZiBzb2JqZWN0LmNoaWxkUmVsYXRpb25zaGlwcykge1xuICAgICAgaWYgKFxuICAgICAgICAoY3IucmVsYXRpb25zaGlwTmFtZSB8fCAnJykudG9VcHBlckNhc2UoKSA9PT0gdXBwZXJSbmFtZSAmJlxuICAgICAgICBjci5jaGlsZFNPYmplY3RcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gY3IuY2hpbGRTT2JqZWN0O1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGNoaWxkIHJlbGF0aW9uc2hpcCBmb3VuZDogJHtyZWxOYW1lfWApO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBhc3luYyBfZXhwYW5kQXN0ZXJpc2tGaWVsZHMoXG4gICAgc29iamVjdDogc3RyaW5nLFxuICAgIGZpZWxkczogc3RyaW5nW10sXG4gICk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBleHBhbmRlZEZpZWxkcyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgZmllbGRzLm1hcChhc3luYyAoZmllbGQpID0+IHRoaXMuX2V4cGFuZEFzdGVyaXNrRmllbGQoc29iamVjdCwgZmllbGQpKSxcbiAgICApO1xuICAgIHJldHVybiBleHBhbmRlZEZpZWxkcy5yZWR1Y2UoXG4gICAgICAoZWZsZHM6IHN0cmluZ1tdLCBmbGRzOiBzdHJpbmdbXSk6IHN0cmluZ1tdID0+IFsuLi5lZmxkcywgLi4uZmxkc10sXG4gICAgICBbXSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBhc3luYyBfZXhwYW5kQXN0ZXJpc2tGaWVsZChcbiAgICBzb2JqZWN0OiBzdHJpbmcsXG4gICAgZmllbGQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhgZXhwYW5kaW5nIGZpZWxkIFwiJHtmaWVsZH1cIiBpbiBcIiR7c29iamVjdH1cIi4uLmApO1xuICAgIGNvbnN0IGZwYXRoID0gZmllbGQuc3BsaXQoJy4nKTtcbiAgICBpZiAoZnBhdGhbZnBhdGgubGVuZ3RoIC0gMV0gPT09ICcqJykge1xuICAgICAgY29uc3Qgc28gPSBhd2FpdCB0aGlzLl9jb25uLmRlc2NyaWJlJChzb2JqZWN0KTtcbiAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhgdGFibGUgJHtzb2JqZWN0fSBoYXMgYmVlbiBkZXNjcmliZWRgKTtcbiAgICAgIGlmIChmcGF0aC5sZW5ndGggPiAxKSB7XG4gICAgICAgIGNvbnN0IHJuYW1lID0gZnBhdGguc2hpZnQoKTtcbiAgICAgICAgZm9yIChjb25zdCBmIG9mIHNvLmZpZWxkcykge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIGYucmVsYXRpb25zaGlwTmFtZSAmJlxuICAgICAgICAgICAgcm5hbWUgJiZcbiAgICAgICAgICAgIGYucmVsYXRpb25zaGlwTmFtZS50b1VwcGVyQ2FzZSgpID09PSBybmFtZS50b1VwcGVyQ2FzZSgpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBjb25zdCByZmllbGQgPSBmO1xuICAgICAgICAgICAgY29uc3QgcmVmZXJlbmNlVG8gPSByZmllbGQucmVmZXJlbmNlVG8gfHwgW107XG4gICAgICAgICAgICBjb25zdCBydGFibGUgPSByZWZlcmVuY2VUby5sZW5ndGggPT09IDEgPyByZWZlcmVuY2VUb1swXSA6ICdOYW1lJztcbiAgICAgICAgICAgIGNvbnN0IGZwYXRocyA9IGF3YWl0IHRoaXMuX2V4cGFuZEFzdGVyaXNrRmllbGQoXG4gICAgICAgICAgICAgIHJ0YWJsZSxcbiAgICAgICAgICAgICAgZnBhdGguam9pbignLicpLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBmcGF0aHMubWFwKChmcCkgPT4gYCR7cm5hbWV9LiR7ZnB9YCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzby5maWVsZHMubWFwKChmKSA9PiBmLm5hbWUpO1xuICAgIH1cbiAgICByZXR1cm4gW2ZpZWxkXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBsYWluIHBsYW4gZm9yIGV4ZWN1dGluZyBxdWVyeVxuICAgKi9cbiAgYXN5bmMgZXhwbGFpbigpIHtcbiAgICBjb25zdCBzb3FsID0gYXdhaXQgdGhpcy50b1NPUUwoKTtcbiAgICB0aGlzLl9sb2dnZXIuZGVidWcoYFNPUUwgPSAke3NvcWx9YCk7XG4gICAgY29uc3QgdXJsID0gYC9xdWVyeS8/ZXhwbGFpbj0ke2VuY29kZVVSSUNvbXBvbmVudChzb3FsKX1gO1xuICAgIHJldHVybiB0aGlzLl9jb25uLnJlcXVlc3Q8UXVlcnlFeHBsYWluUmVzdWx0Pih1cmwpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBTT1FMIGV4cHJlc3Npb24gZm9yIHRoZSBxdWVyeVxuICAgKi9cbiAgYXN5bmMgdG9TT1FMKCkge1xuICAgIGlmICh0aGlzLl9zb3FsKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc29xbDtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5fZXhwYW5kRmllbGRzKCk7XG4gICAgcmV0dXJuIGNyZWF0ZVNPUUwodGhpcy5fY29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9taXNlL0ErIGludGVyZmFjZVxuICAgKiBodHRwOi8vcHJvbWlzZXMtYXBsdXMuZ2l0aHViLmlvL3Byb21pc2VzLXNwZWMvXG4gICAqXG4gICAqIERlbGVnYXRlIHRvIGRlZmVycmVkIHByb21pc2UsIHJldHVybiBwcm9taXNlIGluc3RhbmNlIGZvciBxdWVyeSByZXN1bHRcbiAgICovXG4gIHRoZW48VSwgVj4oXG4gICAgb25SZXNvbHZlPzpcbiAgICAgIHwgKChxcjogUXVlcnlSZXNwb25zZTxSLCBRUlQ+KSA9PiBVIHwgUHJvbWlzZTxVPilcbiAgICAgIHwgbnVsbFxuICAgICAgfCB1bmRlZmluZWQsXG4gICAgb25SZWplY3Q/OiAoKGVycjogRXJyb3IpID0+IFYgfCBQcm9taXNlPFY+KSB8IG51bGwgfCB1bmRlZmluZWQsXG4gICk6IFByb21pc2U8VSB8IFY+IHtcbiAgICB0aGlzLl9jaGFpbmluZyA9IHRydWU7XG4gICAgaWYgKCF0aGlzLl9maW5pc2hlZCAmJiAhdGhpcy5fZXhlY3V0ZWQpIHtcbiAgICAgIHRoaXMuZXhlY3V0ZSgpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuX3Byb21pc2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ2ludmFsaWQgc3RhdGU6IHByb21pc2UgaXMgbm90IHNldCBhZnRlciBxdWVyeSBleGVjdXRpb24nLFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3Byb21pc2UudGhlbihvblJlc29sdmUsIG9uUmVqZWN0KTtcbiAgfVxuXG4gIGNhdGNoKFxuICAgIG9uUmVqZWN0OiAoXG4gICAgICBlcnI6IEVycm9yLFxuICAgICkgPT4gUXVlcnlSZXNwb25zZTxSLCBRUlQ+IHwgUHJvbWlzZTxRdWVyeVJlc3BvbnNlPFIsIFFSVD4+LFxuICApOiBQcm9taXNlPFF1ZXJ5UmVzcG9uc2U8UiwgUVJUPj4ge1xuICAgIHJldHVybiB0aGlzLnRoZW4obnVsbCwgb25SZWplY3QpO1xuICB9XG5cbiAgcHJvbWlzZSgpOiBQcm9taXNlPFF1ZXJ5UmVzcG9uc2U8UiwgUVJUPj4ge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogQnVsayBkZWxldGUgcXVlcmllZCByZWNvcmRzXG4gICAqL1xuICBkZXN0cm95KG9wdGlvbnM/OiBRdWVyeURlc3Ryb3lPcHRpb25zKTogUHJvbWlzZTxTYXZlUmVzdWx0W10+O1xuICBkZXN0cm95KHR5cGU6IE4sIG9wdGlvbnM/OiBRdWVyeURlc3Ryb3lPcHRpb25zKTogUHJvbWlzZTxTYXZlUmVzdWx0W10+O1xuICBkZXN0cm95KHR5cGU/OiBOIHwgUXVlcnlEZXN0cm95T3B0aW9ucywgb3B0aW9ucz86IFF1ZXJ5RGVzdHJveU9wdGlvbnMpIHtcbiAgICBpZiAodHlwZW9mIHR5cGUgPT09ICdvYmplY3QnICYmIHR5cGUgIT09IG51bGwpIHtcbiAgICAgIG9wdGlvbnMgPSB0eXBlO1xuICAgICAgdHlwZSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgY29uc3QgdHlwZV86IE9wdGlvbmFsPE4+ID0gdHlwZSB8fCAodGhpcy5fY29uZmlnLnRhYmxlIGFzIE9wdGlvbmFsPE4+KTtcbiAgICBpZiAoIXR5cGVfKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdTT1FMIGJhc2VkIHF1ZXJ5IG5lZWRzIFNPYmplY3QgdHlwZSBpbmZvcm1hdGlvbiB0byBidWxrIGRlbGV0ZS4nLFxuICAgICAgKTtcbiAgICB9XG4gICAgLy8gU2V0IHRoZSB0aHJlc2hvbGQgbnVtYmVyIHRvIHBhc3MgdG8gYnVsayBBUElcbiAgICBjb25zdCB0aHJlc2hvbGROdW0gPVxuICAgICAgb3B0aW9ucy5hbGxvd0J1bGsgPT09IGZhbHNlXG4gICAgICAgID8gLTFcbiAgICAgICAgOiB0eXBlb2Ygb3B0aW9ucy5idWxrVGhyZXNob2xkID09PSAnbnVtYmVyJ1xuICAgICAgICA/IG9wdGlvbnMuYnVsa1RocmVzaG9sZFxuICAgICAgICA6IC8vIGRldGVybWluZSB0aHJlc2hvbGQgaWYgdGhlIGNvbm5lY3Rpb24gdmVyc2lvbiBzdXBwb3J0cyBTT2JqZWN0IGNvbGxlY3Rpb24gQVBJIG9yIG5vdFxuICAgICAgICB0aGlzLl9jb25uLl9lbnN1cmVWZXJzaW9uKDQyKVxuICAgICAgICA/IERFRkFVTFRfQlVMS19USFJFU0hPTERcbiAgICAgICAgOiB0aGlzLl9jb25uLl9tYXhSZXF1ZXN0IC8gMjtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgY3JlYXRlQmF0Y2ggPSAoKSA9PlxuICAgICAgICB0aGlzLl9jb25uXG4gICAgICAgICAgLnNvYmplY3QodHlwZV8pXG4gICAgICAgICAgLmRlbGV0ZUJ1bGsoKVxuICAgICAgICAgIC5vbigncmVzcG9uc2UnLCByZXNvbHZlKVxuICAgICAgICAgIC5vbignZXJyb3InLCByZWplY3QpO1xuICAgICAgbGV0IHJlY29yZHM6IFJlY29yZFtdID0gW107XG4gICAgICBsZXQgYmF0Y2g6IFJldHVyblR5cGU8dHlwZW9mIGNyZWF0ZUJhdGNoPiB8IG51bGwgPSBudWxsO1xuICAgICAgY29uc3QgaGFuZGxlUmVjb3JkID0gKHJlYzogUmVjb3JkKSA9PiB7XG4gICAgICAgIGlmICghcmVjLklkKSB7XG4gICAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKFxuICAgICAgICAgICAgJ1F1ZXJpZWQgcmVjb3JkIGRvZXMgbm90IGluY2x1ZGUgU2FsZXNmb3JjZSByZWNvcmQgSUQuJyxcbiAgICAgICAgICApO1xuICAgICAgICAgIHRoaXMuZW1pdCgnZXJyb3InLCBlcnIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZWNvcmQ6IFJlY29yZCA9IHsgSWQ6IHJlYy5JZCB9O1xuICAgICAgICBpZiAoYmF0Y2gpIHtcbiAgICAgICAgICBiYXRjaC53cml0ZShyZWNvcmQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlY29yZHMucHVzaChyZWNvcmQpO1xuICAgICAgICAgIGlmICh0aHJlc2hvbGROdW0gPj0gMCAmJiByZWNvcmRzLmxlbmd0aCA+IHRocmVzaG9sZE51bSkge1xuICAgICAgICAgICAgLy8gVXNlIGJ1bGsgZGVsZXRlIGluc3RlYWQgb2YgU09iamVjdCBSRVNUIEFQSVxuICAgICAgICAgICAgYmF0Y2ggPSBjcmVhdGVCYXRjaCgpO1xuICAgICAgICAgICAgZm9yIChjb25zdCByZWNvcmQgb2YgcmVjb3Jkcykge1xuICAgICAgICAgICAgICBiYXRjaC53cml0ZShyZWNvcmQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVjb3JkcyA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IGhhbmRsZUVuZCA9ICgpID0+IHtcbiAgICAgICAgaWYgKGJhdGNoKSB7XG4gICAgICAgICAgYmF0Y2guZW5kKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgaWRzID0gcmVjb3Jkcy5tYXAoKHJlY29yZCkgPT4gcmVjb3JkLklkIGFzIHN0cmluZyk7XG4gICAgICAgICAgdGhpcy5fY29ublxuICAgICAgICAgICAgLnNvYmplY3QodHlwZV8pXG4gICAgICAgICAgICAuZGVzdHJveShpZHMsIHsgYWxsb3dSZWN1cnNpdmU6IHRydWUgfSlcbiAgICAgICAgICAgIC50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB0aGlzLnN0cmVhbSgncmVjb3JkJylcbiAgICAgICAgLm9uKCdkYXRhJywgaGFuZGxlUmVjb3JkKVxuICAgICAgICAub24oJ2VuZCcsIGhhbmRsZUVuZClcbiAgICAgICAgLm9uKCdlcnJvcicsIHJlamVjdCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU3lub255bSBvZiBRdWVyeSNkZXN0cm95KClcbiAgICovXG4gIGRlbGV0ZSA9IHRoaXMuZGVzdHJveTtcblxuICAvKipcbiAgICogU3lub255bSBvZiBRdWVyeSNkZXN0cm95KClcbiAgICovXG4gIGRlbCA9IHRoaXMuZGVzdHJveTtcblxuICAvKipcbiAgICogQnVsayB1cGRhdGUgcXVlcmllZCByZWNvcmRzLCB1c2luZyBnaXZlbiBtYXBwaW5nIGZ1bmN0aW9uL29iamVjdFxuICAgKi9cbiAgdXBkYXRlPFVSIGV4dGVuZHMgU09iamVjdElucHV0UmVjb3JkPFMsIE4+PihcbiAgICBtYXBwaW5nOiAoKHJlYzogUikgPT4gVVIpIHwgVVIsXG4gICAgdHlwZTogTixcbiAgICBvcHRpb25zPzogUXVlcnlVcGRhdGVPcHRpb25zLFxuICApOiBQcm9taXNlPFNhdmVSZXN1bHRbXT47XG4gIHVwZGF0ZTxVUiBleHRlbmRzIFNPYmplY3RJbnB1dFJlY29yZDxTLCBOPj4oXG4gICAgbWFwcGluZzogKChyZWM6IFIpID0+IFVSKSB8IFVSLFxuICAgIG9wdGlvbnM/OiBRdWVyeVVwZGF0ZU9wdGlvbnMsXG4gICk6IFByb21pc2U8U2F2ZVJlc3VsdFtdPjtcbiAgdXBkYXRlPFVSIGV4dGVuZHMgU09iamVjdElucHV0UmVjb3JkPFMsIE4+PihcbiAgICBtYXBwaW5nOiAoKHJlYzogUikgPT4gVVIpIHwgVVIsXG4gICAgdHlwZT86IE4gfCBRdWVyeVVwZGF0ZU9wdGlvbnMsXG4gICAgb3B0aW9ucz86IFF1ZXJ5VXBkYXRlT3B0aW9ucyxcbiAgKSB7XG4gICAgaWYgKHR5cGVvZiB0eXBlID09PSAnb2JqZWN0JyAmJiB0eXBlICE9PSBudWxsKSB7XG4gICAgICBvcHRpb25zID0gdHlwZTtcbiAgICAgIHR5cGUgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIGNvbnN0IHR5cGVfOiBPcHRpb25hbDxOPiA9XG4gICAgICB0eXBlIHx8ICh0aGlzLl9jb25maWcgJiYgKHRoaXMuX2NvbmZpZy50YWJsZSBhcyBPcHRpb25hbDxOPikpO1xuICAgIGlmICghdHlwZV8pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ1NPUUwgYmFzZWQgcXVlcnkgbmVlZHMgU09iamVjdCB0eXBlIGluZm9ybWF0aW9uIHRvIGJ1bGsgdXBkYXRlLicsXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCB1cGRhdGVTdHJlYW0gPVxuICAgICAgdHlwZW9mIG1hcHBpbmcgPT09ICdmdW5jdGlvbidcbiAgICAgICAgPyBSZWNvcmRTdHJlYW0ubWFwKG1hcHBpbmcpXG4gICAgICAgIDogUmVjb3JkU3RyZWFtLnJlY29yZE1hcFN0cmVhbShtYXBwaW5nKTtcbiAgICAvLyBTZXQgdGhlIHRocmVzaG9sZCBudW1iZXIgdG8gcGFzcyB0byBidWxrIEFQSVxuICAgIGNvbnN0IHRocmVzaG9sZE51bSA9XG4gICAgICBvcHRpb25zLmFsbG93QnVsayA9PT0gZmFsc2VcbiAgICAgICAgPyAtMVxuICAgICAgICA6IHR5cGVvZiBvcHRpb25zLmJ1bGtUaHJlc2hvbGQgPT09ICdudW1iZXInXG4gICAgICAgID8gb3B0aW9ucy5idWxrVGhyZXNob2xkXG4gICAgICAgIDogLy8gZGV0ZXJtaW5lIHRocmVzaG9sZCBpZiB0aGUgY29ubmVjdGlvbiB2ZXJzaW9uIHN1cHBvcnRzIFNPYmplY3QgY29sbGVjdGlvbiBBUEkgb3Igbm90XG4gICAgICAgIHRoaXMuX2Nvbm4uX2Vuc3VyZVZlcnNpb24oNDIpXG4gICAgICAgID8gREVGQVVMVF9CVUxLX1RIUkVTSE9MRFxuICAgICAgICA6IHRoaXMuX2Nvbm4uX21heFJlcXVlc3QgLyAyO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVCYXRjaCA9ICgpID0+XG4gICAgICAgIHRoaXMuX2Nvbm5cbiAgICAgICAgICAuc29iamVjdCh0eXBlXylcbiAgICAgICAgICAudXBkYXRlQnVsaygpXG4gICAgICAgICAgLm9uKCdyZXNwb25zZScsIHJlc29sdmUpXG4gICAgICAgICAgLm9uKCdlcnJvcicsIHJlamVjdCk7XG4gICAgICBsZXQgcmVjb3JkczogU09iamVjdFVwZGF0ZVJlY29yZDxTLCBOPltdID0gW107XG4gICAgICBsZXQgYmF0Y2g6IFJldHVyblR5cGU8dHlwZW9mIGNyZWF0ZUJhdGNoPiB8IG51bGwgPSBudWxsO1xuICAgICAgY29uc3QgaGFuZGxlUmVjb3JkID0gKHJlY29yZDogUmVjb3JkKSA9PiB7XG4gICAgICAgIGlmIChiYXRjaCkge1xuICAgICAgICAgIGJhdGNoLndyaXRlKHJlY29yZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVjb3Jkcy5wdXNoKHJlY29yZCBhcyBTT2JqZWN0VXBkYXRlUmVjb3JkPFMsIE4+KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhyZXNob2xkTnVtID49IDAgJiYgcmVjb3Jkcy5sZW5ndGggPiB0aHJlc2hvbGROdW0pIHtcbiAgICAgICAgICAvLyBVc2UgYnVsayB1cGRhdGUgaW5zdGVhZCBvZiBTT2JqZWN0IFJFU1QgQVBJXG4gICAgICAgICAgYmF0Y2ggPSBjcmVhdGVCYXRjaCgpO1xuICAgICAgICAgIGZvciAoY29uc3QgcmVjb3JkIG9mIHJlY29yZHMpIHtcbiAgICAgICAgICAgIGJhdGNoLndyaXRlKHJlY29yZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlY29yZHMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IGhhbmRsZUVuZCA9ICgpID0+IHtcbiAgICAgICAgaWYgKGJhdGNoKSB7XG4gICAgICAgICAgYmF0Y2guZW5kKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5fY29ublxuICAgICAgICAgICAgLnNvYmplY3QodHlwZV8pXG4gICAgICAgICAgICAudXBkYXRlKHJlY29yZHMsIHsgYWxsb3dSZWN1cnNpdmU6IHRydWUgfSlcbiAgICAgICAgICAgIC50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB0aGlzLnN0cmVhbSgncmVjb3JkJylcbiAgICAgICAgLm9uKCdlcnJvcicsIHJlamVjdClcbiAgICAgICAgLnBpcGUodXBkYXRlU3RyZWFtKVxuICAgICAgICAub24oJ2RhdGEnLCBoYW5kbGVSZWNvcmQpXG4gICAgICAgIC5vbignZW5kJywgaGFuZGxlRW5kKVxuICAgICAgICAub24oJ2Vycm9yJywgcmVqZWN0KTtcbiAgICB9KTtcbiAgfVxufVxuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuLyoqXG4gKiBTdWJRdWVyeSBvYmplY3QgZm9yIHJlcHJlc2VudGluZyBjaGlsZCByZWxhdGlvbnNoaXAgcXVlcnlcbiAqL1xuZXhwb3J0IGNsYXNzIFN1YlF1ZXJ5PFxuICBTIGV4dGVuZHMgU2NoZW1hLFxuICBQTiBleHRlbmRzIFNPYmplY3ROYW1lczxTPixcbiAgUFIgZXh0ZW5kcyBSZWNvcmQsXG4gIFBRUlQgZXh0ZW5kcyBRdWVyeVJlc3BvbnNlVGFyZ2V0LFxuICBDUk4gZXh0ZW5kcyBDaGlsZFJlbGF0aW9uc2hpcE5hbWVzPFMsIFBOPiA9IENoaWxkUmVsYXRpb25zaGlwTmFtZXM8UywgUE4+LFxuICBDTiBleHRlbmRzIFNPYmplY3ROYW1lczxTPiA9IENoaWxkUmVsYXRpb25zaGlwU09iamVjdE5hbWU8UywgUE4sIENSTj4sXG4gIENSIGV4dGVuZHMgUmVjb3JkID0gUmVjb3JkXG4+IHtcbiAgX3JlbE5hbWU6IENSTjtcbiAgX3F1ZXJ5OiBRdWVyeTxTLCBDTiwgQ1I+O1xuICBfcGFyZW50OiBRdWVyeTxTLCBQTiwgUFIsIFBRUlQ+O1xuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgY29ubjogQ29ubmVjdGlvbjxTPixcbiAgICByZWxOYW1lOiBDUk4sXG4gICAgY29uZmlnOiBRdWVyeUNvbmZpZzxTLCBDTj4sXG4gICAgcGFyZW50OiBRdWVyeTxTLCBQTiwgUFIsIFBRUlQ+LFxuICApIHtcbiAgICB0aGlzLl9yZWxOYW1lID0gcmVsTmFtZTtcbiAgICB0aGlzLl9xdWVyeSA9IG5ldyBRdWVyeShjb25uLCBjb25maWcpO1xuICAgIHRoaXMuX3BhcmVudCA9IHBhcmVudDtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgc2VsZWN0PFxuICAgIFIgZXh0ZW5kcyBSZWNvcmQgPSBSZWNvcmQsXG4gICAgRlAgZXh0ZW5kcyBGaWVsZFBhdGhTcGVjaWZpZXI8UywgQ04+ID0gRmllbGRQYXRoU3BlY2lmaWVyPFMsIENOPixcbiAgICBGUEMgZXh0ZW5kcyBGaWVsZFByb2plY3Rpb25Db25maWcgPSBGaWVsZFBhdGhTY29wZWRQcm9qZWN0aW9uPFMsIENOLCBGUD5cbiAgPihcbiAgICBmaWVsZHM6IFF1ZXJ5RmllbGQ8UywgQ04sIEZQPixcbiAgKTogU3ViUXVlcnk8UywgUE4sIFBSLCBQUVJULCBDUk4sIENOLCBTT2JqZWN0UmVjb3JkPFMsIENOLCBGUEMsIFI+PiB7XG4gICAgLy8gZm9yY2UgY29udmVydCBxdWVyeSByZWNvcmQgdHlwZSB3aXRob3V0IGNoYW5naW5nIGluc3RhbmNlXG4gICAgdGhpcy5fcXVlcnkgPSB0aGlzLl9xdWVyeS5zZWxlY3QoZmllbGRzKSBhcyBhbnk7XG4gICAgcmV0dXJuICh0aGlzIGFzIGFueSkgYXMgU3ViUXVlcnk8XG4gICAgICBTLFxuICAgICAgUE4sXG4gICAgICBQUixcbiAgICAgIFBRUlQsXG4gICAgICBDUk4sXG4gICAgICBDTixcbiAgICAgIFNPYmplY3RSZWNvcmQ8UywgQ04sIEZQQywgUj5cbiAgICA+O1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICB3aGVyZShjb25kaXRpb25zOiBRdWVyeUNvbmRpdGlvbjxTLCBDTj4gfCBzdHJpbmcpOiB0aGlzIHtcbiAgICB0aGlzLl9xdWVyeSA9IHRoaXMuX3F1ZXJ5LndoZXJlKGNvbmRpdGlvbnMpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIExpbWl0IHRoZSByZXR1cm5pbmcgcmVzdWx0XG4gICAqL1xuICBsaW1pdChsaW1pdDogbnVtYmVyKSB7XG4gICAgdGhpcy5fcXVlcnkgPSB0aGlzLl9xdWVyeS5saW1pdChsaW1pdCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogU2tpcCByZWNvcmRzXG4gICAqL1xuICBza2lwKG9mZnNldDogbnVtYmVyKSB7XG4gICAgdGhpcy5fcXVlcnkgPSB0aGlzLl9xdWVyeS5za2lwKG9mZnNldCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogU3lub255bSBvZiBTdWJRdWVyeSNza2lwKClcbiAgICovXG4gIG9mZnNldCA9IHRoaXMuc2tpcDtcblxuICAvKipcbiAgICogU2V0IHF1ZXJ5IHNvcnQgd2l0aCBkaXJlY3Rpb25cbiAgICovXG4gIHNvcnQoc29ydDogUXVlcnlTb3J0PFMsIENOPik6IHRoaXM7XG4gIHNvcnQoc29ydDogc3RyaW5nKTogdGhpcztcbiAgc29ydChzb3J0OiBTT2JqZWN0RmllbGROYW1lczxTLCBDTj4sIGRpcjogU29ydERpcik6IHRoaXM7XG4gIHNvcnQoc29ydDogc3RyaW5nLCBkaXI6IFNvcnREaXIpOiB0aGlzO1xuICBzb3J0KFxuICAgIHNvcnQ6IFF1ZXJ5U29ydDxTLCBDTj4gfCBTT2JqZWN0RmllbGROYW1lczxTLCBDTj4gfCBzdHJpbmcsXG4gICAgZGlyPzogU29ydERpcixcbiAgKSB7XG4gICAgdGhpcy5fcXVlcnkgPSB0aGlzLl9xdWVyeS5zb3J0KHNvcnQgYXMgYW55LCBkaXIgYXMgU29ydERpcik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogU3lub255bSBvZiBTdWJRdWVyeSNzb3J0KClcbiAgICovXG4gIG9yZGVyYnk6IHR5cGVvZiBTdWJRdWVyeS5wcm90b3R5cGUuc29ydCA9IHRoaXMuc29ydDtcblxuICAvKipcbiAgICpcbiAgICovXG4gIGFzeW5jIF9leHBhbmRGaWVsZHMoKSB7XG4gICAgY29uc3Qgc29iamVjdCA9IGF3YWl0IHRoaXMuX3BhcmVudC5fZmluZFJlbGF0aW9uT2JqZWN0KHRoaXMuX3JlbE5hbWUpO1xuICAgIHJldHVybiB0aGlzLl9xdWVyeS5fZXhwYW5kRmllbGRzKHNvYmplY3QpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJhY2sgdGhlIGNvbnRleHQgdG8gcGFyZW50IHF1ZXJ5IG9iamVjdFxuICAgKi9cbiAgZW5kPFxuICAgIENSUCBleHRlbmRzIFNPYmplY3RDaGlsZFJlbGF0aW9uc2hpcFByb3A8XG4gICAgICBDUk4sXG4gICAgICBDUlxuICAgID4gPSBTT2JqZWN0Q2hpbGRSZWxhdGlvbnNoaXBQcm9wPENSTiwgQ1I+LFxuICAgIFBSMSBleHRlbmRzIFJlY29yZCA9IFBSICYgQ1JQXG4gID4oKTogUXVlcnk8UywgUE4sIFBSMSwgUFFSVD4ge1xuICAgIHJldHVybiAodGhpcy5fcGFyZW50IGFzIGFueSkgYXMgUXVlcnk8UywgUE4sIFBSMSwgUFFSVD47XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUXVlcnk7XG4iXX0=