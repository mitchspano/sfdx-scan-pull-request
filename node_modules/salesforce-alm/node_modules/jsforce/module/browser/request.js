import _Object$defineProperty from "@babel/runtime-corejs3/core-js-stable/object/define-property";
import _Object$defineProperties from "@babel/runtime-corejs3/core-js-stable/object/define-properties";
import _Object$getOwnPropertyDescriptors from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors";
import _forEachInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/for-each";
import _Object$getOwnPropertyDescriptor from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor";
import _Object$getOwnPropertySymbols from "@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols";
import _Object$keys from "@babel/runtime-corejs3/core-js-stable/object/keys";
import "core-js/modules/es.array.iterator";
import "core-js/modules/es.promise";
import _reduceInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/reduce";
import _Promise from "@babel/runtime-corejs3/core-js-stable/promise";
import _mapInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/map";
import _trimInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/trim";
import _filterInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/filter";
import _keysInstanceProperty from "@babel/runtime-corejs3/core-js-stable/instance/keys";
import _defineProperty from "@babel/runtime-corejs3/helpers/defineProperty";
import _objectWithoutProperties from "@babel/runtime-corejs3/helpers/objectWithoutProperties";

function ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = _filterInstanceProperty(symbols).call(symbols, function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { var _context3; _forEachInstanceProperty(_context3 = ownKeys(Object(source), true)).call(_context3, function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { var _context4; _forEachInstanceProperty(_context4 = ownKeys(Object(source))).call(_context4, function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }

import { createHttpRequestHandlerStreams, executeWithTimeout, isRedirect, performRedirectRequest } from '../request-helper';
import { readAll } from '../util/stream';

/**
 * As the request streming is not yet supported on major browsers,
 * it is set to false for now.
 */
const supportsReadableStream = false;
/*
(async () => {
  try {
    if (
      typeof fetch === 'function' &&
      typeof Request === 'function' &&
      typeof ReadableStream === 'function'
    ) {
      // this feature detection requires dummy POST request
      const req = new Request('data:text/plain,', {
        method: 'POST',
        body: new ReadableStream(),
      });
      // if it has content-type header it doesn't regard body as stream
      if (req.headers.has('Content-Type')) {
        return false;
      }
      await (await fetch(req)).text();
      return true;
    }
  } catch (e) {
    // error might occur in env with CSP without connect-src data:
    return false;
  }
  return false;
})();
*/

/**
 *
 */

function toWhatwgReadableStream(ins) {
  return new ReadableStream({
    start(controller) {
      ins.on('data', chunk => controller.enqueue(chunk));
      ins.on('end', () => controller.close());
    }

  });
}
/**
 *
 */


async function readWhatwgReadableStream(rs, outs) {
  const reader = rs.getReader();

  async function readAndWrite() {
    const {
      done,
      value
    } = await reader.read();

    if (done) {
      outs.end();
      return false;
    }

    outs.write(value);
    return true;
  }

  while (await readAndWrite());
}
/**
 *
 */


async function startFetchRequest(request, options, input, output, emitter, counter = 0) {
  const {
    followRedirect
  } = options;

  const {
    url,
    body: reqBody
  } = request,
        rreq = _objectWithoutProperties(request, ["url", "body"]);

  const body = input && /^(post|put|patch)$/i.test(request.method) ? supportsReadableStream ? toWhatwgReadableStream(input) : await readAll(input) : undefined;
  const controller = typeof AbortController !== 'undefined' ? new AbortController() : undefined;
  const res = await executeWithTimeout(() => fetch(url, _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, rreq), body ? {
    body
  } : {}), {}, {
    redirect: 'manual'
  }, controller ? {
    signal: controller.signal
  } : {}), {
    allowHTTP1ForStreamingUpload: true
  })), options.timeout, () => controller === null || controller === void 0 ? void 0 : controller.abort());
  const headers = {};

  for (const headerName of _keysInstanceProperty(_context = res.headers).call(_context)) {
    var _context;

    headers[headerName.toLowerCase()] = res.headers.get(headerName);
  }

  const response = {
    statusCode: res.status,
    headers
  };

  if (followRedirect && isRedirect(response.statusCode)) {
    try {
      performRedirectRequest(request, response, followRedirect, counter, req => startFetchRequest(req, options, undefined, output, emitter, counter + 1));
    } catch (err) {
      emitter.emit('error', err);
    }

    return;
  }

  emitter.emit('response', response);

  if (res.body) {
    readWhatwgReadableStream(res.body, output);
  } else {
    output.end();
  }
}
/**
 *
 */


function getResponseHeaderNames(xhr) {
  var _context2;

  const headerLines = _filterInstanceProperty(_context2 = (xhr.getAllResponseHeaders() || '').split(/[\r\n]+/)).call(_context2, l => _trimInstanceProperty(l).call(l) !== '');

  return _mapInstanceProperty(headerLines).call(headerLines, headerLine => headerLine.split(/\s*:/)[0].toLowerCase());
}
/**
 *
 */


async function startXmlHttpRequest(request, options, input, output, emitter, counter = 0) {
  const {
    method,
    url,
    headers: reqHeaders
  } = request;
  const {
    followRedirect
  } = options;
  const reqBody = input && /^(post|put|patch)$/i.test(method) ? await readAll(input) : null;
  const xhr = new XMLHttpRequest();
  await executeWithTimeout(() => {
    xhr.open(method, url);

    if (reqHeaders) {
      for (const header in reqHeaders) {
        xhr.setRequestHeader(header, reqHeaders[header]);
      }
    }

    if (options.timeout) {
      xhr.timeout = options.timeout;
    }

    xhr.responseType = 'arraybuffer';
    xhr.send(reqBody);
    return new _Promise((resolve, reject) => {
      xhr.onload = () => resolve();

      xhr.onerror = reject;
      xhr.ontimeout = reject;
      xhr.onabort = reject;
    });
  }, options.timeout, () => xhr.abort());
  const headerNames = getResponseHeaderNames(xhr);

  const headers = _reduceInstanceProperty(headerNames).call(headerNames, (headers, headerName) => _objectSpread(_objectSpread({}, headers), {}, {
    [headerName]: xhr.getResponseHeader(headerName) || ''
  }), {});

  const response = {
    statusCode: xhr.status,
    headers: headers
  };

  if (followRedirect && isRedirect(response.statusCode)) {
    try {
      performRedirectRequest(request, response, followRedirect, counter, req => startXmlHttpRequest(req, options, undefined, output, emitter, counter + 1));
    } catch (err) {
      emitter.emit('error', err);
    }

    return;
  }

  let body;

  if (!response.statusCode) {
    response.statusCode = 400;
    body = Buffer.from('Access Declined');
  } else {
    body = Buffer.from(xhr.response);
  }

  emitter.emit('response', response);
  output.write(body);
  output.end();
}
/**
 *
 */


let defaults = {};
/**
 *
 */

export function setDefaults(defaults_) {
  defaults = defaults_;
}
/**
 *
 */

export default function request(req, options_ = {}) {
  const options = _objectSpread(_objectSpread({}, defaults), options_);

  const {
    input,
    output,
    stream
  } = createHttpRequestHandlerStreams(req);

  if (typeof window !== 'undefined' && typeof window.fetch === 'function') {
    startFetchRequest(req, options, input, output, stream);
  } else {
    startXmlHttpRequest(req, options, input, output, stream);
  }

  return stream;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9icm93c2VyL3JlcXVlc3QudHMiXSwibmFtZXMiOlsiY3JlYXRlSHR0cFJlcXVlc3RIYW5kbGVyU3RyZWFtcyIsImV4ZWN1dGVXaXRoVGltZW91dCIsImlzUmVkaXJlY3QiLCJwZXJmb3JtUmVkaXJlY3RSZXF1ZXN0IiwicmVhZEFsbCIsInN1cHBvcnRzUmVhZGFibGVTdHJlYW0iLCJ0b1doYXR3Z1JlYWRhYmxlU3RyZWFtIiwiaW5zIiwiUmVhZGFibGVTdHJlYW0iLCJzdGFydCIsImNvbnRyb2xsZXIiLCJvbiIsImNodW5rIiwiZW5xdWV1ZSIsImNsb3NlIiwicmVhZFdoYXR3Z1JlYWRhYmxlU3RyZWFtIiwicnMiLCJvdXRzIiwicmVhZGVyIiwiZ2V0UmVhZGVyIiwicmVhZEFuZFdyaXRlIiwiZG9uZSIsInZhbHVlIiwicmVhZCIsImVuZCIsIndyaXRlIiwic3RhcnRGZXRjaFJlcXVlc3QiLCJyZXF1ZXN0Iiwib3B0aW9ucyIsImlucHV0Iiwib3V0cHV0IiwiZW1pdHRlciIsImNvdW50ZXIiLCJmb2xsb3dSZWRpcmVjdCIsInVybCIsImJvZHkiLCJyZXFCb2R5IiwicnJlcSIsInRlc3QiLCJtZXRob2QiLCJ1bmRlZmluZWQiLCJBYm9ydENvbnRyb2xsZXIiLCJyZXMiLCJmZXRjaCIsInJlZGlyZWN0Iiwic2lnbmFsIiwiYWxsb3dIVFRQMUZvclN0cmVhbWluZ1VwbG9hZCIsInRpbWVvdXQiLCJhYm9ydCIsImhlYWRlcnMiLCJoZWFkZXJOYW1lIiwidG9Mb3dlckNhc2UiLCJnZXQiLCJyZXNwb25zZSIsInN0YXR1c0NvZGUiLCJzdGF0dXMiLCJyZXEiLCJlcnIiLCJlbWl0IiwiZ2V0UmVzcG9uc2VIZWFkZXJOYW1lcyIsInhociIsImhlYWRlckxpbmVzIiwiZ2V0QWxsUmVzcG9uc2VIZWFkZXJzIiwic3BsaXQiLCJsIiwiaGVhZGVyTGluZSIsInN0YXJ0WG1sSHR0cFJlcXVlc3QiLCJyZXFIZWFkZXJzIiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwiaGVhZGVyIiwic2V0UmVxdWVzdEhlYWRlciIsInJlc3BvbnNlVHlwZSIsInNlbmQiLCJyZXNvbHZlIiwicmVqZWN0Iiwib25sb2FkIiwib25lcnJvciIsIm9udGltZW91dCIsIm9uYWJvcnQiLCJoZWFkZXJOYW1lcyIsImdldFJlc3BvbnNlSGVhZGVyIiwiQnVmZmVyIiwiZnJvbSIsImRlZmF1bHRzIiwic2V0RGVmYXVsdHMiLCJkZWZhdWx0c18iLCJvcHRpb25zXyIsInN0cmVhbSIsIndpbmRvdyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLFNBQ0VBLCtCQURGLEVBRUVDLGtCQUZGLEVBR0VDLFVBSEYsRUFJRUMsc0JBSkYsUUFLTyxtQkFMUDtBQU1BLFNBQVNDLE9BQVQsUUFBd0IsZ0JBQXhCOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsc0JBQXNCLEdBQUcsS0FBL0I7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUNBLFNBQVNDLHNCQUFULENBQWdDQyxHQUFoQyxFQUErRDtBQUM3RCxTQUFPLElBQUlDLGNBQUosQ0FBbUI7QUFDeEJDLElBQUFBLEtBQUssQ0FBQ0MsVUFBRCxFQUFhO0FBQ2hCSCxNQUFBQSxHQUFHLENBQUNJLEVBQUosQ0FBTyxNQUFQLEVBQWdCQyxLQUFELElBQVdGLFVBQVUsQ0FBQ0csT0FBWCxDQUFtQkQsS0FBbkIsQ0FBMUI7QUFDQUwsTUFBQUEsR0FBRyxDQUFDSSxFQUFKLENBQU8sS0FBUCxFQUFjLE1BQU1ELFVBQVUsQ0FBQ0ksS0FBWCxFQUFwQjtBQUNEOztBQUp1QixHQUFuQixDQUFQO0FBTUQ7QUFFRDtBQUNBO0FBQ0E7OztBQUNBLGVBQWVDLHdCQUFmLENBQXdDQyxFQUF4QyxFQUE0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QWIsRUFBeUJMLFFBQXpCO0FBQ0F2QixFQUFBQSxNQUFNLENBQUNMLEtBQVAsQ0FBYVUsSUFBYjtBQUNBTCxFQUFBQSxNQUFNLENBQUNOLEdBQVA7QUFDRDtBQUVEO0FBQ0E7QUFDQTs7O0FBQ0EsSUFBSTRELFFBQTRCLEdBQUcsRUFBbkM7QUFFQTtBQUNBO0FBQ0E7O0FBQ0EsT0FBTyxTQUFTQyxXQUFULENBQXFCQyxTQUFyQixFQUFvRDtBQUN6REYsRUFBQUEsUUFBUSxHQUFHRSxTQUFYO0FBQ0Q7QUFFRDtBQUNBO0FBQ0E7O0FBQ0EsZUFBZSxTQUFTM0QsT0FBVCxDQUNiNkIsR0FEYSxFQUViK0IsUUFBNEIsR0FBRyxFQUZsQixFQUdiO0FBQ0EsUUFBTTNELE9BQU8sbUNBQVF3RCxRQUFSLEdBQXFCRyxRQUFyQixDQUFiOztBQUNBLFFBQU07QUFBRTFELElBQUFBLEtBQUY7QUFBU0MsSUFBQUEsTUFBVDtBQUFpQjBELElBQUFBO0FBQWpCLE1BQTRCeEYsK0JBQStCLENBQUN3RCxHQUFELENBQWpFOztBQUNBLE1BQUksT0FBT2lDLE1BQVAsS0FBa0IsV0FBbEIsSUFBaUMsT0FBT0EsTUFBTSxDQUFDOUMsS0FBZCxLQUF3QixVQUE3RCxFQUF5RTtBQUN2RWpCLElBQUFBLGlCQUFpQixDQUFDOEIsR0FBRCxFQUFNNUIsT0FBTixFQUFlQyxLQUFmLEVBQXNCQyxNQUF0QixFQUE4QjBELE1BQTlCLENBQWpCO0FBQ0QsR0FGRCxNQUVPO0FBQ0x0QixJQUFBQSxtQkFBbUIsQ0FBQ1YsR0FBRCxFQUFNNUIsT0FBTixFQUFlQyxLQUFmLEVBQXNCQyxNQUF0QixFQUE4QjBELE1BQTlCLENBQW5CO0FBQ0Q7O0FBQ0QsU0FBT0EsTUFBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCB7IFJlYWRhYmxlLCBXcml0YWJsZSB9IGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQge1xuICBjcmVhdGVIdHRwUmVxdWVzdEhhbmRsZXJTdHJlYW1zLFxuICBleGVjdXRlV2l0aFRpbWVvdXQsXG4gIGlzUmVkaXJlY3QsXG4gIHBlcmZvcm1SZWRpcmVjdFJlcXVlc3QsXG59IGZyb20gJy4uL3JlcXVlc3QtaGVscGVyJztcbmltcG9ydCB7IHJlYWRBbGwgfSBmcm9tICcuLi91dGlsL3N0cmVhbSc7XG5pbXBvcnQgeyBIdHRwUmVxdWVzdCwgSHR0cFJlcXVlc3RPcHRpb25zIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG4vKipcbiAqIEFzIHRoZSByZXF1ZXN0IHN0cmVtaW5nIGlzIG5vdCB5ZXQgc3VwcG9ydGVkIG9uIG1ham9yIGJyb3dzZXJzLFxuICogaXQgaXMgc2V0IHRvIGZhbHNlIGZvciBub3cuXG4gKi9cbmNvbnN0IHN1cHBvcnRzUmVhZGFibGVTdHJlYW0gPSBmYWxzZTtcblxuLypcbihhc3luYyAoKSA9PiB7XG4gIHRyeSB7XG4gICAgaWYgKFxuICAgICAgdHlwZW9mIGZldGNoID09PSAnZnVuY3Rpb24nICYmXG4gICAgICB0eXBlb2YgUmVxdWVzdCA9PT0gJ2Z1bmN0aW9uJyAmJlxuICAgICAgdHlwZW9mIFJlYWRhYmxlU3RyZWFtID09PSAnZnVuY3Rpb24nXG4gICAgKSB7XG4gICAgICAvLyB0aGlzIGZlYXR1cmUgZGV0ZWN0aW9uIHJlcXVpcmVzIGR1bW15IFBPU1QgcmVxdWVzdFxuICAgICAgY29uc3QgcmVxID0gbmV3IFJlcXVlc3QoJ2RhdGE6dGV4dC9wbGFpbiwnLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBib2R5OiBuZXcgUmVhZGFibGVTdHJlYW0oKSxcbiAgICAgIH0pO1xuICAgICAgLy8gaWYgaXQgaGFzIGNvbnRlbnQtdHlwZSBoZWFkZXIgaXQgZG9lc24ndCByZWdhcmQgYm9keSBhcyBzdHJlYW1cbiAgICAgIGlmIChyZXEuaGVhZGVycy5oYXMoJ0NvbnRlbnQtVHlwZScpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IChhd2FpdCBmZXRjaChyZXEpKS50ZXh0KCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAvLyBlcnJvciBtaWdodCBvY2N1ciBpbiBlbnYgd2l0aCBDU1Agd2l0aG91dCBjb25uZWN0LXNyYyBkYXRhOlxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59KSgpO1xuKi9cblxuLyoqXG4gKlxuICovXG5mdW5jdGlvbiB0b1doYXR3Z1JlYWRhYmxlU3RyZWFtKGluczogUmVhZGFibGUpOiBSZWFkYWJsZVN0cmVhbSB7XG4gIHJldHVybiBuZXcgUmVhZGFibGVTdHJlYW0oe1xuICAgIHN0YXJ0KGNvbnRyb2xsZXIpIHtcbiAgICAgIGlucy5vbignZGF0YScsIChjaHVuaykgPT4gY29udHJvbGxlci5lbnF1ZXVlKGNodW5rKSk7XG4gICAgICBpbnMub24oJ2VuZCcsICgpID0+IGNvbnRyb2xsZXIuY2xvc2UoKSk7XG4gICAgfSxcbiAgfSk7XG59XG5cbi8qKlxuICpcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVhZFdoYXR3Z1JlYWRhYmxlU3RyZWFtKHJzOiBSZWFkYWJsZVN0cmVhbSwgb3V0czogV3JpdGFibGUpIHtcbiAgY29uc3QgcmVhZGVyID0gcnMuZ2V0UmVhZGVyKCk7XG4gIGFzeW5jIGZ1bmN0aW9uIHJlYWRBbmRXcml0ZSgpIHtcbiAgICBjb25zdCB7IGRvbmUsIHZhbHVlIH0gPSBhd2FpdCByZWFkZXIucmVhZCgpO1xuICAgIGlmIChkb25lKSB7XG4gICAgICBvdXRzLmVuZCgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBvdXRzLndyaXRlKHZhbHVlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICB3aGlsZSAoYXdhaXQgcmVhZEFuZFdyaXRlKCkpO1xufVxuXG4vKipcbiAqXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0RmV0Y2hSZXF1ZXN0KFxuICByZXF1ZXN0OiBIdHRwUmVxdWVzdCxcbiAgb3B0aW9uczogSHR0cFJlcXVlc3RPcHRpb25zLFxuICBpbnB1dDogUmVhZGFibGUgfCB1bmRlZmluZWQsXG4gIG91dHB1dDogV3JpdGFibGUsXG4gIGVtaXR0ZXI6IEV2ZW50RW1pdHRlcixcbiAgY291bnRlcjogbnVtYmVyID0gMCxcbikge1xuICBjb25zdCB7IGZvbGxvd1JlZGlyZWN0IH0gPSBvcHRpb25zO1xuICBjb25zdCB7IHVybCwgYm9keTogcmVxQm9keSwgLi4ucnJlcSB9ID0gcmVxdWVzdDtcbiAgY29uc3QgYm9keSA9XG4gICAgaW5wdXQgJiYgL14ocG9zdHxwdXR8cGF0Y2gpJC9pLnRlc3QocmVxdWVzdC5tZXRob2QpXG4gICAgICA/IHN1cHBvcnRzUmVhZGFibGVTdHJlYW1cbiAgICAgICAgPyB0b1doYXR3Z1JlYWRhYmxlU3RyZWFtKGlucHV0KVxuICAgICAgICA6IGF3YWl0IHJlYWRBbGwoaW5wdXQpXG4gICAgICA6IHVuZGVmaW5lZDtcbiAgY29uc3QgY29udHJvbGxlciA9XG4gICAgdHlwZW9mIEFib3J0Q29udHJvbGxlciAhPT0gJ3VuZGVmaW5lZCcgPyBuZXcgQWJvcnRDb250cm9sbGVyKCkgOiB1bmRlZmluZWQ7XG4gIGNvbnN0IHJlcyA9IGF3YWl0IGV4ZWN1dGVXaXRoVGltZW91dChcbiAgICAoKSA9PlxuICAgICAgZmV0Y2godXJsLCB7XG4gICAgICAgIC4uLnJyZXEsXG4gICAgICAgIC4uLihib2R5ID8geyBib2R5IH0gOiB7fSksXG4gICAgICAgIHJlZGlyZWN0OiAnbWFudWFsJyxcbiAgICAgICAgLi4uKGNvbnRyb2xsZXIgPyB7IHNpZ25hbDogY29udHJvbGxlci5zaWduYWwgfSA6IHt9KSxcbiAgICAgICAgLi4uKHsgYWxsb3dIVFRQMUZvclN0cmVhbWluZ1VwbG9hZDogdHJ1ZSB9IGFzIGFueSksIC8vIENocm9tZSBhbGxvd3MgcmVxdWVzdCBzdHJlYW0gb25seSBpbiBIVFRQMi9RVUlDIHVubGVzcyB0aGlzIG9wdC1pbiBmbGFnXG4gICAgICB9KSxcbiAgICBvcHRpb25zLnRpbWVvdXQsXG4gICAgKCkgPT4gY29udHJvbGxlcj8uYWJvcnQoKSxcbiAgKTtcbiAgY29uc3QgaGVhZGVyczogeyBba2V5OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xuICBmb3IgKGNvbnN0IGhlYWRlck5hbWUgb2YgcmVzLmhlYWRlcnMua2V5cygpKSB7XG4gICAgaGVhZGVyc1toZWFkZXJOYW1lLnRvTG93ZXJDYXNlKCldID0gcmVzLmhlYWRlcnMuZ2V0KGhlYWRlck5hbWUpO1xuICB9XG4gIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgIHN0YXR1c0NvZGU6IHJlcy5zdGF0dXMsXG4gICAgaGVhZGVycyxcbiAgfTtcbiAgaWYgKGZvbGxvd1JlZGlyZWN0ICYmIGlzUmVkaXJlY3QocmVzcG9uc2Uuc3RhdHVzQ29kZSkpIHtcbiAgICB0cnkge1xuICAgICAgcGVyZm9ybVJlZGlyZWN0UmVxdWVzdChcbiAgICAgICAgcmVxdWVzdCxcbiAgICAgICAgcmVzcG9uc2UsXG4gICAgICAgIGZvbGxvd1JlZGlyZWN0LFxuICAgICAgICBjb3VudGVyLFxuICAgICAgICAocmVxKSA9PlxuICAgICAgICAgIHN0YXJ0RmV0Y2hSZXF1ZXN0KFxuICAgICAgICAgICAgcmVxLFxuICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG91dHB1dCxcbiAgICAgICAgICAgIGVtaXR0ZXIsXG4gICAgICAgICAgICBjb3VudGVyICsgMSxcbiAgICAgICAgICApLFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGVtaXR0ZXIuZW1pdCgnZXJyb3InLCBlcnIpO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cbiAgZW1pdHRlci5lbWl0KCdyZXNwb25zZScsIHJlc3BvbnNlKTtcbiAgaWYgKHJlcy5ib2R5KSB7XG4gICAgcmVhZFdoYXR3Z1JlYWRhYmxlU3RyZWFtKHJlcy5ib2R5LCBvdXRwdXQpO1xuICB9IGVsc2Uge1xuICAgIG91dHB1dC5lbmQoKTtcbiAgfVxufVxuXG4vKipcbiAqXG4gKi9cbmZ1bmN0aW9uIGdldFJlc3BvbnNlSGVhZGVyTmFtZXMoeGhyOiBYTUxIdHRwUmVxdWVzdCkge1xuICBjb25zdCBoZWFkZXJMaW5lcyA9ICh4aHIuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCkgfHwgJycpXG4gICAgLnNwbGl0KC9bXFxyXFxuXSsvKVxuICAgIC5maWx0ZXIoKGwpID0+IGwudHJpbSgpICE9PSAnJyk7XG4gIHJldHVybiBoZWFkZXJMaW5lcy5tYXAoKGhlYWRlckxpbmUpID0+XG4gICAgaGVhZGVyTGluZS5zcGxpdCgvXFxzKjovKVswXS50b0xvd2VyQ2FzZSgpLFxuICApO1xufVxuXG4vKipcbiAqXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0WG1sSHR0cFJlcXVlc3QoXG4gIHJlcXVlc3Q6IEh0dHBSZXF1ZXN0LFxuICBvcHRpb25zOiBIdHRwUmVxdWVzdE9wdGlvbnMsXG4gIGlucHV0OiBSZWFkYWJsZSB8IHVuZGVmaW5lZCxcbiAgb3V0cHV0OiBXcml0YWJsZSxcbiAgZW1pdHRlcjogRXZlbnRFbWl0dGVyLFxuICBjb3VudGVyOiBudW1iZXIgPSAwLFxuKSB7XG4gIGNvbnN0IHsgbWV0aG9kLCB1cmwsIGhlYWRlcnM6IHJlcUhlYWRlcnMgfSA9IHJlcXVlc3Q7XG4gIGNvbnN0IHsgZm9sbG93UmVkaXJlY3QgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IHJlcUJvZHkgPVxuICAgIGlucHV0ICYmIC9eKHBvc3R8cHV0fHBhdGNoKSQvaS50ZXN0KG1ldGhvZCkgPyBhd2FpdCByZWFkQWxsKGlucHV0KSA6IG51bGw7XG4gIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICBhd2FpdCBleGVjdXRlV2l0aFRpbWVvdXQoXG4gICAgKCkgPT4ge1xuICAgICAgeGhyLm9wZW4obWV0aG9kLCB1cmwpO1xuICAgICAgaWYgKHJlcUhlYWRlcnMpIHtcbiAgICAgICAgZm9yIChjb25zdCBoZWFkZXIgaW4gcmVxSGVhZGVycykge1xuICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRlciwgcmVxSGVhZGVyc1toZWFkZXJdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMudGltZW91dCkge1xuICAgICAgICB4aHIudGltZW91dCA9IG9wdGlvbnMudGltZW91dDtcbiAgICAgIH1cbiAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAnYXJyYXlidWZmZXInO1xuICAgICAgeGhyLnNlbmQocmVxQm9keSk7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICB4aHIub25sb2FkID0gKCkgPT4gcmVzb2x2ZSgpO1xuICAgICAgICB4aHIub25lcnJvciA9IHJlamVjdDtcbiAgICAgICAgeGhyLm9udGltZW91dCA9IHJlamVjdDtcbiAgICAgICAgeGhyLm9uYWJvcnQgPSByZWplY3Q7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIG9wdGlvbnMudGltZW91dCxcbiAgICAoKSA9PiB4aHIuYWJvcnQoKSxcbiAgKTtcbiAgY29uc3QgaGVhZGVyTmFtZXMgPSBnZXRSZXNwb25zZUhlYWRlck5hbWVzKHhocik7XG4gIGNvbnN0IGhlYWRlcnMgPSBoZWFkZXJOYW1lcy5yZWR1Y2UoXG4gICAgKGhlYWRlcnMsIGhlYWRlck5hbWUpID0+ICh7XG4gICAgICAuLi5oZWFkZXJzLFxuICAgICAgW2hlYWRlck5hbWVdOiB4aHIuZ2V0UmVzcG9uc2VIZWFkZXIoaGVhZGVyTmFtZSkgfHwgJycsXG4gICAgfSksXG4gICAge30gYXMgeyBbbmFtZTogc3RyaW5nXTogc3RyaW5nIH0sXG4gICk7XG4gIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgIHN0YXR1c0NvZGU6IHhoci5zdGF0dXMsXG4gICAgaGVhZGVyczogaGVhZGVycyxcbiAgfTtcbiAgaWYgKGZvbGxvd1JlZGlyZWN0ICYmIGlzUmVkaXJlY3QocmVzcG9uc2Uuc3RhdHVzQ29kZSkpIHtcbiAgICB0cnkge1xuICAgICAgcGVyZm9ybVJlZGlyZWN0UmVxdWVzdChcbiAgICAgICAgcmVxdWVzdCxcbiAgICAgICAgcmVzcG9uc2UsXG4gICAgICAgIGZvbGxvd1JlZGlyZWN0LFxuICAgICAgICBjb3VudGVyLFxuICAgICAgICAocmVxKSA9PlxuICAgICAgICAgIHN0YXJ0WG1sSHR0cFJlcXVlc3QoXG4gICAgICAgICAgICByZXEsXG4gICAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgb3V0cHV0LFxuICAgICAgICAgICAgZW1pdHRlcixcbiAgICAgICAgICAgIGNvdW50ZXIgKyAxLFxuICAgICAgICAgICksXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgZW1pdHRlci5lbWl0KCdlcnJvcicsIGVycik7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuICBsZXQgYm9keTogQnVmZmVyO1xuICBpZiAoIXJlc3BvbnNlLnN0YXR1c0NvZGUpIHtcbiAgICByZXNwb25zZS5zdGF0dXNDb2RlID0gNDAwO1xuICAgIGJvZHkgPSBCdWZmZXIuZnJvbSgnQWNjZXNzIERlY2xpbmVkJyk7XG4gIH0gZWxzZSB7XG4gICAgYm9keSA9IEJ1ZmZlci5mcm9tKHhoci5yZXNwb25zZSk7XG4gIH1cbiAgZW1pdHRlci5lbWl0KCdyZXNwb25zZScsIHJlc3BvbnNlKTtcbiAgb3V0cHV0LndyaXRlKGJvZHkpO1xuICBvdXRwdXQuZW5kKCk7XG59XG5cbi8qKlxuICpcbiAqL1xubGV0IGRlZmF1bHRzOiBIdHRwUmVxdWVzdE9wdGlvbnMgPSB7fTtcblxuLyoqXG4gKlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0RGVmYXVsdHMoZGVmYXVsdHNfOiBIdHRwUmVxdWVzdE9wdGlvbnMpIHtcbiAgZGVmYXVsdHMgPSBkZWZhdWx0c187XG59XG5cbi8qKlxuICpcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcmVxdWVzdChcbiAgcmVxOiBIdHRwUmVxdWVzdCxcbiAgb3B0aW9uc186IEh0dHBSZXF1ZXN0T3B0aW9ucyA9IHt9LFxuKSB7XG4gIGNvbnN0IG9wdGlvbnMgPSB7IC4uLmRlZmF1bHRzLCAuLi5vcHRpb25zXyB9O1xuICBjb25zdCB7IGlucHV0LCBvdXRwdXQsIHN0cmVhbSB9ID0gY3JlYXRlSHR0cFJlcXVlc3RIYW5kbGVyU3RyZWFtcyhyZXEpO1xuICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHdpbmRvdy5mZXRjaCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHN0YXJ0RmV0Y2hSZXF1ZXN0KHJlcSwgb3B0aW9ucywgaW5wdXQsIG91dHB1dCwgc3RyZWFtKTtcbiAgfSBlbHNlIHtcbiAgICBzdGFydFhtbEh0dHBSZXF1ZXN0KHJlcSwgb3B0aW9ucywgaW5wdXQsIG91dHB1dCwgc3RyZWFtKTtcbiAgfVxuICByZXR1cm4gc3RyZWFtO1xufVxuIl19