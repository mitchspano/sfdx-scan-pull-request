"use strict";

var _interopRequireDefault = require("@babel/runtime-corejs3/helpers/interopRequireDefault");

require("core-js/modules/es.array.iterator");

require("core-js/modules/es.promise");

require("core-js/modules/es.string.replace");

var _stringify = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/json/stringify"));

var _keys = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/keys"));

var _isArray = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/array/is-array"));

var _promise = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/promise"));

var _fsExtra = _interopRequireDefault(require("fs-extra"));

var _xml2js = _interopRequireDefault(require("xml2js"));

var _soap = require("../../soap");

var _function = require("../../util/function");

/**
 *
 */
const WSDLRestrictionSchema = {
  $: {
    base: 'string'
  },
  enumeration: [{
    $: {
      value: 'string'
    }
  }],
  'xsd:enumeration': [{
    $: {
      value: 'string'
    }
  }]
};
const WSDLSimpleTypeSchema = {
  $: {
    name: 'string'
  },
  restriction: WSDLRestrictionSchema,
  'xsd:restriction': WSDLRestrictionSchema
};
const WSDLElementSchema = {
  $: {
    name: 'string',
    type: 'string',
    minOccurs: '?number',
    maxOccurs: '?string',
    nillable: '?boolean'
  }
};
const WSDLSequenceSchema = {
  element: ['?', WSDLElementSchema],
  'xsd:element': ['?', WSDLElementSchema]
};
const WSDLExtensionSchema = {
  $: {
    base: 'string'
  },
  sequence: {
    '?': WSDLSequenceSchema
  },
  'xsd:sequence': {
    '?': WSDLSequenceSchema
  }
};
const WSDLComplexContentSchema = {
  extension: {
    '?': WSDLExtensionSchema
  },
  'xsd:extension': {
    '?': WSDLExtensionSchema
  }
};
const WSDLComplexTypeSchema = {
  $: {
    name: 'string'
  },
  sequence: {
    '?': WSDLSequenceSchema
  },
  'xsd:sequence': {
    '?': WSDLSequenceSchema
  },
  complexContent: {
    '?': WSDLComplexContentSchema
  },
  'xsd:complexContent': {
    '?': WSDLComplexContentSchema
  }
};
const WSDLSchemaSchema = {
  $: 'any',
  complexType: ['?', 'any'],
  simpleType: ['?', 'any'],
  'xsd:complexType': ['?', 'any'],
  'xsd:simpleType': ['?', 'any']
};
const WSDLSchema = {
  definitions: {
    $: 'any',
    types: {
      schema: ['?', WSDLSchemaSchema],
      'xsd:schema': ['?', WSDLSchemaSchema]
    },
    message: ['any'],
    portType: {
      $: 'any',
      operation: ['any']
    },
    binding: {
      $: 'any',
      operation: ['any']
    },
    service: {
      $: 'any',
      documentation: 'string',
      operation: ['any']
    }
  }
};
/**
 *
 */

/**
 *
 */
function toJsType(xsdType, simpleTypes) {
  switch (xsdType) {
    case 'xsd:boolean':
      return 'boolean';

    case 'xsd:string':
    case 'xsd:date':
    case 'xsd:dateTime':
    case 'xsd:time':
    case 'xsd:base64Binary':
      return 'string';

    case 'xsd:int':
    case 'xsd:long':
    case 'xsd:double':
      return 'number';

    case 'xsd:anyType':
      return 'any';

    default:
      {
        const [ns, type] = xsdType.split(':');

        if (simpleTypes[type]) {
          return simpleTypes[type];
        }

        if (ns) {
          return type;
        }

        return xsdType;
      }
  }
}
/**
 *
 */


async function readWSDLFile(filePath) {
  const xmlData = await _fsExtra.default.readFile(filePath, 'utf8');
  const json = await _xml2js.default.parseStringPromise(xmlData, {
    explicitArray: false
  });
  return (0, _soap.castTypeUsingSchema)(json, WSDLSchema);
}
/**
 *
 */


function getTypeInfo(el, simpleTypes) {
  let type = toJsType(el.$.type, simpleTypes);
  const isArray = el.$.maxOccurs === 'unbounded';
  const nillable = !isArray && el.$.minOccurs === 0 || el.$.nillable;
  return isArray ? nillable ? ['?', type] : [type] : nillable ? `?${type}` : type;
}
/**
 *
 */


function extractComplexTypes(wsdl) {
  console.log(wsdl.definitions.types['xsd:schema']);
  let schemas = {};
  const simpleTypes = {};
  const types = wsdl.definitions.types;

  for (const sc of (_ref = (_types$schema = types.schema) !== null && _types$schema !== void 0 ? _types$schema : types['xsd:schema']) !== null && _ref !== void 0 ? _ref : []) {
    var _ref, _types$schema;

    for (const st of (_ref2 = (_sc$simpleType = sc.simpleType) !== null && _sc$simpleType !== void 0 ? _sc$simpleType : sc['xsd:simpleType']) !== null && _ref2 !== void 0 ? _ref2 : []) {
      var _ref2, _sc$simpleType, _simpleType$restricti;

      const simpleType = (0, _soap.castTypeUsingSchema)(st, WSDLSimpleTypeSchema);
      const rs = (_simpleType$restricti = simpleType.restriction) !== null && _simpleType$restricti !== void 0 ? _simpleType$restricti : simpleType['xsd:restriction'];
      const base = rs.$.base.split(':')[1];
      simpleTypes[simpleType.$.name] = base;
    }
  }

  console.log({
    simpleTypes
  });

  for (const sc of (_ref3 = (_types$schema2 = types.schema) !== null && _types$schema2 !== void 0 ? _types$schema2 : types['xsd:schema']) !== null && _ref3 !== void 0 ? _ref3 : []) {
    var _ref3, _types$schema2;

    for (const ct of (_ref4 = (_sc$complexType = sc.complexType) !== null && _sc$complexType !== void 0 ? _sc$complexType : sc['xsd:complexType']) !== null && _ref4 !== void 0 ? _ref4 : []) {
      var _ref4, _sc$complexType, _complexType$sequence, _seq$element, _complexType$complexC;

      const complexType = (0, _soap.castTypeUsingSchema)(ct, WSDLComplexTypeSchema);
      const schema = {
        type: complexType.$.name,
        props: {}
      };
      const seq = (_complexType$sequence = complexType.sequence) !== null && _complexType$sequence !== void 0 ? _complexType$sequence : complexType['xsd:sequence'];
      const els = (_seq$element = seq === null || seq === void 0 ? void 0 : seq.element) !== null && _seq$element !== void 0 ? _seq$element : seq === null || seq === void 0 ? void 0 : seq['xsd:element'];

      for (const el of els !== null && els !== void 0 ? els : []) {
        schema.props[el.$.name] = getTypeInfo(el, simpleTypes);
      }

      const cc = (_complexType$complexC = complexType.complexContent) !== null && _complexType$complexC !== void 0 ? _complexType$complexC : complexType['xsd:complexContent'];

      if (cc) {
        var _cc$extension;

        const extension = (_cc$extension = cc.extension) !== null && _cc$extension !== void 0 ? _cc$extension : cc['xsd:extension'];

        if (extension) {
          var _extension$sequence, _seq$element2;

          schema.extends = extension.$.base.split(':')[1];
          const seq = (_extension$sequence = extension.sequence) !== null && _extension$sequence !== void 0 ? _extension$sequence : extension['xsd:sequence'];
          const els = (_seq$element2 = seq === null || seq === void 0 ? void 0 : seq.element) !== null && _seq$element2 !== void 0 ? _seq$element2 : seq === null || seq === void 0 ? void 0 : seq['xsd:element'];

          for (const el of els !== null && els !== void 0 ? els : []) {
            schema.props[el.$.name] = getTypeInfo(el, simpleTypes);
          }
        }
      }

      schemas[complexType.$.name] = schema;
    }
  }

  return schemas;
}
/**
 *
 */


const GENERATED_MESSAGE_COMMENT = `/**
 * This file is generated from WSDL file by wsdl2schema.ts.
 * Do not modify directly.
 * To generate the file, run "ts-node path/to/wsdl2schema.ts path/to/wsdl.xml path/to/schema.ts"
 */
`;
/**
 *
 */

async function dumpSchema(schemas, outFile) {
  const out = _fsExtra.default.createWriteStream(outFile, 'utf8');

  const print = (str, indent = 0) => {
    for (let i = 0; i < indent; i++) {
      out.write(' ');
    }

    out.write(str);
  };

  const println = (str = '', indent = 0) => {
    print(str + '\n', indent);
  };

  return new _promise.default((resolve, reject) => {
    out.on('error', reject);
    out.on('finish', () => resolve());
    println(GENERATED_MESSAGE_COMMENT);
    print('export const ApiSchemas = ');
    writeSchema(schemas);
    println(' as const;');
    println();
    writeTypeDefs(schemas);
    out.end();
  });

  function writeSchema(o, indent = 0) {
    if (indent > 20) {
      print("'any'");
      return;
    }

    if ((0, _isArray.default)(o)) {
      print('[');
      let i = 0;

      for (const co of o) {
        if (i > 0) {
          print(', ');
        }

        writeSchema(co, indent);
        i++;
      }

      print(']');
    } else if ((0, _function.isMapObject)(o)) {
      const keys = (0, _keys.default)(o);

      if (keys.length > 0) {
        println('{');

        for (const name of keys) {
          const co = o[name];
          const nameId = /^[\w_$]+$/.test(name) ? name : `'${name}'`;
          print(`${nameId}: `, indent + 2);
          writeSchema(co, indent + 2);
          println(',');
        }

        print('}', indent);
      } else {
        print('{}');
      }
    } else {
      print((0, _stringify.default)(o).replace(/"/g, "'"));
    }
  }

  function writeTypeDef(o, schemas, indent = 0) {
    if (typeof o === 'string') {
      print(o);
    } else if ((0, _function.isMapObject)(o)) {
      if ('type' in o && 'props' in o) {
        if ('extends' in o && typeof o.extends === 'string') {
          print(`${o.extends} & `);
        }

        writeTypeDef(o.props, schemas, indent);
        return;
      }

      const keys = (0, _keys.default)(o);

      if (keys.length > 0) {
        println('{');

        for (const prop of (0, _keys.default)(o)) {
          let value = o[prop];
          let nillable = false;
          let isArray = false;

          if ((0, _isArray.default)(value)) {
            isArray = true;
            const len = value.length;

            if (len === 2 && value[0] === '?') {
              nillable = true;
              value = value[1];
            } else {
              value = value[0];
            }
          } else if ((0, _function.isMapObject)(value)) {
            if ('?' in value) {
              nillable = true;
              value = value['?'];
            }
          }

          if (typeof value === 'string' && value[0] === '?') {
            nillable = true;
            value = value.substring(1);
          }

          print(`${prop}${nillable ? '?' : ''}: `, indent + 2);
          writeTypeDef(value, schemas, indent + 2);

          if (isArray) {
            print('[]');
          }

          if (nillable) {
            print(' | null | undefined');
          }

          println(';');
        }

        print('}', indent);
      } else {
        print('{}');
      }
    }
  }

  function writeTypeDefs(schemas) {
    for (const name of (0, _keys.default)(schemas)) {
      const schema = schemas[name];
      print(`export type ${name} = `);
      writeTypeDef(schema, schemas);
      println(';');
      println();
    }

    println('export type ApiSchemaTypes = {');

    for (const name of (0, _keys.default)(schemas)) {
      println(`${name}: ${name};`, 2);
    }

    println('};');
  }
}
/**
 *
 */


async function main() {
  const wsdlFilePath = process.argv[2];

  if (!wsdlFilePath) {
    console.error('No input WSDL file is specified.');
    return;
  }

  const outFilePath = process.argv[3];

  if (!wsdlFilePath) {
    console.error('No output typescript schema file is specified.');
    return;
  }

  const wsdl = await readWSDLFile(wsdlFilePath);
  const schemas = extractComplexTypes(wsdl);
  dumpSchema(schemas, outFilePath);
}

main();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcGkvd3NkbC93c2RsMnNjaGVtYS50cyJdLCJuYW1lcyI6WyJXU0RMUmVzdHJpY3Rpb25TY2hlbWEiLCIkIiwiYmFzZSIsImVudW1lcmF0aW9uIiwidmFsdWUiLCJXU0RMU2ltcGxlVHlwZVNjaGVtYSIsIm5hbWUiLCJyZXN0cmljdGlvbiIsIldTRExFbGVtZW50U2NoZW1hIiwidHlwZSIsIm1pbk9jY3VycyIsIm1heE9jY3VycyIsIm5pbGxhYmxlIiwiV1NETFNlcXVlbmNlU2NoZW1hIiwiZWxlbWVudCIsIldTRExFeHRlbnNpb25TY2hlbWEiLCJzZXF1ZW5jZSIsIldTRExDb21wbGV4Q29udGVudFNjaGVtYSIsImV4dGVuc2lvbiIsIldTRExDb21wbGV4VHlwZVNjaGVtYSIsImNvbXBsZXhDb250ZW50IiwiV1NETFNjaGVtYVNjaGVtYSIsImNvbXBsZXhUeXBlIiwic2ltcGxlVHlwZSIsIldTRExTY2hlbWEiLCJkZWZpbml0aW9ucyIsInR5cGVzIiwic2NoZW1hIiwibWVzc2FnZSIsInBvcnRUeXBlIiwib3BlcmF0aW9uIiwiYmluZGluZyIsInNlcnZpY2UiLCJkb2N1bWVudGF0aW9uIiwidG9Kc1R5cGUiLCJ4c2RUeXBlIiwic2ltcGxlVHlwZXMiLCJucyIsInNwbGl0IiwicmVhZFdTRExGaWxlIiwiZmlsZVBhdGgiLCJ4bWxEYXRhIiwiZnMiLCJyZWFkRmlsZSIsImpzb24iLCJ4bWwyanMiLCJwYXJzZVN0cmluZ1Byb21pc2UiLCJleHBsaWNpdEFycmF5IiwiZ2V0VHlwZUluZm8iLCJlbCIsImlzQXJyYXkiLCJleHRyYWN0Q29tcGxleFR5cGVzIiwid3NkbCIsImNvbnNvbGUiLCJsb2ciLCJzY2hlbWFzIiwic2MiLCJzdCIsInJzIiwiY3QiLCJwcm9wcyIsInNlcSIsImVscyIsImNjIiwiZXh0ZW5kcyIsIkdFTkVSQVRFRF9NRVNTQUdFX0NPTU1FTlQiLCJkdW1wU2NoZW1hIiwib3V0RmlsZSIsIm91dCIsImNyZWF0ZVdyaXRlU3RyZWFtIiwicHJpbnQiLCJzdHIiLCJpbmRlbnQiLCJpIiwid3JpdGUiLCJwcmludGxuIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uIiwid3JpdGVTY2hlbWEiLCJ3cml0ZVR5cGVEZWZzIiwiZW5kIiwibyIsImNvIiwia2V5cyIsImxlbmd0aCIsIm5hbWVJZCIsInRlc3QiLCJyZXBsYWNlIiwid3JpdGVUeXBlRGVmIiwicHJvcCIsImxlbiIsInN1YnN0cmluZyIsIm1haW4iLCJ3c2RsRmlsZVBhdGgiLCJwcm9jZXNzIiwiYXJndiIsImVycm9yIiwib3V0RmlsZVBhdGgiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU1BLHFCQUFxQixHQUFHO0FBQzVCQyxFQUFBQSxDQUFDLEVBQUU7QUFBRUMsSUFBQUEsSUFBSSxFQUFFO0FBQVIsR0FEeUI7QUFFNUJDLEVBQUFBLFdBQVcsRUFBRSxDQUNYO0FBQ0VGLElBQUFBLENBQUMsRUFBRTtBQUFFRyxNQUFBQSxLQUFLLEVBQUU7QUFBVDtBQURMLEdBRFcsQ0FGZTtBQU81QixxQkFBbUIsQ0FDakI7QUFDRUgsSUFBQUEsQ0FBQyxFQUFFO0FBQUVHLE1BQUFBLEtBQUssRUFBRTtBQUFUO0FBREwsR0FEaUI7QUFQUyxDQUE5QjtBQWNBLE1BQU1DLG9CQUFvQixHQUFHO0FBQzNCSixFQUFBQSxDQUFDLEVBQUU7QUFBRUssSUFBQUEsSUFBSSxFQUFFO0FBQVIsR0FEd0I7QUFFM0JDLEVBQUFBLFdBQVcsRUFBRVAscUJBRmM7QUFHM0IscUJBQW1CQTtBQUhRLENBQTdCO0FBTUEsTUFBTVEsaUJBQWlCLEdBQUc7QUFDeEJQLEVBQUFBLENBQUMsRUFBRTtBQUNESyxJQUFBQSxJQUFJLEVBQUUsUUFETDtBQUVERyxJQUFBQSxJQUFJLEVBQUUsUUFGTDtBQUdEQyxJQUFBQSxTQUFTLEVBQUUsU0FIVjtBQUlEQyxJQUFBQSxTQUFTLEVBQUUsU0FKVjtBQUtEQyxJQUFBQSxRQUFR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WCxPQUFELEVBQVUyQyxXQUFWLENBQVY7QUFDRDs7QUFFREwsSUFBSSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgeG1sMmpzIGZyb20gJ3htbDJqcyc7XG5pbXBvcnQgeyBjYXN0VHlwZVVzaW5nU2NoZW1hIH0gZnJvbSAnLi4vLi4vc29hcCc7XG5pbXBvcnQgeyBTb2FwU2NoZW1hRWxlbWVudFR5cGUsIFNvYXBTY2hlbWFEZWYgfSBmcm9tICcuLi8uLi90eXBlcyc7XG5pbXBvcnQgeyBpc01hcE9iamVjdCB9IGZyb20gJy4uLy4uL3V0aWwvZnVuY3Rpb24nO1xuXG4vKipcbiAqXG4gKi9cbmNvbnN0IFdTRExSZXN0cmljdGlvblNjaGVtYSA9IHtcbiAgJDogeyBiYXNlOiAnc3RyaW5nJyB9LFxuICBlbnVtZXJhdGlvbjogW1xuICAgIHtcbiAgICAgICQ6IHsgdmFsdWU6ICdzdHJpbmcnIH0sXG4gICAgfSxcbiAgXSxcbiAgJ3hzZDplbnVtZXJhdGlvbic6IFtcbiAgICB7XG4gICAgICAkOiB7IHZhbHVlOiAnc3RyaW5nJyB9LFxuICAgIH0sXG4gIF0sXG59IGFzIGNvbnN0O1xuXG5jb25zdCBXU0RMU2ltcGxlVHlwZVNjaGVtYSA9IHtcbiAgJDogeyBuYW1lOiAnc3RyaW5nJyB9LFxuICByZXN0cmljdGlvbjogV1NETFJlc3RyaWN0aW9uU2NoZW1hLFxuICAneHNkOnJlc3RyaWN0aW9uJzogV1NETFJlc3RyaWN0aW9uU2NoZW1hLFxufSBhcyBjb25zdDtcblxuY29uc3QgV1NETEVsZW1lbnRTY2hlbWEgPSB7XG4gICQ6IHtcbiAgICBuYW1lOiAnc3RyaW5nJyxcbiAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICBtaW5PY2N1cnM6ICc/bnVtYmVyJyxcbiAgICBtYXhPY2N1cnM6ICc/c3RyaW5nJyxcbiAgICBuaWxsYWJsZTogJz9ib29sZWFuJyxcbiAgfSxcbn0gYXMgY29uc3Q7XG5cbmNvbnN0IFdTRExTZXF1ZW5jZVNjaGVtYSA9IHtcbiAgZWxlbWVudDogWyc/JywgV1NETEVsZW1lbnRTY2hlbWFdLFxuICAneHNkOmVsZW1lbnQnOiBbJz8nLCBXU0RMRWxlbWVudFNjaGVtYV0sXG59IGFzIGNvbnN0O1xuXG5jb25zdCBXU0RMRXh0ZW5zaW9uU2NoZW1hID0ge1xuICAkOiB7IGJhc2U6ICdzdHJpbmcnIH0sXG4gIHNlcXVlbmNlOiB7ICc/JzogV1NETFNlcXVlbmNlU2NoZW1hIH0sXG4gICd4c2Q6c2VxdWVuY2UnOiB7ICc/JzogV1NETFNlcXVlbmNlU2NoZW1hIH0sXG59IGFzIGNvbnN0O1xuXG5jb25zdCBXU0RMQ29tcGxleENvbnRlbnRTY2hlbWEgPSB7XG4gIGV4dGVuc2lvbjogeyAnPyc6IFdTRExFeHRlbnNpb25TY2hlbWEgfSxcbiAgJ3hzZDpleHRlbnNpb24nOiB7ICc/JzogV1NETEV4dGVuc2lvblNjaGVtYSB9LFxufSBhcyBjb25zdDtcblxuY29uc3QgV1NETENvbXBsZXhUeXBlU2NoZW1hID0ge1xuICAkOiB7IG5hbWU6ICdzdHJpbmcnIH0sXG4gIHNlcXVlbmNlOiB7ICc/JzogV1NETFNlcXVlbmNlU2NoZW1hIH0sXG4gICd4c2Q6c2VxdWVuY2UnOiB7ICc/JzogV1NETFNlcXVlbmNlU2NoZW1hIH0sXG4gIGNvbXBsZXhDb250ZW50OiB7ICc/JzogV1NETENvbXBsZXhDb250ZW50U2NoZW1hIH0sXG4gICd4c2Q6Y29tcGxleENvbnRlbnQnOiB7ICc/JzogV1NETENvbXBsZXhDb250ZW50U2NoZW1hIH0sXG59IGFzIGNvbnN0O1xuXG5jb25zdCBXU0RMU2NoZW1hU2NoZW1hID0ge1xuICAkOiAnYW55JyxcbiAgY29tcGxleFR5cGU6IFsnPycsICdhbnknXSxcbiAgc2ltcGxlVHlwZTogWyc/JywgJ2FueSddLFxuICAneHNkOmNvbXBsZXhUeXBlJzogWyc/JywgJ2FueSddLFxuICAneHNkOnNpbXBsZVR5cGUnOiBbJz8nLCAnYW55J10sXG59IGFzIGNvbnN0O1xuXG5jb25zdCBXU0RMU2NoZW1hID0ge1xuICBkZWZpbml0aW9uczoge1xuICAgICQ6ICdhbnknLFxuICAgIHR5cGVzOiB7XG4gICAgICBzY2hlbWE6IFsnPycsIFdTRExTY2hlbWFTY2hlbWFdLFxuICAgICAgJ3hzZDpzY2hlbWEnOiBbJz8nLCBXU0RMU2NoZW1hU2NoZW1hXSxcbiAgICB9LFxuICAgIG1lc3NhZ2U6IFsnYW55J10sXG4gICAgcG9ydFR5cGU6IHtcbiAgICAgICQ6ICdhbnknLFxuICAgICAgb3BlcmF0aW9uOiBbJ2FueSddLFxuICAgIH0sXG4gICAgYmluZGluZzoge1xuICAgICAgJDogJ2FueScsXG4gICAgICBvcGVyYXRpb246IFsnYW55J10sXG4gICAgfSxcbiAgICBzZXJ2aWNlOiB7XG4gICAgICAkOiAnYW55JyxcbiAgICAgIGRvY3VtZW50YXRpb246ICdzdHJpbmcnLFxuICAgICAgb3BlcmF0aW9uOiBbJ2FueSddLFxuICAgIH0sXG4gIH0sXG59IGFzIGNvbnN0O1xuXG4vKipcbiAqXG4gKi9cbnR5cGUgV1NETCA9IFNvYXBTY2hlbWFFbGVtZW50VHlwZTx0eXBlb2YgV1NETFNjaGVtYT47XG5cbnR5cGUgV1NETEVsZW1lbnQgPSBTb2FwU2NoZW1hRWxlbWVudFR5cGU8dHlwZW9mIFdTRExFbGVtZW50U2NoZW1hPjtcblxudHlwZSBXU0RMU2ltcGxlVHlwZSA9IFNvYXBTY2hlbWFFbGVtZW50VHlwZTx0eXBlb2YgV1NETFNpbXBsZVR5cGVTY2hlbWE+O1xuXG50eXBlIFdTRExDb21wbGV4VHlwZSA9IFNvYXBTY2hlbWFFbGVtZW50VHlwZTx0eXBlb2YgV1NETENvbXBsZXhUeXBlU2NoZW1hPjtcblxuLyoqXG4gKlxuICovXG5mdW5jdGlvbiB0b0pzVHlwZSh4c2RUeXBlOiBzdHJpbmcsIHNpbXBsZVR5cGVzOiB7IFt0eXBlOiBzdHJpbmddOiBzdHJpbmcgfSkge1xuICBzd2l0Y2ggKHhzZFR5cGUpIHtcbiAgICBjYXNlICd4c2Q6Ym9vbGVhbic6XG4gICAgICByZXR1cm4gJ2Jvb2xlYW4nO1xuICAgIGNhc2UgJ3hzZDpzdHJpbmcnOlxuICAgIGNhc2UgJ3hzZDpkYXRlJzpcbiAgICBjYXNlICd4c2Q6ZGF0ZVRpbWUnOlxuICAgIGNhc2UgJ3hzZDp0aW1lJzpcbiAgICBjYXNlICd4c2Q6YmFzZTY0QmluYXJ5JzpcbiAgICAgIHJldHVybiAnc3RyaW5nJztcbiAgICBjYXNlICd4c2Q6aW50JzpcbiAgICBjYXNlICd4c2Q6bG9uZyc6XG4gICAgY2FzZSAneHNkOmRvdWJsZSc6XG4gICAgICByZXR1cm4gJ251bWJlcic7XG4gICAgY2FzZSAneHNkOmFueVR5cGUnOlxuICAgICAgcmV0dXJuICdhbnknO1xuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGNvbnN0IFtucywgdHlwZV0gPSB4c2RUeXBlLnNwbGl0KCc6Jyk7XG4gICAgICBpZiAoc2ltcGxlVHlwZXNbdHlwZV0pIHtcbiAgICAgICAgcmV0dXJuIHNpbXBsZVR5cGVzW3R5cGVdO1xuICAgICAgfVxuICAgICAgaWYgKG5zKSB7XG4gICAgICAgIHJldHVybiB0eXBlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHhzZFR5cGU7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICpcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVhZFdTRExGaWxlKGZpbGVQYXRoOiBzdHJpbmcpIHtcbiAgY29uc3QgeG1sRGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKGZpbGVQYXRoLCAndXRmOCcpO1xuICBjb25zdCBqc29uID0gYXdhaXQgeG1sMmpzLnBhcnNlU3RyaW5nUHJvbWlzZSh4bWxEYXRhLCB7XG4gICAgZXhwbGljaXRBcnJheTogZmFsc2UsXG4gIH0pO1xuICByZXR1cm4gY2FzdFR5cGVVc2luZ1NjaGVtYShqc29uLCBXU0RMU2NoZW1hKSBhcyBXU0RMO1xufVxuXG4vKipcbiAqXG4gKi9cbmZ1bmN0aW9uIGdldFR5cGVJbmZvKGVsOiBXU0RMRWxlbWVudCwgc2ltcGxlVHlwZXM6IHsgW25hbWU6IHN0cmluZ106IHN0cmluZyB9KSB7XG4gIGxldCB0eXBlID0gdG9Kc1R5cGUoZWwuJC50eXBlLCBzaW1wbGVUeXBlcyk7XG4gIGNvbnN0IGlzQXJyYXkgPSBlbC4kLm1heE9jY3VycyA9PT0gJ3VuYm91bmRlZCc7XG4gIGNvbnN0IG5pbGxhYmxlID0gKCFpc0FycmF5ICYmIGVsLiQubWluT2NjdXJzID09PSAwKSB8fCBlbC4kLm5pbGxhYmxlO1xuICByZXR1cm4gaXNBcnJheVxuICAgID8gbmlsbGFibGVcbiAgICAgID8gWyc/JywgdHlwZV1cbiAgICAgIDogW3R5cGVdXG4gICAgOiBuaWxsYWJsZVxuICAgID8gYD8ke3R5cGV9YFxuICAgIDogdHlwZTtcbn1cblxuLyoqXG4gKlxuICovXG5mdW5jdGlvbiBleHRyYWN0Q29tcGxleFR5cGVzKHdzZGw6IFdTREwpIHtcbiAgY29uc29sZS5sb2cod3NkbC5kZWZpbml0aW9ucy50eXBlc1sneHNkOnNjaGVtYSddKTtcbiAgbGV0IHNjaGVtYXM6IHsgW25hbWU6IHN0cmluZ106IFNvYXBTY2hlbWFEZWYgfSA9IHt9O1xuICBjb25zdCBzaW1wbGVUeXBlczogeyBbdHlwZTogc3RyaW5nXTogc3RyaW5nIH0gPSB7fTtcbiAgY29uc3QgdHlwZXMgPSB3c2RsLmRlZmluaXRpb25zLnR5cGVzO1xuICBmb3IgKGNvbnN0IHNjIG9mIHR5cGVzLnNjaGVtYSA/PyB0eXBlc1sneHNkOnNjaGVtYSddID8/IFtdKSB7XG4gICAgZm9yIChjb25zdCBzdCBvZiBzYy5zaW1wbGVUeXBlID8/IHNjWyd4c2Q6c2ltcGxlVHlwZSddID8/IFtdKSB7XG4gICAgICBjb25zdCBzaW1wbGVUeXBlOiBXU0RMU2ltcGxlVHlwZSA9IGNhc3RUeXBlVXNpbmdTY2hlbWEoXG4gICAgICAgIHN0LFxuICAgICAgICBXU0RMU2ltcGxlVHlwZVNjaGVtYSxcbiAgICAgICk7XG4gICAgICBjb25zdCBycyA9IHNpbXBsZVR5cGUucmVzdHJpY3Rpb24gPz8gc2ltcGxlVHlwZVsneHNkOnJlc3RyaWN0aW9uJ107XG4gICAgICBjb25zdCBiYXNlID0gcnMuJC5iYXNlLnNwbGl0KCc6JylbMV07XG4gICAgICBzaW1wbGVUeXBlc1tzaW1wbGVUeXBlLiQubmFtZV0gPSBiYXNlO1xuICAgIH1cbiAgfVxuICBjb25zb2xlLmxvZyh7IHNpbXBsZVR5cGVzIH0pO1xuICBmb3IgKGNvbnN0IHNjIG9mIHR5cGVzLnNjaGVtYSA/PyB0eXBlc1sneHNkOnNjaGVtYSddID8/IFtdKSB7XG4gICAgZm9yIChjb25zdCBjdCBvZiBzYy5jb21wbGV4VHlwZSA/PyBzY1sneHNkOmNvbXBsZXhUeXBlJ10gPz8gW10pIHtcbiAgICAgIGNvbnN0IGNvbXBsZXhUeXBlOiBXU0RMQ29tcGxleFR5cGUgPSBjYXN0VHlwZVVzaW5nU2NoZW1hKFxuICAgICAgICBjdCxcbiAgICAgICAgV1NETENvbXBsZXhUeXBlU2NoZW1hLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHNjaGVtYToge1xuICAgICAgICB0eXBlOiBzdHJpbmc7XG4gICAgICAgIGV4dGVuZHM/OiBzdHJpbmc7XG4gICAgICAgIHByb3BzOiB7IFtuYW1lOiBzdHJpbmddOiBhbnkgfTtcbiAgICAgIH0gPSB7XG4gICAgICAgIHR5cGU6IGNvbXBsZXhUeXBlLiQubmFtZSxcbiAgICAgICAgcHJvcHM6IHt9LFxuICAgICAgfTtcbiAgICAgIGNvbnN0IHNlcSA9IGNvbXBsZXhUeXBlLnNlcXVlbmNlID8/IGNvbXBsZXhUeXBlWyd4c2Q6c2VxdWVuY2UnXTtcbiAgICAgIGNvbnN0IGVscyA9IHNlcT8uZWxlbWVudCA/PyBzZXE/LlsneHNkOmVsZW1lbnQnXTtcbiAgICAgIGZvciAoY29uc3QgZWwgb2YgZWxzID8/IFtdKSB7XG4gICAgICAgIHNjaGVtYS5wcm9wc1tlbC4kLm5hbWVdID0gZ2V0VHlwZUluZm8oZWwsIHNpbXBsZVR5cGVzKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNjID1cbiAgICAgICAgY29tcGxleFR5cGUuY29tcGxleENvbnRlbnQgPz8gY29tcGxleFR5cGVbJ3hzZDpjb21wbGV4Q29udGVudCddO1xuICAgICAgaWYgKGNjKSB7XG4gICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IGNjLmV4dGVuc2lvbiA/PyBjY1sneHNkOmV4dGVuc2lvbiddO1xuICAgICAgICBpZiAoZXh0ZW5zaW9uKSB7XG4gICAgICAgICAgc2NoZW1hLmV4dGVuZHMgPSBleHRlbnNpb24uJC5iYXNlLnNwbGl0KCc6JylbMV07XG4gICAgICAgICAgY29uc3Qgc2VxID0gZXh0ZW5zaW9uLnNlcXVlbmNlID8/IGV4dGVuc2lvblsneHNkOnNlcXVlbmNlJ107XG4gICAgICAgICAgY29uc3QgZWxzID0gc2VxPy5lbGVtZW50ID8/IHNlcT8uWyd4c2Q6ZWxlbWVudCddO1xuICAgICAgICAgIGZvciAoY29uc3QgZWwgb2YgZWxzID8/IFtdKSB7XG4gICAgICAgICAgICBzY2hlbWEucHJvcHNbZWwuJC5uYW1lXSA9IGdldFR5cGVJbmZvKGVsLCBzaW1wbGVUeXBlcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBzY2hlbWFzW2NvbXBsZXhUeXBlLiQubmFtZV0gPSBzY2hlbWE7XG4gICAgfVxuICB9XG4gIHJldHVybiBzY2hlbWFzO1xufVxuXG4vKipcbiAqXG4gKi9cbmNvbnN0IEdFTkVSQVRFRF9NRVNTQUdFX0NPTU1FTlQgPSBgLyoqXG4gKiBUaGlzIGZpbGUgaXMgZ2VuZXJhdGVkIGZyb20gV1NETCBmaWxlIGJ5IHdzZGwyc2NoZW1hLnRzLlxuICogRG8gbm90IG1vZGlmeSBkaXJlY3RseS5cbiAqIFRvIGdlbmVyYXRlIHRoZSBmaWxlLCBydW4gXCJ0cy1ub2RlIHBhdGgvdG8vd3NkbDJzY2hlbWEudHMgcGF0aC90by93c2RsLnhtbCBwYXRoL3RvL3NjaGVtYS50c1wiXG4gKi9cbmA7XG5cbi8qKlxuICpcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZHVtcFNjaGVtYShzY2hlbWFzOiB7IFtuYW1lOiBzdHJpbmddOiBhbnkgfSwgb3V0RmlsZTogc3RyaW5nKSB7XG4gIGNvbnN0IG91dCA9IGZzLmNyZWF0ZVdyaXRlU3RyZWFtKG91dEZpbGUsICd1dGY4Jyk7XG4gIGNvbnN0IHByaW50ID0gKHN0cjogc3RyaW5nLCBpbmRlbnQ6IG51bWJlciA9IDApID0+IHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluZGVudDsgaSsrKSB7XG4gICAgICBvdXQud3JpdGUoJyAnKTtcbiAgICB9XG4gICAgb3V0LndyaXRlKHN0cik7XG4gIH07XG4gIGNvbnN0IHByaW50bG4gPSAoc3RyOiBzdHJpbmcgPSAnJywgaW5kZW50OiBudW1iZXIgPSAwKSA9PiB7XG4gICAgcHJpbnQoc3RyICsgJ1xcbicsIGluZGVudCk7XG4gIH07XG4gIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgb3V0Lm9uKCdlcnJvcicsIHJlamVjdCk7XG4gICAgb3V0Lm9uKCdmaW5pc2gnLCAoKSA9PiByZXNvbHZlKCkpO1xuICAgIHByaW50bG4oR0VORVJBVEVEX01FU1NBR0VfQ09NTUVOVCk7XG4gICAgcHJpbnQoJ2V4cG9ydCBjb25zdCBBcGlTY2hlbWFzID0gJyk7XG4gICAgd3JpdGVTY2hlbWEoc2NoZW1hcyk7XG4gICAgcHJpbnRsbignIGFzIGNvbnN0OycpO1xuICAgIHByaW50bG4oKTtcbiAgICB3cml0ZVR5cGVEZWZzKHNjaGVtYXMpO1xuICAgIG91dC5lbmQoKTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gd3JpdGVTY2hlbWEobzogYW55LCBpbmRlbnQ6IG51bWJlciA9IDApIHtcbiAgICBpZiAoaW5kZW50ID4gMjApIHtcbiAgICAgIHByaW50KFwiJ2FueSdcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KG8pKSB7XG4gICAgICBwcmludCgnWycpO1xuICAgICAgbGV0IGkgPSAwO1xuICAgICAgZm9yIChjb25zdCBjbyBvZiBvKSB7XG4gICAgICAgIGlmIChpID4gMCkge1xuICAgICAgICAgIHByaW50KCcsICcpO1xuICAgICAgICB9XG4gICAgICAgIHdyaXRlU2NoZW1hKGNvLCBpbmRlbnQpO1xuICAgICAgICBpKys7XG4gICAgICB9XG4gICAgICBwcmludCgnXScpO1xuICAgIH0gZWxzZSBpZiAoaXNNYXBPYmplY3QobykpIHtcbiAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhvKTtcbiAgICAgIGlmIChrZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcHJpbnRsbigneycpO1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2Yga2V5cykge1xuICAgICAgICAgIGNvbnN0IGNvID0gb1tuYW1lXTtcbiAgICAgICAgICBjb25zdCBuYW1lSWQgPSAvXltcXHdfJF0rJC8udGVzdChuYW1lKSA/IG5hbWUgOiBgJyR7bmFtZX0nYDtcbiAgICAgICAgICBwcmludChgJHtuYW1lSWR9OiBgLCBpbmRlbnQgKyAyKTtcbiAgICAgICAgICB3cml0ZVNjaGVtYShjbywgaW5kZW50ICsgMik7XG4gICAgICAgICAgcHJpbnRsbignLCcpO1xuICAgICAgICB9XG4gICAgICAgIHByaW50KCd9JywgaW5kZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHByaW50KCd7fScpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBwcmludChKU09OLnN0cmluZ2lmeShvKS5yZXBsYWNlKC9cIi9nLCBcIidcIikpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHdyaXRlVHlwZURlZihcbiAgICBvOiBhbnksXG4gICAgc2NoZW1hczogeyBbbmFtZTogc3RyaW5nXTogU29hcFNjaGVtYURlZiB9LFxuICAgIGluZGVudDogbnVtYmVyID0gMCxcbiAgKSB7XG4gICAgaWYgKHR5cGVvZiBvID09PSAnc3RyaW5nJykge1xuICAgICAgcHJpbnQobyk7XG4gICAgfSBlbHNlIGlmIChpc01hcE9iamVjdChvKSkge1xuICAgICAgaWYgKCd0eXBlJyBpbiBvICYmICdwcm9wcycgaW4gbykge1xuICAgICAgICBpZiAoJ2V4dGVuZHMnIGluIG8gJiYgdHlwZW9mIG8uZXh0ZW5kcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBwcmludChgJHtvLmV4dGVuZHN9ICYgYCk7XG4gICAgICAgIH1cbiAgICAgICAgd3JpdGVUeXBlRGVmKG8ucHJvcHMsIHNjaGVtYXMsIGluZGVudCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhvKTtcbiAgICAgIGlmIChrZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcHJpbnRsbigneycpO1xuICAgICAgICBmb3IgKGNvbnN0IHByb3Agb2YgT2JqZWN0LmtleXMobykpIHtcbiAgICAgICAgICBsZXQgdmFsdWU6IGFueSA9IG9bcHJvcF07XG4gICAgICAgICAgbGV0IG5pbGxhYmxlID0gZmFsc2U7XG4gICAgICAgICAgbGV0IGlzQXJyYXkgPSBmYWxzZTtcbiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgICAgIGlzQXJyYXkgPSB0cnVlO1xuICAgICAgICAgICAgY29uc3QgbGVuID0gdmFsdWUubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKGxlbiA9PT0gMiAmJiB2YWx1ZVswXSA9PT0gJz8nKSB7XG4gICAgICAgICAgICAgIG5pbGxhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZVsxXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gdmFsdWVbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChpc01hcE9iamVjdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgIGlmICgnPycgaW4gdmFsdWUpIHtcbiAgICAgICAgICAgICAgbmlsbGFibGUgPSB0cnVlO1xuICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlWyc/J107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlWzBdID09PSAnPycpIHtcbiAgICAgICAgICAgIG5pbGxhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuc3Vic3RyaW5nKDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBwcmludChgJHtwcm9wfSR7bmlsbGFibGUgPyAnPycgOiAnJ306IGAsIGluZGVudCArIDIpO1xuICAgICAgICAgIHdyaXRlVHlwZURlZih2YWx1ZSwgc2NoZW1hcywgaW5kZW50ICsgMik7XG4gICAgICAgICAgaWYgKGlzQXJyYXkpIHtcbiAgICAgICAgICAgIHByaW50KCdbXScpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobmlsbGFibGUpIHtcbiAgICAgICAgICAgIHByaW50KCcgfCBudWxsIHwgdW5kZWZpbmVkJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHByaW50bG4oJzsnKTtcbiAgICAgICAgfVxuICAgICAgICBwcmludCgnfScsIGluZGVudCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcmludCgne30nKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB3cml0ZVR5cGVEZWZzKHNjaGVtYXM6IHsgW25hbWU6IHN0cmluZ106IFNvYXBTY2hlbWFEZWYgfSkge1xuICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3Qua2V5cyhzY2hlbWFzKSkge1xuICAgICAgY29uc3Qgc2NoZW1hID0gc2NoZW1hc1tuYW1lXTtcbiAgICAgIHByaW50KGBleHBvcnQgdHlwZSAke25hbWV9ID0gYCk7XG4gICAgICB3cml0ZVR5cGVEZWYoc2NoZW1hLCBzY2hlbWFzKTtcbiAgICAgIHByaW50bG4oJzsnKTtcbiAgICAgIHByaW50bG4oKTtcbiAgICB9XG4gICAgcHJpbnRsbignZXhwb3J0IHR5cGUgQXBpU2NoZW1hVHlwZXMgPSB7Jyk7XG4gICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5rZXlzKHNjaGVtYXMpKSB7XG4gICAgICBwcmludGxuKGAke25hbWV9OiAke25hbWV9O2AsIDIpO1xuICAgIH1cbiAgICBwcmludGxuKCd9OycpO1xuICB9XG59XG5cbi8qKlxuICpcbiAqL1xuYXN5bmMgZnVuY3Rpb24gbWFpbigpIHtcbiAgY29uc3Qgd3NkbEZpbGVQYXRoID0gcHJvY2Vzcy5hcmd2WzJdO1xuICBpZiAoIXdzZGxGaWxlUGF0aCkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ05vIGlucHV0IFdTREwgZmlsZSBpcyBzcGVjaWZpZWQuJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IG91dEZpbGVQYXRoID0gcHJvY2Vzcy5hcmd2WzNdO1xuICBpZiAoIXdzZGxGaWxlUGF0aCkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ05vIG91dHB1dCB0eXBlc2NyaXB0IHNjaGVtYSBmaWxlIGlzIHNwZWNpZmllZC4nKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3Qgd3NkbCA9IGF3YWl0IHJlYWRXU0RMRmlsZSh3c2RsRmlsZVBhdGgpO1xuICBjb25zdCBzY2hlbWFzID0gZXh0cmFjdENvbXBsZXhUeXBlcyh3c2RsKTtcbiAgZHVtcFNjaGVtYShzY2hlbWFzLCBvdXRGaWxlUGF0aCk7XG59XG5cbm1haW4oKTtcbiJdfQ==